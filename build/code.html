<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|PT+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

    <!-- Tell mobile browsers we're optimized for them and they don't need to
         crop the viewport. -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="/atom.xml" />
    <link rel="stylesheet" href="/style.css" type="text/css" />

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <title>
      All Code
      
        &ndash; journal.stuffwithstuff.com
      
    </title>
  </head>
  <body>
    <div class="column">
      <article>
<header>
<h1>All Code</h1>
</header>

<h2>2008/02/09/c-extension-methods-not-just-for-breakfast</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="t">StringUtils</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">bool</span> <span class="i">IsAlpha</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="t">char</span> <span class="i">c</span> <span class="k">in</span> <span class="i">text</span><span class="p">.</span><span class="i">ToLower</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="i">Char</span><span class="p">.</span><span class="i">IsLetter</span><span class="p">(</span><span class="i">c</span><span class="p">))</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">bool</span> <span class="i">isAlpha</span> <span class="o">=</span> <span class="i">StringUtils</span><span class="p">.</span><span class="i">IsAlpha</span><span class="p">(</span><span class="i">someString</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="t">StringUtils</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">bool</span> <span class="i">IsAlpha</span><span class="p">(</span><span class="k">this</span> <span class="t">string</span> <span class="i">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="t">string</span> <span class="i">letters</span> <span class="o">=</span> <span class="s">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="t">char</span> <span class="i">c</span> <span class="k">in</span> <span class="i">text</span><span class="p">.</span><span class="i">ToLower</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="i">letters</span><span class="p">.</span><span class="i">Contains</span><span class="p">(</span><span class="i">c</span><span class="p">))</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">bool</span> <span class="i">isAlpha</span> <span class="o">=</span> <span class="i">someString</span><span class="p">.</span><span class="i">IsAlpha</span><span class="p">();</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">interface</span> <span class="t">IPosition</span>
<span class="p">{</span>
    <span class="t">float</span> <span class="i">X</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="t">float</span> <span class="i">Y</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="t">Monster</span><span class="p">:</span> <span class="t">Actor</span><span class="p">,</span> <span class="t">IPosition</span> <span class="p">{</span> <span class="c">/* implementation... */</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">class</span> <span class="t">Treasure</span><span class="p">:</span> <span class="t">Item</span><span class="p">,</span> <span class="t">IPosition</span> <span class="p">{</span> <span class="c">/* implementation... */</span> <span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">MonsterCollection</span> <span class="p">:</span> <span class="t">List</span><span class="o">&lt;</span><span class="t">Monster</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">Monster</span> <span class="i">GetAt</span><span class="p">(</span><span class="t">IPosition</span> <span class="i">pos</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="t">IPositionExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">T</span> <span class="i">GetAt</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span> <span class="t">IEnumerable</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="i">col</span><span class="p">,</span>
        <span class="t">float</span> <span class="i">x</span><span class="p">,</span> <span class="t">float</span> <span class="i">y</span><span class="p">)</span> <span class="k">where</span> <span class="t">T</span> <span class="p">:</span> <span class="t">IPosition</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="t">T</span> <span class="i">item</span> <span class="k">in</span> <span class="i">col</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="i">item</span><span class="p">.</span><span class="i">X</span> <span class="o">==</span> <span class="i">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="i">item</span><span class="p">.</span><span class="i">Y</span> <span class="o">==</span> <span class="i">y</span><span class="p">))</span> <span class="k">return</span> <span class="i">item</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">default</span><span class="p">(</span><span class="t">T</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">List</span><span class="o">&lt;</span><span class="t">Monster</span><span class="o">&gt;</span> <span class="i">monsters</span> <span class="o">=</span> <span class="k">new</span> <span class="t">List</span><span class="o">&lt;</span><span class="t">Monster</span><span class="o">&gt;</span><span class="p">();</span>
<span class="i">monsters</span><span class="p">.</span><span class="i">GetAt</span><span class="p">(</span><span class="n">1.0f</span><span class="p">,</span> <span class="n">2.0f</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">Stack</span><span class="o">&lt;</span><span class="t">Treasure</span><span class="o">&gt;</span> <span class="i">treasures</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Stack</span><span class="o">&lt;</span><span class="t">Treasure</span><span class="o">&gt;</span><span class="p">();</span>
<span class="i">treasures</span><span class="p">.</span><span class="i">GetAt</span><span class="p">(</span><span class="n">1.0f</span><span class="p">,</span> <span class="n">2.0f</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">Dictionary</span><span class="o">&lt;</span><span class="t">string</span><span class="p">,</span> <span class="t">Monster</span><span class="o">&gt;</span> <span class="i">monsters</span> <span class="o">=</span>
    <span class="k">new</span> <span class="t">Dictionary</span><span class="o">&lt;</span><span class="t">string</span><span class="p">,</span> <span class="t">Monster</span><span class="o">&gt;</span><span class="p">();</span>
<span class="i">monsters</span><span class="p">.</span><span class="i">Values</span><span class="p">.</span><span class="i">GetAt</span><span class="p">(</span><span class="n">1.0f</span><span class="p">,</span> <span class="n">2.0f</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span>    <span class="i">foo</span><span class="p">.</span><span class="i">Bar</span><span class="p">();</span> <span class="c">// needs access to private members</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span>    <span class="i">FooHelper</span><span class="p">.</span><span class="i">Bar</span><span class="p">(</span><span class="i">foo</span><span class="p">);</span> <span class="c">// doesn&#39;t need access to private members</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">namespace</span> <span class="i">Engine</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="t">Monster</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="t">float</span> <span class="i">X</span><span class="p">;</span>
        <span class="k">public</span> <span class="t">float</span> <span class="i">Y</span><span class="p">;</span>
        <span class="k">public</span> <span class="t">string</span> <span class="i">Type</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="i">ProcessAI</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c">// stuff...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">Monster</span> <span class="i">monster</span><span class="p">)</span>
<span class="p">{</span>
    <span class="i">Console</span><span class="p">.</span><span class="i">WriteLine</span><span class="p">(</span><span class="i">monster</span><span class="p">.</span><span class="i">Character</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">namespace</span> <span class="i">UI</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="t">MonsterExtensions</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="t">char</span> <span class="i">GetCharacter</span><span class="p">(</span><span class="k">this</span> <span class="t">Monster</span> <span class="i">monster</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="i">type</span> <span class="o">==</span> <span class="s">&quot;orc&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="s">&#39;o&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="i">type</span> <span class="o">==</span> <span class="s">&quot;kobold&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="s">&#39;k&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="i">type</span> <span class="o">==</span> <span class="s">&quot;dragon&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="s">&#39;d&#39;</span><span class="p">;</span>
            <span class="k">return</span> <span class="s">&#39;?&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2008/02/26/avoiding-overload-hell-in-c</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">Terminal</span> <span class="i">terminal</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Terminal</span><span class="p">();</span>

<span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">.</span><span class="i">Fill</span><span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Red</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">.</span><span class="i">Draw</span><span class="p">(</span><span class="i">Color</span><span class="p">.</span><span class="i">Green</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">Terminal</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">,</span>
        <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">,</span>
        <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">,</span> <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">,</span> <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">Color</span> <span class="i">fore</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">Color</span> <span class="i">fore</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">Color</span> <span class="i">fore</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">Point</span> <span class="i">pos</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">Terminal</span> <span class="i">terminal</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Terminal</span><span class="p">();</span>

<span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">.</span><span class="i">Fill</span><span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Red</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">.</span><span class="i">Draw</span><span class="p">(</span><span class="i">Color</span><span class="p">.</span><span class="i">Green</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">Terminal</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">,</span> <span class="k">params</span> <span class="t">object</span><span class="p">[]</span> <span class="i">options</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="k">params</span> <span class="t">object</span><span class="p">[]</span> <span class="i">options</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="k">params</span> <span class="t">object</span><span class="p">[]</span> <span class="i">options</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">,</span> <span class="k">params</span> <span class="t">object</span><span class="p">[]</span> <span class="i">options</span><span class="p">)</span>
<span class="p">{</span>
    <span class="t">Point</span> <span class="i">pos</span> <span class="o">=</span> <span class="i">mCurrentPos</span><span class="p">;</span>
    <span class="t">Color?</span> <span class="i">foreColor</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="t">Color?</span> <span class="i">backColor</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="t">int?</span> <span class="i">x</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="t">int?</span> <span class="i">y</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="t">object</span> <span class="i">obj</span> <span class="k">in</span> <span class="i">options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">obj</span> <span class="k">is</span> <span class="t">Point</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="i">pos</span> <span class="o">=</span> <span class="p">(</span><span class="t">Point</span><span class="p">)</span><span class="i">obj</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">obj</span> <span class="k">is</span> <span class="t">Color</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="i">foreColor</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="i">foreColor</span> <span class="o">=</span> <span class="p">(</span><span class="t">Color</span><span class="p">)</span><span class="i">obj</span><span class="p">;</span>
            <span class="k">else</span> <span class="i">backColor</span> <span class="o">=</span> <span class="p">(</span><span class="t">Color</span><span class="p">)</span><span class="i">obj</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">obj</span> <span class="k">is</span> <span class="t">int</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="i">x</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="i">x</span> <span class="o">=</span> <span class="p">(</span><span class="t">int</span><span class="p">)</span><span class="i">obj</span><span class="p">;</span>
            <span class="k">else</span> <span class="i">y</span> <span class="o">=</span> <span class="p">(</span><span class="t">int</span><span class="p">)</span><span class="i">obj</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="i">x</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="i">x</span> <span class="o">=</span> <span class="i">mCurrentX</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">y</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="i">y</span> <span class="o">=</span> <span class="i">mCurrentY</span><span class="p">;</span>

    <span class="c">// write using pos, color, etc.</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">17</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">White</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Aqua</span><span class="p">,</span>
    <span class="i">Color</span><span class="p">.</span><span class="i">Beige</span><span class="p">,</span> <span class="s">&quot;wtf?&quot;</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">TerminalParams</span>
<span class="p">{</span>
    <span class="c">// Nullable so that null = default value.</span>
    <span class="k">public</span> <span class="t">Point?</span> <span class="i">Pos</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">Color?</span> <span class="i">Fore</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">Color?</span> <span class="i">Back</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">Terminal</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">TerminalParams</span> <span class="i">paramObj</span><span class="p">,</span> <span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">(</span><span class="t">TerminalParams</span> <span class="i">paramObj</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">TerminalParams</span> <span class="i">paramObj</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">Terminal</span> <span class="i">terminal</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Terminal</span><span class="p">();</span>

<span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="k">new</span> <span class="t">TerminalParams</span><span class="p">(),</span> <span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">.</span><span class="i">Fill</span><span class="p">(</span><span class="k">new</span> <span class="t">TerminalParams</span>
        <span class="p">{</span> <span class="i">Pos</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Point</span><span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">),</span> <span class="i">Fore</span> <span class="o">=</span> <span class="i">Color</span><span class="p">.</span><span class="i">Red</span> <span class="p">});</span>
<span class="i">terminal</span><span class="p">.</span><span class="i">Draw</span><span class="p">(</span><span class="k">new</span> <span class="t">TerminalParams</span>
        <span class="p">{</span> <span class="i">Fore</span> <span class="o">=</span> <span class="i">Color</span><span class="p">.</span><span class="i">Green</span><span class="p">,</span> <span class="i">Back</span> <span class="o">=</span> <span class="i">Color</span><span class="p">.</span><span class="i">Blue</span> <span class="p">});</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Red</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span>    <span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Red</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="c">//             ^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^  ^^^^</span>
<span class="c">//             Position  Color                  Text</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">)(</span><span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Red</span><span class="p">)(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">)(</span><span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Red</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">terminal</span><span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">)(</span><span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Red</span><span class="p">).</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">[</span><span class="k">new</span> <span class="t">Point</span><span class="p">(</span><span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">)].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">][</span><span class="a">Color.Red</span><span class="p">].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">[</span><span class="i">Color</span><span class="p">.</span><span class="i">Brown</span><span class="p">].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">[</span><span class="i">Color</span><span class="p">.</span><span class="i">Green</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">].</span><span class="i">Draw</span><span class="p">();</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="c">// Bad, cannot specify position twice.</span>
<span class="i">terminal</span><span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">][</span><span class="a">new</span> <span class="i">Point</span><span class="p">(</span><span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">)].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>

<span class="c">// Bad, cannot specify half a position.</span>
<span class="i">terminal</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>

<span class="c">// Sorta bad, for consistency would always like</span>
<span class="c">// to have position before color.</span>
<span class="i">terminal</span><span class="p">[</span><span class="i">Color</span><span class="p">.</span><span class="i">Brown</span><span class="p">][</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">interface</span> <span class="t">ITerminalMethods</span>
<span class="p">{</span>
    <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">);</span>
    <span class="k">void</span> <span class="i">Fill</span><span class="p">();</span>
    <span class="k">void</span> <span class="i">Draw</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="t">ITerminalColor</span> <span class="p">:</span> <span class="t">ITerminalMethods</span>
<span class="p">{</span>
    <span class="t">ITerminalMethods</span> <span class="i">this</span><span class="p">[</span><span class="t">Color</span> <span class="i">fore</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="t">ITerminalMethods</span> <span class="i">this</span><span class="p">[</span><span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="t">ITerminalPosColor</span> <span class="p">:</span> <span class="t">ITerminalColor</span>
<span class="p">{</span>
    <span class="t">ITerminalColor</span> <span class="i">this</span><span class="p">[</span><span class="t">Point</span> <span class="i">pos</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="t">ITerminalColor</span> <span class="i">this</span><span class="p">[</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="t">ITerminal</span> <span class="p">:</span> <span class="t">ITerminalPosColor</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">terminal</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">[</span><span class="k">new</span> <span class="t">Point</span><span class="p">(</span><span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">)].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">][</span><span class="a">Color.Red</span><span class="p">].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">[</span><span class="i">Color</span><span class="p">.</span><span class="i">Brown</span><span class="p">].</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<span class="i">terminal</span><span class="p">[</span><span class="i">Color</span><span class="p">.</span><span class="i">Green</span><span class="p">,</span> <span class="i">Color</span><span class="p">.</span><span class="i">Blue</span><span class="p">].</span><span class="i">Draw</span><span class="p">();</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">TerminalData</span>
<span class="p">{</span>
    <span class="c">// Terminal core state:</span>
    <span class="k">public</span> <span class="t">char</span><span class="p">[]</span> <span class="i">Characters</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">Color</span><span class="p">[]</span> <span class="i">ForeColors</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">Color</span><span class="p">[]</span> <span class="i">BackColors</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="t">Terminal</span> <span class="p">:</span> <span class="t">ITerminal</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="i">Terminal</span><span class="p">()</span> <span class="p">{</span> <span class="i">mData</span> <span class="o">=</span> <span class="k">new</span> <span class="t">TerminalData</span><span class="p">();</span> <span class="p">}</span>

    <span class="r">#region ITerminalPosColor Members</span>

    <span class="k">public</span> <span class="t">ITerminalColor</span> <span class="i">this</span><span class="p">[</span><span class="t">Point</span> <span class="i">pos</span><span class="p">]</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="t">Terminal</span><span class="p">(</span><span class="i">mData</span><span class="p">,</span> <span class="i">pos</span><span class="p">,</span> <span class="i">mFore</span><span class="p">,</span> <span class="i">mBack</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="t">ITerminalColor</span> <span class="i">this</span><span class="p">[</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">]</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="t">Terminal</span><span class="p">(</span><span class="i">mData</span><span class="p">,</span>
            <span class="k">new</span> <span class="t">Point</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">),</span> <span class="i">mFore</span><span class="p">,</span> <span class="i">mBack</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="r">#endregion</span>

    <span class="r">#region ITerminalColor Members</span>

    <span class="k">public</span> <span class="t">ITerminalMethods</span> <span class="i">this</span><span class="p">[</span><span class="t">Color</span> <span class="i">fore</span><span class="p">]</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="t">Terminal</span><span class="p">(</span><span class="i">mData</span><span class="p">,</span> <span class="i">mPos</span><span class="p">,</span> <span class="i">fore</span><span class="p">,</span> <span class="i">mBack</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="t">ITerminalMethods</span> <span class="i">this</span><span class="p">[</span><span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">]</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="t">Terminal</span><span class="p">(</span><span class="i">mData</span><span class="p">,</span> <span class="i">mPos</span><span class="p">,</span> <span class="i">fore</span><span class="p">,</span> <span class="i">back</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="r">#endregion</span>

    <span class="r">#region ITerminalMethods Members</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Write</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Fill</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

    <span class="r">#endregion</span>

    <span class="k">private</span> <span class="i">Terminal</span><span class="p">(</span><span class="t">TerminalData</span> <span class="i">data</span><span class="p">,</span> <span class="t">Point</span> <span class="i">pos</span><span class="p">,</span>
        <span class="t">Color</span> <span class="i">fore</span><span class="p">,</span> <span class="t">Color</span> <span class="i">back</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="i">mData</span> <span class="o">=</span> <span class="i">data</span><span class="p">;</span>
        <span class="i">mPos</span>  <span class="o">=</span> <span class="i">pos</span><span class="p">;</span>
        <span class="i">mFore</span> <span class="o">=</span> <span class="i">fore</span><span class="p">;</span>
        <span class="i">mBack</span> <span class="o">=</span> <span class="i">back</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="t">TerminalData</span> <span class="i">mData</span><span class="p">;</span>

    <span class="c">// Ephemeral state:</span>
    <span class="k">private</span> <span class="t">Point</span> <span class="i">mPos</span><span class="p">;</span>
    <span class="k">private</span> <span class="t">Color</span> <span class="i">mFore</span><span class="p">;</span>
    <span class="k">private</span> <span class="t">Color</span> <span class="i">mBack</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>2008/03/05/checking-flags-in-c-enums</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="p">[</span><span class="a">Flags</span><span class="p">]</span>
<span class="k">public</span> <span class="k">enum</span> <span class="t">Fruits</span>
<span class="p">{</span>
    <span class="i">Apple</span>       <span class="o">=</span> <span class="n">1</span><span class="p">,</span>
    <span class="i">Banana</span>      <span class="o">=</span> <span class="n">2</span><span class="p">,</span>
    <span class="i">Cherry</span>      <span class="o">=</span> <span class="n">4</span><span class="p">,</span>
    <span class="i">Date</span>        <span class="o">=</span> <span class="n">8</span><span class="p">,</span>
    <span class="i">Eggplant</span>    <span class="o">=</span> <span class="n">16</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">if</span> <span class="p">((</span><span class="i">myFruit</span> <span class="o">&amp;</span> <span class="i">Fruits</span><span class="p">.</span><span class="i">Date</span><span class="p">)</span> <span class="o">==</span> <span class="i">Fruits</span><span class="p">.</span><span class="i">Date</span><span class="p">)</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="t">FruitsExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">bool</span> <span class="i">IsSet</span><span class="p">(</span><span class="k">this</span> <span class="t">Fruits</span> <span class="i">fruits</span><span class="p">,</span> <span class="t">Fruits</span> <span class="i">flags</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="i">fruits</span> <span class="o">&amp;</span> <span class="i">flags</span><span class="p">)</span> <span class="o">==</span> <span class="i">flags</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">if</span> <span class="p">(</span><span class="i">myFruit</span><span class="p">.</span><span class="i">IsSet</span><span class="p">(</span><span class="i">Fruits</span><span class="p">.</span><span class="i">Date</span><span class="p">))</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="t">FruitsExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">bool</span> <span class="i">IsSet</span><span class="p">(</span><span class="k">this</span> <span class="t">Fruits</span> <span class="i">fruits</span><span class="p">,</span> <span class="t">Fruits</span> <span class="i">flags</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="i">fruits</span> <span class="o">&amp;</span> <span class="i">flags</span><span class="p">)</span> <span class="o">==</span> <span class="i">flags</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="t">bool</span> <span class="i">IsNotSet</span><span class="p">(</span><span class="k">this</span> <span class="t">Fruits</span> <span class="i">fruits</span><span class="p">,</span> <span class="t">Fruits</span> <span class="i">flags</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="i">fruits</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="i">flags</span><span class="p">))</span> <span class="o">==</span> <span class="n">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="t">Fruits</span> <span class="i">Set</span><span class="p">(</span><span class="k">this</span> <span class="t">Fruits</span> <span class="i">fruits</span><span class="p">,</span> <span class="t">Fruits</span> <span class="i">flags</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="i">fruits</span> <span class="o">|</span> <span class="i">flags</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="t">Fruits</span> <span class="i">Clear</span><span class="p">(</span><span class="k">this</span> <span class="t">Fruits</span> <span class="i">fruits</span><span class="p">,</span> <span class="t">Fruits</span> <span class="i">flags</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="i">fruits</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="i">flags</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="t">EnumExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">bool</span> <span class="t">IsSet</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span> <span class="t">T</span> <span class="i">value</span><span class="p">,</span> <span class="t">T</span> <span class="i">flags</span><span class="p">)</span> <span class="k">where</span> <span class="t">T</span> <span class="p">:</span> <span class="t">Enum</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="i">value</span> <span class="o">&amp;</span> <span class="i">flags</span><span class="p">)</span> <span class="o">==</span> <span class="i">flags</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="t">EnumExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">bool</span> <span class="t">IsSet</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span> <span class="t">T</span> <span class="i">value</span><span class="p">,</span> <span class="t">T</span> <span class="i">flags</span><span class="p">)</span>
        <span class="k">where</span> <span class="t">T</span> <span class="p">:</span> <span class="t">struct</span>
    <span class="p">{</span>
        <span class="t">Type</span> <span class="i">type</span> <span class="o">=</span> <span class="k">typeof</span><span class="p">(</span><span class="t">T</span><span class="p">);</span>

        <span class="c">// only works with enums</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="i">type</span><span class="p">.</span><span class="i">IsEnum</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="t">ArgumentException</span><span class="p">(</span>
            <span class="s">&quot;The type parameter T must be an enum type.&quot;</span><span class="p">);</span>

        <span class="c">// handle each underlying type</span>
        <span class="t">Type</span> <span class="i">numberType</span> <span class="o">=</span> <span class="i">Enum</span><span class="p">.</span><span class="i">GetUnderlyingType</span><span class="p">(</span><span class="i">type</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">int</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">int</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">sbyte</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">sbyte</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">byte</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">byte</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">short</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">short</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">ushort</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">ushort</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">uint</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">uint</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">long</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">long</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">ulong</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">ulong</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">numberType</span><span class="p">.</span><span class="i">Equals</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">char</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">char</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">,</span> <span class="i">flags</span><span class="p">,</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="i">a</span> <span class="o">&amp;</span> <span class="i">b</span><span class="p">)</span> <span class="o">==</span> <span class="i">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="t">ArgumentException</span><span class="p">(</span>
                <span class="s">&quot;Unknown enum underlying type &quot;</span> <span class="o">+</span>
                <span class="i">numberType</span><span class="p">.</span><span class="i">Name</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c">/// Helper function for handling the value types. Boxes the</span>
    <span class="c">/// params to object so that the cast can be called on them.</span>
    <span class="k">private</span> <span class="k">static</span> <span class="t">bool</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="t">object</span> <span class="i">value</span><span class="p">,</span> <span class="t">object</span> <span class="i">flags</span><span class="p">,</span>
        <span class="t">Func</span><span class="o">&lt;</span><span class="t">T</span><span class="p">,</span> <span class="t">T</span><span class="p">,</span> <span class="t">bool</span><span class="o">&gt;</span> <span class="i">op</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="i">op</span><span class="p">((</span><span class="t">T</span><span class="p">)</span><span class="i">value</span><span class="p">,</span> <span class="p">(</span><span class="t">T</span><span class="p">)</span><span class="i">flags</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2008/04/08/whats-the-opposite-of-nullable</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">SomeMethod</span><span class="p">(</span><span class="t">Foo</span> <span class="i">foo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">foo</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="t">ArgumentNullException</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>

    <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">T</span> <span class="i">Value</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="i">mValue</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="i">NotNull</span><span class="p">(</span><span class="t">T</span> <span class="i">maybeNull</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">maybeNull</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="t">ArgumentNullException</span><span class="p">(</span><span class="s">&quot;maybeNull&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="i">mValue</span> <span class="o">=</span> <span class="i">maybeNull</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="t">T</span> <span class="i">mValue</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">SomeMethod</span><span class="p">(</span><span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span> <span class="i">foo</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">SomeMethod</span><span class="p">(</span><span class="k">new</span> <span class="t">NotNull</span><span class="p">(</span><span class="i">myFoo</span><span class="p">));</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="c">// In NotNull&lt;T&gt;:</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">implicit</span> <span class="k">operator</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="t">T</span> <span class="i">maybeNull</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="i">maybeNull</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">SomeMethod</span><span class="p">(</span><span class="i">mFoo</span><span class="p">);</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">implicit</span> <span class="k">operator</span> <span class="i">T</span><span class="p">(</span><span class="t">NotNull</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="i">notNull</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="i">notNull</span><span class="p">.</span><span class="i">Value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">SomeMethod</span><span class="p">(</span><span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span> <span class="i">foo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c">// Automatically converts on assign. :)</span>
    <span class="t">Foo</span> <span class="i">someFoo</span> <span class="o">=</span> <span class="i">foo</span><span class="p">;</span>

    <span class="c">// But not on member access. :(</span>
    <span class="c">// Can&#39;t do foo.SomeFooProperty, have to do:</span>
    <span class="i">foo</span><span class="p">.</span><span class="i">Value</span><span class="p">.</span><span class="i">SomeFooProperty</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">SomeMethod</span><span class="p">(</span><span class="k">new</span> <span class="t">NotNull</span><span class="p">(</span><span class="i">myInterfaceFoo</span><span class="p">));</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="c">/// &lt;summary&gt;</span>
<span class="c">/// &lt;para&gt;</span>
<span class="c">/// Wrapper around a reference that ensures the reference is not &lt;c&gt;null&lt;/c&gt;.</span>
<span class="c">/// Provides implicit cast operators to automatically wrap and unwrap</span>
<span class="c">/// values.</span>
<span class="c">/// &lt;/para&gt;</span>
<span class="c">/// &lt;para&gt;</span>
<span class="c">/// NotNull{T} can be used as an argument to a method to ensure that</span>
<span class="c">/// no &lt;c&gt;null&lt;/c&gt; values are passed to the method in place of manually</span>
<span class="c">/// throwing an &lt;see cref=&quot;ArgumentNullException&quot;/&gt;. It has an added</span>
<span class="c">/// benefit over that because using it as an argument type clearly</span>
<span class="c">/// communicates to the caller the expectation of the method.</span>
<span class="c">/// &lt;/para&gt;</span>
<span class="c">/// &lt;/summary&gt;</span>
<span class="c">/// &lt;typeparam name=&quot;T&quot;&gt;Type being wrapped.&lt;/typeparam&gt;</span>
<span class="k">public</span> <span class="k">class</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="c">/// &lt;summary&gt;</span>
    <span class="c">/// Automatically unwraps the non-&lt;c&gt;null&lt;/c&gt; object being wrapped</span>
    <span class="c">/// by this NotNull{T}.</span>
    <span class="c">/// &lt;/summary&gt;</span>
    <span class="c">/// &lt;param name=&quot;notNull&quot;&gt;The wrapper.&lt;/param&gt;</span>
    <span class="c">/// &lt;returns&gt;The raw object being wrapped.&lt;/returns&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">implicit</span> <span class="k">operator</span> <span class="i">T</span><span class="p">(</span><span class="t">NotNull</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="i">notNull</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="i">notNull</span><span class="p">.</span><span class="i">Value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c">/// &lt;summary&gt;</span>
    <span class="c">/// Automatically wraps an object in a NotNull{T}. Will throw</span>
    <span class="c">/// an &lt;see cref=&quot;ArgumentNullException&quot;/&gt; if the value being</span>
    <span class="c">/// wrapped is &lt;c&gt;null&lt;/c&gt;.</span>
    <span class="c">/// &lt;/summary&gt;</span>
    <span class="c">/// &lt;param name=&quot;maybeNull&quot;&gt;The raw reference to wrap.&lt;/param&gt;</span>
    <span class="c">/// &lt;returns&gt;A new NotNull{T} that wraps the value, provided the</span>
    <span class="c">/// value is not &lt;c&gt;null&lt;/c&gt;.&lt;/returns&gt;</span>
    <span class="c">/// &lt;exception cref=&quot;ArgumentNullException&quot;&gt;If &lt;c&gt;maybeNull&lt;/c&gt; is &lt;c&gt;null&lt;/c&gt;.&lt;/exception&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">implicit</span> <span class="k">operator</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="t">T</span> <span class="i">maybeNull</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="i">maybeNull</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c">/// &lt;summary&gt;</span>
    <span class="c">/// Gets and sets the non-null reference being wrapped by this</span>
    <span class="c">/// NotNull{T}.</span>
    <span class="c">/// &lt;/summary&gt;</span>
    <span class="c">/// &lt;exception cref=&quot;ArgumentNullException&quot;&gt;If &lt;c&gt;value&lt;/c&gt; is &lt;c&gt;null&lt;/c&gt;.&lt;/exception&gt;</span>
    <span class="k">public</span> <span class="t">T</span> <span class="i">Value</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="i">mValue</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">set</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="i">value</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="t">ArgumentNullException</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">);</span>
            <span class="i">mValue</span> <span class="o">=</span> <span class="i">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c">/// &lt;summary&gt;</span>
    <span class="c">/// Creates a new wrapper around the given reference.</span>
    <span class="c">/// &lt;/summary&gt;</span>
    <span class="c">/// &lt;remarks&gt;Explicitly calling the constructor is rarely needed. Usually the</span>
    <span class="c">/// implicit cast is simpler.&lt;/remarks&gt;</span>
    <span class="c">/// &lt;param name=&quot;maybeNull&quot;&gt;The reference to wrap.&lt;/param&gt;</span>
    <span class="c">/// &lt;exception cref=&quot;ArgumentNullException&quot;&gt;If &lt;c&gt;maybeNull&lt;/c&gt; is &lt;c&gt;null&lt;/c&gt;.&lt;/exception&gt;</span>
    <span class="k">public</span> <span class="i">NotNull</span><span class="p">(</span><span class="t">T</span> <span class="i">maybeNull</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">maybeNull</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="t">ArgumentNullException</span><span class="p">(</span><span class="s">&quot;maybeNull&quot;</span><span class="p">);</span>

        <span class="i">mValue</span> <span class="o">=</span> <span class="i">maybeNull</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="t">T</span> <span class="i">mValue</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="p">[</span><span class="a">TestFixture</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="t">NotNullFixture</span>
<span class="p">{</span>
    <span class="p">[</span><span class="a">Test</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">TestConstructor</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="t">Foo</span> <span class="i">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Foo</span><span class="p">();</span>
        <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span> <span class="i">notNull</span> <span class="o">=</span> <span class="k">new</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span><span class="p">(</span><span class="i">foo</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="a">Test</span><span class="p">]</span>
    <span class="p">[</span><span class="a">ExpectedException</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="t">ArgumentNullException</span><span class="p">))]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">TestConstructorThrowsOnNull</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="t">Foo</span> <span class="i">foo</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span> <span class="i">notNull</span> <span class="o">=</span> <span class="k">new</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span><span class="p">(</span><span class="i">foo</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="a">Test</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">TestGetValue</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="t">Foo</span> <span class="i">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Foo</span><span class="p">();</span>
        <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span> <span class="i">notNull</span> <span class="o">=</span> <span class="k">new</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span><span class="p">(</span><span class="i">foo</span><span class="p">);</span>

        <span class="i">Assert</span><span class="p">.</span><span class="i">AreEqual</span><span class="p">(</span><span class="i">foo</span><span class="p">,</span> <span class="i">notNull</span><span class="p">.</span><span class="i">Value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="a">Test</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">TestImplicitWrap</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="t">Foo</span> <span class="i">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Foo</span><span class="p">();</span>
        <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span> <span class="i">notNull</span> <span class="o">=</span> <span class="i">foo</span><span class="p">;</span>

        <span class="i">Assert</span><span class="p">.</span><span class="i">AreEqual</span><span class="p">(</span><span class="i">foo</span><span class="p">,</span> <span class="i">notNull</span><span class="p">.</span><span class="i">Value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="a">Test</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">TestImplicitUnwrap</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="t">Foo</span> <span class="i">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Foo</span><span class="p">();</span>
        <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span> <span class="i">notNull</span> <span class="o">=</span> <span class="k">new</span> <span class="t">NotNull</span><span class="o">&lt;</span><span class="t">Foo</span><span class="o">&gt;</span><span class="p">(</span><span class="i">foo</span><span class="p">);</span>

        <span class="t">Foo</span> <span class="i">unwrap</span> <span class="o">=</span> <span class="i">notNull</span><span class="p">;</span>

        <span class="i">Assert</span><span class="p">.</span><span class="i">AreEqual</span><span class="p">(</span><span class="i">foo</span><span class="p">,</span> <span class="i">unwrap</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="t">Foo</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2008/04/10/a-c-feature-request-extension-classes</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">Foo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">int</span> <span class="i">Value</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">3</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">FooExtensions</span> <span class="k">this</span> <span class="t">Foo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">int</span> <span class="i">DoubledValue</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="i">Value</span> <span class="o">*</span> <span class="n">2</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Hi</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="i">Console</span><span class="p">.</span><span class="i">WriteLine</span><span class="p">(</span><span class="s">&quot;hi.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">FooExtensions</span> <span class="k">this</span> <span class="t">Foo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="i">SomeMethod</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2008/11/17/using-an-iterator-as-a-game-loop</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">GameLoop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="i">mPlaying</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="i">HandleUserInput</span><span class="p">();</span>
        <span class="i">UpdateGameState</span><span class="p">();</span>
        <span class="i">Render</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">ProcessGame</span><span class="p">(</span><span class="t">UserInput</span> <span class="i">input</span><span class="p">)</span>
<span class="p">{</span>
    <span class="i">HandleUserInput</span><span class="p">(</span><span class="i">input</span><span class="p">);</span>
    <span class="i">UpdateGameState</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">UpdateGameState</span><span class="p">()</span>
<span class="p">{</span>
    <span class="i">Hero</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="t">Monster</span> <span class="i">monster</span> <span class="k">in</span> <span class="i">Monsters</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="i">monster</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">UpdateGameState</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c">// Entities has the hero in it too.</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="t">Entity</span> <span class="i">entity</span> <span class="k">in</span> <span class="i">Entities</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="i">entity</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">ProcessGame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="t">Entity</span> <span class="i">entity</span> <span class="o">=</span> <span class="i">Entities</span><span class="p">[</span><span class="i">mCurrentEntity</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="i">entity</span><span class="p">.</span><span class="i">NeedsUserInput</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="i">entity</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>
            <span class="i">mCurrentEntity</span> <span class="o">=</span> <span class="p">(</span><span class="i">mCurrentEntity</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span> <span class="o">%</span> <span class="i">Entities</span><span class="p">.</span><span class="i">Count</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">ProcessGame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">mInEntities</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="t">Entity</span> <span class="i">entity</span> <span class="o">=</span> <span class="i">Entities</span><span class="p">[</span><span class="i">mCurrentEntity</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="i">entity</span><span class="p">.</span><span class="i">NeedsUserInput</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="i">entity</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>

                <span class="i">mCurrentEntity</span><span class="o">++</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="i">mCurrentEntity</span> <span class="o">&gt;=</span> <span class="i">Entities</span><span class="p">.</span><span class="i">Count</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="i">mCurrentEntity</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
                    <span class="i">mInEntities</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="t">Item</span> <span class="i">item</span> <span class="o">=</span> <span class="i">Items</span><span class="p">[</span><span class="i">mCurrentItem</span><span class="p">];</span>
            <span class="i">item</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>

            <span class="i">mCurrentItem</span><span class="o">++</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="i">mCurrentItem</span> <span class="o">&gt;=</span> <span class="i">Items</span><span class="p">.</span><span class="i">Count</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="i">mCurrentItem</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
                <span class="i">mInEntities</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">IEnumerable</span><span class="o">&lt;</span><span class="t">int</span><span class="o">&gt;</span> <span class="i">Fibonacci</span><span class="p">()</span>
<span class="p">{</span>
    <span class="t">int</span> <span class="i">a</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
    <span class="t">int</span> <span class="i">b</span> <span class="o">=</span> <span class="n">1</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">yield return</span> <span class="i">a</span><span class="p">;</span>

        <span class="t">int</span> <span class="i">swap</span> <span class="o">=</span> <span class="i">a</span><span class="p">;</span>
        <span class="i">a</span> <span class="o">=</span> <span class="i">b</span><span class="p">;</span>
        <span class="i">b</span> <span class="o">=</span> <span class="i">swap</span> <span class="o">+</span> <span class="i">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">IEnumerable</span><span class="o">&lt;</span><span class="t">bool</span><span class="o">&gt;</span> <span class="i">ProcessGame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="t">Entity</span> <span class="i">entity</span> <span class="k">in</span> <span class="i">Entities</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="i">entity</span><span class="p">.</span><span class="i">NeedsUserInput</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">yield return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="i">entity</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="t">Item</span> <span class="i">item</span> <span class="k">in</span> <span class="i">Items</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="i">item</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">void</span> <span class="i">ProcessGame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">mIterator</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="i">mIterator</span> <span class="o">=</span> <span class="i">CreateProcessIterator</span><span class="p">().</span><span class="i">GetEnumerator</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="i">mIterator</span><span class="p">.</span><span class="i">MoveNext</span><span class="p">();</span>
    <span class="t">bool</span> <span class="i">dummy</span> <span class="o">=</span> <span class="i">mIterator</span><span class="p">.</span><span class="i">Current</span><span class="p">;</span>
<span class="p">}</span>

<span class="t">IEnumerable</span><span class="o">&lt;</span><span class="t">bool</span><span class="o">&gt;</span> <span class="i">CreateProcessIterator</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="t">Entity</span> <span class="i">entity</span> <span class="k">in</span> <span class="i">Entities</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="i">entity</span><span class="p">.</span><span class="i">NeedsUserInput</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">yield return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="i">entity</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="t">Item</span> <span class="i">item</span> <span class="k">in</span> <span class="i">Items</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="i">item</span><span class="p">.</span><span class="i">Move</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2008/11/23/constrained-compound-design-pattern</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="t">Widget</span>
<span class="p">{</span>
    <span class="c">// The sandbox.</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">();</span>

    <span class="k">protected</span> <span class="k">void</span> <span class="i">DrawString</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">,</span> <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>
    <span class="k">protected</span> <span class="k">void</span> <span class="i">DrawLine</span><span class="p">(</span><span class="t">int</span> <span class="i">x1</span><span class="p">,</span> <span class="t">int</span> <span class="i">y1</span><span class="p">,</span> <span class="t">int</span> <span class="i">x2</span><span class="p">,</span> <span class="t">int</span> <span class="i">y2</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>
    <span class="k">protected</span> <span class="k">void</span> <span class="i">DrawRect</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">int</span> <span class="i">w</span><span class="p">,</span> <span class="t">int</span> <span class="i">h</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="t">MyWidget</span> <span class="p">:</span> <span class="t">Widget</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="i">DrawString</span><span class="p">(</span><span class="s">&quot;MyWidget&quot;</span><span class="p">,</span> <span class="n">5</span><span class="p">,</span> <span class="n">3</span><span class="p">);</span>
        <span class="i">DrawRect</span><span class="p">(</span><span class="n">0</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="n">200</span><span class="p">,</span> <span class="n">20</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="t">int</span> <span class="i">x</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">x</span> <span class="o">&lt;</span> <span class="n">200</span><span class="p">;</span> <span class="i">x</span> <span class="o">+=</span> <span class="n">5</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="i">DrawLine</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="n">15</span><span class="p">,</span> <span class="i">x</span><span class="p">,</span> <span class="n">20</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="t">Widget</span>
<span class="p">{</span>
    <span class="c">// The external public API.</span>
    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">DrawContext</span> <span class="i">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c">// Store what we need to implement the atomic operations.</span>
        <span class="i">mContext</span> <span class="o">=</span> <span class="i">context</span><span class="p">;</span>

        <span class="c">// But don&#39;t give it to the sandbox.</span>
        <span class="i">DrawInternal</span><span class="p">();</span>

        <span class="c">// Done with it.</span>
        <span class="i">mContext</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c">// The sandbox.</span>
    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="i">DrawInternal</span><span class="p">();</span>

    <span class="k">protected</span> <span class="k">void</span> <span class="i">DrawString</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">,</span> <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>
    <span class="k">protected</span> <span class="k">void</span> <span class="i">DrawLine</span><span class="p">(</span><span class="t">int</span> <span class="i">x1</span><span class="p">,</span> <span class="t">int</span> <span class="i">y1</span><span class="p">,</span> <span class="t">int</span> <span class="i">x2</span><span class="p">,</span> <span class="t">int</span> <span class="i">y2</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>
    <span class="k">protected</span> <span class="k">void</span> <span class="i">DrawRect</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">int</span> <span class="i">w</span><span class="p">,</span> <span class="t">int</span> <span class="i">h</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>

    <span class="k">private</span> <span class="t">DrawContext</span> <span class="i">mContext</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">Widget</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="i">Widget</span><span class="p">(</span><span class="t">Action</span><span class="o">&lt;</span><span class="t">DrawOperations</span><span class="o">&gt;</span> <span class="i">drawFunc</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="i">mDrawFunc</span> <span class="o">=</span> <span class="i">drawFunc</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Draw</span><span class="p">(</span><span class="t">DrawContext</span> <span class="i">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="i">mDrawFunc</span><span class="p">(</span><span class="k">new</span> <span class="t">DrawOperations</span><span class="p">(</span><span class="i">context</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">class</span> <span class="t">DrawOperations</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="i">DrawOperations</span><span class="p">(</span><span class="t">DrawContext</span> <span class="i">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="i">mContext</span> <span class="o">=</span> <span class="i">context</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="i">DrawString</span><span class="p">(</span><span class="t">string</span> <span class="i">text</span><span class="p">,</span> <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="i">DrawLine</span><span class="p">(</span><span class="t">int</span> <span class="i">x1</span><span class="p">,</span> <span class="t">int</span> <span class="i">y1</span><span class="p">,</span> <span class="t">int</span> <span class="i">x2</span><span class="p">,</span> <span class="t">int</span> <span class="i">y2</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="i">DrawRect</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">,</span> <span class="t">int</span> <span class="i">w</span><span class="p">,</span> <span class="t">int</span> <span class="i">h</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* */</span> <span class="p">}</span>

        <span class="k">private</span> <span class="t">DrawContext</span> <span class="i">mContext</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="k">private</span> <span class="t">Action</span><span class="o">&lt;</span><span class="t">DrawOperations</span><span class="o">&gt;</span> <span class="i">mDrawFunc</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="t">Widget</span> <span class="i">MakeMyWidget</span><span class="p">()</span>
<span class="p">{</span>
    <span class="t">Widget</span> <span class="i">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Widget</span><span class="p">(</span>
        <span class="i">operations</span> <span class="o">=&gt;</span>
        <span class="p">{</span>
            <span class="i">operations</span><span class="p">.</span><span class="i">DrawString</span><span class="p">(</span><span class="s">&quot;MyWidget&quot;</span><span class="p">,</span> <span class="n">5</span><span class="p">,</span> <span class="n">3</span><span class="p">);</span>
            <span class="i">operations</span><span class="p">.</span><span class="i">DrawRect</span><span class="p">(</span><span class="n">0</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="n">200</span><span class="p">,</span> <span class="n">20</span><span class="p">);</span>

            <span class="k">for</span> <span class="p">(</span><span class="t">int</span> <span class="i">x</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">x</span> <span class="o">&lt;</span> <span class="n">200</span><span class="p">;</span> <span class="i">x</span> <span class="o">+=</span> <span class="n">5</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="i">operations</span><span class="p">.</span><span class="i">DrawLine</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="n">15</span><span class="p">,</span> <span class="i">x</span><span class="p">,</span> <span class="n">20</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="i">widget</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>2008/12/28/fixing-ambiguities-in-yacc</h2>

<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="n">1</span> <span class="o">+</span> <span class="n">2</span> <span class="o">+</span> <span class="n">3</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="n">1</span> <span class="o">+</span> <span class="n">2</span> <span class="o">*</span> <span class="n">3</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="n">123</span><span class="p">;</span>                <span class="c">// An int.</span>
<span class="i">foo</span> <span class="i">bar</span> <span class="n">1</span><span class="p">;</span>          <span class="c">// Pass 1 to bar, pass the result to foo.</span>
<span class="n">6</span> <span class="o">+</span> <span class="n">2</span> <span class="o">*</span> <span class="n">3</span> <span class="o">/</span> <span class="n">4</span><span class="p">;</span>      <span class="c">// Binary operators (result = 6).</span>
<span class="i">foo</span> <span class="n">1</span> <span class="o">+</span> <span class="i">bar</span> <span class="n">2</span><span class="p">;</span>      <span class="c">// Mix operators and functions.</span>
<span class="i">foo</span> <span class="p">(</span><span class="n">1</span> <span class="o">+</span> <span class="i">bar</span> <span class="n">2</span><span class="p">);</span>    <span class="c">// Parentheses for grouping.</span>
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>start:
    | Expression SEMI               { $1 }

Expression:
    | Primary                       { $1 }

Primary:
    | INT                           { Int $1 }
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Expression:
    | Primary                        { $1 }
    | Expression OPERATOR Expression { Operator ($1, $2, $3) }
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>start:
    | Expression SEMI               { $1 }

Expression:
    | Primary                       { $1 }
    | Expression OPERATOR Primary   { Operator ($1, $2, $3) }

Primary:
    | INT                           { Int $1 }
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Expression:
    | Primary                       { $1 }
    | FUNCTION Expression           { Function ($1, $2) }
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>start:
    | Expression SEMI               { $1 }

Expression:
    | Primary                       { $1 }
    | FUNCTION Expression           { Function ($1, $2) }
    | Expression OPERATOR Primary   { Operator ($1, $2, $3) }

Primary:
    | INT                           { Int $1 }
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>start:
    | Expression SEMI               { $1 }

Expression:
    | Primary                       { $1 }
    | Function                      { $1 }
    | Operator                      { $1 }

Operator:
    | Expression OPERATOR Function  { Operator ($1, $2, $3) }

Function:
    | FUNCTION Expression           { Function ($1, $2) }

Primary:
    | INT                           { Int $1 }
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>start:
    | Expression SEMI               { $1 }

Expression:
    | Operator                      { $1 }
    | Function                      { $1 }
    | Primary                       { $1 }

Operator:
    | Operator OPERATOR Function    { Operator ($1, $2, $3) }

Function:
    | FUNCTION Function             { Function ($1, $2) }

Primary:
    | INT                           { Int $1 }
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>start:
    | Expression SEMI               { $1 }

Expression:
    | Operator                      { $1 }

Operator:
    | Operator OPERATOR Function    { Operator ($1, $2, $3) }
    | Function                      { $1 }

Function:
    | FUNCTION Function             { Function ($1, $2) }
    | Primary                       { $1 }

Primary:
    | INT                           { Int $1 }
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>start:
    | Expression SEMI               { $1 }

Expression:
    | Operator                      { $1 }

Operator:
    | Operator OPERATOR Function    { Operator ($1, $2, $3) }
    | Function                      { $1 }

Function:
    | FUNCTION Function             { Function ($1, $2) }
    | Primary                       { $1 }

Primary:
    | INT                           { Int $1 }
    | LPAREN Expression RPAREN      { $2 }
</code></pre></div>
<h2>2009/01/03/debunking-c-vs-c-performance</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">unsafe</span> <span class="k">struct</span> <span class="t">Data</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">int</span> <span class="i">key</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">fixed</span> <span class="t">char</span> <span class="i">data</span><span class="p">[</span><span class="n">128</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">class</span> <span class="t">Data</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">int</span> <span class="i">key</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">char</span><span class="p">[]</span> <span class="i">data</span><span class="p">;</span>

    <span class="k">public</span> <span class="i">Data</span><span class="p">()</span> <span class="p">{</span> <span class="i">data</span> <span class="o">=</span> <span class="k">new</span> <span class="t">char</span><span class="p">[</span><span class="n">128</span><span class="p">];</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">using</span> <span class="i">System</span><span class="p">;</span>
<span class="k">using</span> <span class="i">System</span><span class="p">.</span><span class="i">Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="i">System</span><span class="p">.</span><span class="i">Collections</span><span class="p">.</span><span class="i">Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="i">System</span><span class="p">.</span><span class="i">Text</span><span class="p">;</span>
<span class="k">using</span> <span class="i">System</span><span class="p">.</span><span class="i">Runtime</span><span class="p">.</span><span class="i">InteropServices</span><span class="p">;</span>

<span class="k">namespace</span> <span class="i">CachePressureCS</span>
<span class="p">{</span>
    <span class="c">// normal c# type</span>
    <span class="k">class</span> <span class="t">Data</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="t">int</span> <span class="i">key</span><span class="p">;</span>
        <span class="k">public</span> <span class="t">char</span><span class="p">[]</span> <span class="i">data</span><span class="p">;</span>

        <span class="k">public</span> <span class="i">Data</span><span class="p">()</span> <span class="p">{</span> <span class="i">data</span> <span class="o">=</span> <span class="k">new</span> <span class="t">char</span><span class="p">[</span><span class="n">128</span><span class="p">];</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="t">DataComparer</span> <span class="p">:</span> <span class="t">IComparer</span>
    <span class="p">{</span>
        <span class="t">int</span> <span class="i">IComparer</span><span class="p">.</span><span class="i">Compare</span><span class="p">(</span><span class="t">Object</span> <span class="i">x</span><span class="p">,</span> <span class="t">Object</span> <span class="i">y</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">((</span><span class="t">Data</span><span class="p">)</span><span class="i">x</span><span class="p">).</span><span class="i">key</span> <span class="o">-</span> <span class="p">((</span><span class="t">Data</span><span class="p">)</span><span class="i">y</span><span class="p">).</span><span class="i">key</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="t">DataComparerT</span> <span class="p">:</span> <span class="t">IComparer</span><span class="o">&lt;</span><span class="t">Data</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="t">int</span> <span class="i">Compare</span><span class="p">(</span><span class="t">Data</span> <span class="i">x</span><span class="p">,</span> <span class="t">Data</span> <span class="i">y</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="i">x</span><span class="p">.</span><span class="i">key</span> <span class="o">-</span> <span class="i">y</span><span class="p">.</span><span class="i">key</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="t">Timer</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="a">DllImport</span><span class="p">(</span><span class="s">&quot;Kernel32.dll&quot;</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="t">bool</span> <span class="i">QueryPerformanceCounter</span><span class="p">(</span>
            <span class="k">out</span> <span class="t">long</span> <span class="i">counter</span><span class="p">);</span>

        <span class="p">[</span><span class="a">DllImport</span><span class="p">(</span><span class="s">&quot;Kernel32.dll&quot;</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="t">bool</span> <span class="i">QueryPerformanceFrequency</span><span class="p">(</span>
            <span class="k">out</span> <span class="t">long</span> <span class="i">frequency</span><span class="p">);</span>

        <span class="k">public</span> <span class="i">Timer</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="i">mStart</span> <span class="o">=</span> <span class="i">mEnd</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
            <span class="i">QueryPerformanceFrequency</span><span class="p">(</span><span class="k">out</span> <span class="i">mFrequency</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="i">Start</span><span class="p">()</span> <span class="p">{</span> <span class="i">QueryPerformanceCounter</span><span class="p">(</span><span class="k">out</span> <span class="i">mStart</span><span class="p">);</span> <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="i">End</span><span class="p">()</span> <span class="p">{</span> <span class="i">QueryPerformanceCounter</span><span class="p">(</span><span class="k">out</span> <span class="i">mEnd</span><span class="p">);</span> <span class="p">}</span>

        <span class="k">public</span> <span class="t">double</span> <span class="i">Time</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">1000.0</span> <span class="o">*</span> <span class="p">(</span><span class="t">double</span><span class="p">)(</span><span class="i">mEnd</span> <span class="o">-</span> <span class="i">mStart</span><span class="p">)</span> <span class="o">/</span>
                    <span class="p">(</span><span class="t">double</span><span class="p">)</span><span class="i">mFrequency</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="t">long</span> <span class="i">mFrequency</span><span class="p">;</span>
        <span class="t">long</span> <span class="i">mStart</span><span class="p">;</span>
        <span class="t">long</span> <span class="i">mEnd</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="t">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="t">int</span> <span class="i">CompareData</span><span class="p">(</span><span class="t">Data</span> <span class="i">x</span><span class="p">,</span> <span class="t">Data</span> <span class="i">y</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="i">x</span><span class="p">.</span><span class="i">key</span> <span class="o">-</span> <span class="i">y</span><span class="p">.</span><span class="i">key</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="t">Data</span><span class="p">[]</span> <span class="i">MakeData</span><span class="p">(</span><span class="t">int</span> <span class="i">size</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="t">Random</span> <span class="i">rng</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Random</span><span class="p">(</span><span class="n">0</span><span class="p">);</span>
            <span class="t">Data</span><span class="p">[]</span> <span class="i">data</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Data</span><span class="p">[</span><span class="i">size</span><span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">i</span> <span class="o">&lt;</span> <span class="i">data</span><span class="p">.</span><span class="i">Length</span><span class="p">;</span> <span class="i">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="i">data</span><span class="p">[</span><span class="i">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Data</span><span class="p">();</span>
                <span class="i">data</span><span class="p">[</span><span class="i">i</span><span class="p">].</span><span class="i">key</span> <span class="o">=</span> <span class="i">rng</span><span class="p">.</span><span class="i">Next</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="i">data</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="t">double</span> <span class="i">Test</span><span class="p">(</span><span class="t">int</span> <span class="i">size</span><span class="p">,</span> <span class="t">Action</span><span class="o">&lt;</span><span class="t">Data</span><span class="p">[]</span><span class="o">&gt;</span> <span class="i">sort</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="t">Timer</span> <span class="i">time</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Timer</span><span class="p">();</span>
            <span class="t">Data</span><span class="p">[]</span> <span class="i">data</span> <span class="o">=</span> <span class="i">MakeData</span><span class="p">(</span><span class="i">size</span><span class="p">);</span>

            <span class="i">time</span><span class="p">.</span><span class="i">Start</span><span class="p">();</span>
            <span class="i">sort</span><span class="p">(</span><span class="i">data</span><span class="p">);</span>
            <span class="i">time</span><span class="p">.</span><span class="i">End</span><span class="p">();</span>

            <span class="k">return</span> <span class="i">time</span><span class="p">.</span><span class="i">Time</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="t">double</span> <span class="i">SortTest</span><span class="p">(</span><span class="t">int</span> <span class="i">size</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="i">Test</span><span class="p">(</span><span class="i">size</span><span class="p">,</span> <span class="i">data</span> <span class="o">=&gt;</span>
                <span class="i">Array</span><span class="p">.</span><span class="i">Sort</span><span class="p">(</span><span class="i">data</span><span class="p">,</span> <span class="k">new</span> <span class="t">DataComparer</span><span class="p">()));</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="t">double</span> <span class="i">SortTestT</span><span class="p">(</span><span class="t">int</span> <span class="i">size</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="i">Test</span><span class="p">(</span><span class="i">size</span><span class="p">,</span> <span class="i">data</span> <span class="o">=&gt;</span>
                <span class="i">Array</span><span class="p">.</span><span class="i">Sort</span><span class="o">&lt;</span><span class="t">Data</span><span class="o">&gt;</span><span class="p">(</span><span class="i">data</span><span class="p">,</span> <span class="k">new</span> <span class="t">DataComparerT</span><span class="p">()));</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="t">double</span> <span class="i">SortTestTC</span><span class="p">(</span><span class="t">int</span> <span class="i">size</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="i">Test</span><span class="p">(</span><span class="i">size</span><span class="p">,</span> <span class="i">data</span> <span class="o">=&gt;</span>
                <span class="i">Array</span><span class="p">.</span><span class="i">Sort</span><span class="o">&lt;</span><span class="t">Data</span><span class="o">&gt;</span><span class="p">(</span><span class="i">data</span><span class="p">,</span> <span class="i">CompareData</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="t">double</span> <span class="i">SortTestC</span><span class="p">(</span><span class="t">int</span> <span class="i">size</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="i">Test</span><span class="p">(</span><span class="i">size</span><span class="p">,</span> <span class="i">data</span> <span class="o">=&gt;</span>
                <span class="i">Array</span><span class="p">.</span><span class="i">Sort</span><span class="p">(</span><span class="i">data</span><span class="p">,</span> <span class="i">CompareData</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="t">double</span> <span class="i">SortTestIndirect</span><span class="p">(</span><span class="t">int</span> <span class="i">size</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="t">Random</span> <span class="i">rng</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Random</span><span class="p">(</span><span class="n">0</span><span class="p">);</span>
            <span class="t">Timer</span> <span class="i">time</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Timer</span><span class="p">();</span>
            <span class="t">Data</span><span class="p">[]</span> <span class="i">data</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Data</span><span class="p">[</span><span class="i">size</span><span class="p">];</span>
            <span class="t">int</span><span class="p">[]</span> <span class="i">indirect</span> <span class="o">=</span> <span class="k">new</span> <span class="t">int</span><span class="p">[</span><span class="i">size</span><span class="p">];</span>

            <span class="k">for</span> <span class="p">(</span><span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">i</span> <span class="o">&lt;</span> <span class="i">data</span><span class="p">.</span><span class="i">Length</span><span class="p">;</span> <span class="i">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="i">data</span><span class="p">[</span><span class="i">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Data</span><span class="p">();</span>
                <span class="i">data</span><span class="p">[</span><span class="i">i</span><span class="p">].</span><span class="i">key</span> <span class="o">=</span> <span class="i">rng</span><span class="p">.</span><span class="i">Next</span><span class="p">();</span>
                <span class="i">indirect</span><span class="p">[</span><span class="i">i</span><span class="p">]</span> <span class="o">=</span> <span class="i">data</span><span class="p">[</span><span class="i">i</span><span class="p">].</span><span class="i">key</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="i">time</span><span class="p">.</span><span class="i">Start</span><span class="p">();</span>
            <span class="i">Array</span><span class="p">.</span><span class="i">Sort</span><span class="o">&lt;</span><span class="t">int</span><span class="p">,</span> <span class="t">Data</span><span class="o">&gt;</span><span class="p">(</span><span class="i">indirect</span><span class="p">,</span> <span class="i">data</span><span class="p">);</span>
            <span class="i">time</span><span class="p">.</span><span class="i">End</span><span class="p">();</span>

            <span class="k">return</span> <span class="i">time</span><span class="p">.</span><span class="i">Time</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="i">Time</span><span class="p">(</span><span class="t">Func</span><span class="o">&lt;</span><span class="t">int</span><span class="p">,</span> <span class="t">double</span><span class="o">&gt;</span> <span class="i">fn</span><span class="p">,</span> <span class="t">int</span> <span class="i">size</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="t">double</span> <span class="i">time</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="t">int</span> <span class="i">j</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">j</span> <span class="o">&lt;</span> <span class="n">10</span><span class="p">;</span> <span class="i">j</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="i">time</span> <span class="o">+=</span> <span class="i">fn</span><span class="p">(</span><span class="i">size</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="i">time</span> <span class="o">/=</span> <span class="n">10.0</span><span class="p">;</span>

            <span class="i">Console</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;{0,14:F4}&quot;</span><span class="p">,</span> <span class="i">time</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">static</span> <span class="k">void</span> <span class="i">Main</span><span class="p">(</span><span class="t">string</span><span class="p">[]</span> <span class="i">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="i">Console</span><span class="p">.</span><span class="i">WriteLine</span><span class="p">(</span><span class="s">&quot;    size      SortTest     SortTestT&quot;</span> <span class="o">+</span>
                <span class="s">&quot;    SortTestTC  SortIndirect&quot;</span><span class="p">);</span>
            <span class="i">Console</span><span class="p">.</span><span class="i">WriteLine</span><span class="p">(</span><span class="s">&quot;-------- ------------- &quot;</span> <span class="o">+</span>
                <span class="s">&quot;------------- ------------- -------------&quot;</span><span class="p">);</span>

            <span class="k">for</span> <span class="p">(</span><span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="p">;</span> <span class="i">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="t">int</span> <span class="i">size</span> <span class="o">=</span> <span class="n">1024</span> <span class="o">&lt;&lt;</span> <span class="i">i</span><span class="p">;</span>

                <span class="i">Console</span><span class="p">.</span><span class="i">Write</span><span class="p">(</span><span class="s">&quot;{0,8}&quot;</span><span class="p">,</span> <span class="i">size</span><span class="p">);</span>
                <span class="i">Time</span><span class="p">(</span><span class="i">SortTest</span><span class="p">,</span> <span class="i">size</span><span class="p">);</span>
                <span class="i">Time</span><span class="p">(</span><span class="i">SortTestT</span><span class="p">,</span> <span class="i">size</span><span class="p">);</span>
                <span class="i">Time</span><span class="p">(</span><span class="i">SortTestTC</span><span class="p">,</span> <span class="i">size</span><span class="p">);</span>
                <span class="i">Time</span><span class="p">(</span><span class="i">SortTestIndirect</span><span class="p">,</span> <span class="i">size</span><span class="p">);</span>

                <span class="i">Console</span><span class="p">.</span><span class="i">WriteLine</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="i">Console</span><span class="p">.</span><span class="i">ReadKey</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2009/04/26/stupid-magpie-tricks-or-yes-im-making-a-programming-language-like-everyone-else</h2>

<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="c">// Define a type.</span>
<span class="k">struct</span> <span class="t">Point</span>
    <span class="i">X</span> <span class="t">Int</span>
    <span class="i">Y</span> <span class="t">Int</span>
<span class="k">end</span>

<span class="i">Main</span> <span class="p">(</span><span class="o">-&gt;</span><span class="p">)</span>
    <span class="c">// Pass the constructor to a function.</span>
    <span class="i">TakeRef</span> <span class="k">fn</span> <span class="t">Point</span> <span class="p">(</span><span class="t">Int</span><span class="p">,</span> <span class="t">Int</span><span class="p">)</span>
<span class="k">end</span>

<span class="i">TakeRef</span> <span class="p">(</span><span class="i">func</span> <span class="k">fn</span> <span class="p">(</span><span class="t">Int</span><span class="p">,</span> <span class="t">Int</span> <span class="p">-&gt;</span> <span class="t">Point</span><span class="p">))</span>
    <span class="c">// Call the reference.</span>
    <span class="k">def</span> <span class="i">point</span> <span class="o">&lt;-</span> <span class="i">func</span> <span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">)</span>

    <span class="i">Print</span> <span class="p">(</span><span class="i">point</span><span class="p">.</span><span class="i">X</span><span class="p">.</span><span class="i">String</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="i">point</span><span class="p">.</span><span class="i">Y</span><span class="p">.</span><span class="i">String</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="c">// Define a function that takes three arguments.</span>
<span class="i">Sum</span> <span class="p">(</span><span class="i">a</span> <span class="t">Int</span><span class="p">,</span> <span class="i">b</span> <span class="t">Int</span><span class="p">,</span> <span class="i">c</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">Int</span><span class="p">)</span> <span class="i">a</span> <span class="o">+</span> <span class="i">b</span> <span class="o">+</span> <span class="i">c</span>

<span class="i">Main</span> <span class="p">(</span><span class="o">-&gt;</span><span class="p">)</span>
    <span class="c">// Calling it looks pretty normal...</span>
    <span class="k">def</span> <span class="i">a</span> <span class="o">&lt;-</span> <span class="i">Sum</span> <span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">)</span>

    <span class="c">// But you can also do this:</span>
    <span class="k">def</span> <span class="i">tuple</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="i">b</span> <span class="o">&lt;-</span> <span class="i">Sum</span> <span class="i">tuple</span>
    <span class="i">Print</span> <span class="i">b</span><span class="p">.</span><span class="i">String</span>

    <span class="c">// Or this:</span>
    <span class="k">def</span> <span class="i">tuple2</span> <span class="o">&lt;-</span> <span class="i">GetArgs</span>
    <span class="k">def</span> <span class="i">c</span> <span class="o">&lt;-</span> <span class="i">Sum</span> <span class="i">tuple2</span>
    <span class="i">Print</span> <span class="i">c</span><span class="p">.</span><span class="i">String</span>
<span class="k">end</span>

<span class="c">// This function returns a tuple.</span>
<span class="i">GetArgs</span> <span class="p">(</span><span class="o">-&gt;</span> <span class="p">(</span><span class="t">Int</span><span class="p">,</span> <span class="t">Int</span><span class="p">,</span> <span class="t">Int</span><span class="p">))</span> <span class="p">(</span><span class="n">4</span><span class="p">,</span> <span class="n">5</span><span class="p">,</span> <span class="n">6</span><span class="p">)</span>
</code></pre></div>
<h2>2009/05/05/one-and-only-one</h2>

<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">Square</span> <span class="p">(</span><span class="i">n</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">Int</span><span class="p">)</span> <span class="i">n</span> <span class="o">*</span> <span class="i">n</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">Square</span> <span class="n">3</span> <span class="c">// Returns 9.</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">Mult</span> <span class="p">(</span><span class="i">a</span> <span class="t">Int</span><span class="p">,</span> <span class="i">b</span> <span class="t">Int</span><span class="p">,</span> <span class="i">c</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">Int</span><span class="p">)</span> <span class="i">a</span> <span class="o">*</span> <span class="i">b</span> <span class="o">*</span> <span class="i">c</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">Mult</span> <span class="p">(</span><span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">)</span> <span class="c">// Returns 24.</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">)</span>             <span class="c">// A tuple of two Int fields.</span>
<span class="p">(</span><span class="n">2</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">)</span> <span class="c">// A tuple of three fields of different type.</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="c">// Create a local variable and assign a tuple to it.</span>
<span class="k">def</span> <span class="i">arg</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">)</span>

<span class="c">// Pass the single argument to the function.</span>
<span class="i">Mult</span> <span class="i">arg</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">SayHi</span> <span class="p">(</span><span class="o">-&gt;</span><span class="p">)</span> <span class="i">Print</span> <span class="s">&quot;hi!&quot;</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">SayHi</span> <span class="p">()</span> <span class="c">// Prints &quot;hi&quot;.</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">SayHi</span> <span class="c">// Prints &quot;hi&quot;.</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">Square</span> <span class="p">(</span><span class="k">if</span> <span class="n">1</span> <span class="o">&lt;</span> <span class="n">2</span> <span class="k">then</span> <span class="n">3</span> <span class="k">else</span> <span class="n">4</span><span class="p">)</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="i">Swap</span> <span class="p">(</span><span class="i">a</span> <span class="t">Int</span><span class="p">,</span> <span class="i">b</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="t">Int</span><span class="p">,</span> <span class="t">Int</span><span class="p">))</span> <span class="p">(</span><span class="i">b</span><span class="p">,</span> <span class="i">a</span><span class="p">)</span>

<span class="i">Swap</span> <span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">)</span> <span class="c">// returns (2, 1)</span>
</code></pre></div>
<h2>2009/05/13/ml-style-pattern-matching-in-c</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="n">2</span><span class="p">;</span>
<span class="k">switch</span> <span class="p">(</span><span class="i">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">case</span> <span class="n">0</span><span class="p">:</span>  <span class="i">Print</span><span class="p">(</span><span class="s">&quot;zero&quot;</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">1</span><span class="p">:</span>  <span class="i">Print</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">2</span><span class="p">:</span>  <span class="i">Print</span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">);</span>
    <span class="k">default</span><span class="p">:</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;some other value&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>fsharp</p>
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="k">let</span> <span class="i">i</span> <span class="o">=</span> <span class="n">2</span>
<span class="k">match</span> <span class="i">i</span> <span class="k">with</span>
<span class="o">|</span> <span class="n">0</span> <span class="o">-&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;zero&quot;</span><span class="p">)</span>
<span class="o">|</span> <span class="n">1</span> <span class="o">-&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">)</span>
<span class="o">|</span> <span class="n">2</span> <span class="o">-&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">)</span>
<span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;some other value&quot;</span><span class="p">)</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">enum</span> <span class="t">ImageMacro</span>
<span class="p">{</span>
    <span class="i">Lolcat</span><span class="p">,</span>
    <span class="i">Lolrus</span><span class="p">,</span>
    <span class="i">ORlyOwl</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">abstract</span> <span class="k">class</span> <span class="t">ImageMacro</span> <span class="p">{</span> <span class="p">}</span>

<span class="k">class</span> <span class="t">Lolcat</span> <span class="p">:</span> <span class="t">ImageMacro</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">string</span> <span class="i">Caption</span><span class="p">;</span>
    <span class="k">public</span> <span class="i">Lolcat</span><span class="p">(</span><span class="t">string</span> <span class="i">caption</span><span class="p">)</span> <span class="p">{</span> <span class="i">Caption</span> <span class="o">=</span> <span class="i">caption</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">Lolrus</span> <span class="p">:</span> <span class="t">ImageMacro</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">int</span> <span class="i">Buckets</span><span class="p">;</span>
    <span class="k">public</span> <span class="i">Lolrus</span><span class="p">(</span><span class="t">int</span> <span class="i">buckets</span><span class="p">)</span> <span class="p">{</span> <span class="i">Buckets</span> <span class="o">=</span> <span class="i">buckets</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">ORlyOwl</span> <span class="p">:</span> <span class="t">ImageMacro</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
<p>fsharp</p>
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="k">type</span> <span class="i">ImageMacro</span> <span class="o">=</span>
    <span class="o">|</span> <span class="i">Lolcat</span>    <span class="k">of</span> <span class="i">string</span>
    <span class="o">|</span> <span class="i">Lolrus</span>    <span class="k">of</span> <span class="i">int</span>
    <span class="o">|</span> <span class="i">ORlyOwl</span>
</code></pre></div>
<p>fsharp</p>
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="k">let</span> <span class="i">image</span> <span class="o">=</span> <span class="i">Lolcat</span><span class="p">(</span><span class="s">&quot;I made you a cookie&quot;</span><span class="p">)</span>
<span class="k">match</span> <span class="i">image</span> <span class="k">with</span>
<span class="o">|</span> <span class="i">Lolcat</span><span class="p">(</span><span class="i">caption</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;Lolcat says &#39;&quot;</span> <span class="o">+</span> <span class="i">caption</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
<span class="o">|</span> <span class="i">Lolrus</span><span class="p">(</span><span class="i">buckets</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;Lolrus has &quot;</span> <span class="o">+</span> <span class="i">buckets</span> <span class="o">+</span> <span class="s">&quot; buckets&quot;</span><span class="p">)</span>
<span class="o">|</span> <span class="i">ORlyOwn</span>         <span class="o">-&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;O RLY?&quot;</span><span class="p">)</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">ImageMacro</span> <span class="i">image</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Lolcat</span><span class="p">(</span><span class="s">&quot;I made you a cookie&quot;</span><span class="p">);</span>
<span class="i">Pattern</span><span class="p">.</span><span class="i">Match</span><span class="p">(</span><span class="i">image</span><span class="p">).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">Lolcat</span><span class="p">,</span> <span class="t">string</span><span class="o">&gt;</span> <span class="p">(</span><span class="i">c</span>  <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;Lolcat says &#39;&quot;</span> <span class="o">+</span> <span class="i">c</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">Lolrus</span><span class="p">,</span> <span class="t">int</span><span class="o">&gt;</span>    <span class="p">(</span><span class="i">b</span>  <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;I has &quot;</span> <span class="o">+</span> <span class="i">b</span> <span class="o">+</span> <span class="s">&quot; buckets&quot;</span><span class="p">)).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">ORlyOwl</span><span class="o">&gt;</span>        <span class="p">(()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;O RLY?&quot;</span><span class="p">));</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">Matcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="i">Matcher</span><span class="p">(</span><span class="t">T</span> <span class="i">value</span><span class="p">)</span> <span class="p">{</span> <span class="i">mValue</span> <span class="o">=</span> <span class="i">value</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="t">Case</span><span class="o">&lt;</span><span class="t">TCase</span><span class="o">&gt;</span><span class="p">(</span><span class="t">Action</span> <span class="i">action</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">mValue</span> <span class="k">is</span> <span class="t">TCase</span><span class="p">)</span> <span class="i">action</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="t">T</span> <span class="i">mValue</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="p">()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;O RLY?&quot;</span><span class="p">)</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="t">Matcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="t">Case</span><span class="o">&lt;</span><span class="t">TCase</span><span class="o">&gt;</span><span class="p">(</span><span class="t">Action</span> <span class="i">action</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">mValue</span> <span class="k">is</span> <span class="t">TCase</span><span class="p">)</span> <span class="i">action</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">virtual</span> <span class="t">Matcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="t">Case</span><span class="o">&lt;</span><span class="t">TCase</span><span class="o">&gt;</span><span class="p">(</span><span class="t">Action</span> <span class="i">action</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">mValue</span> <span class="k">is</span> <span class="t">TCase</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="i">action</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="t">NullMatcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="t">NullMatcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="p">:</span> <span class="t">Matcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="t">Matcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="t">Case</span><span class="o">&lt;</span><span class="t">TCase</span><span class="o">&gt;</span><span class="p">(</span><span class="t">Action</span> <span class="i">action</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">Pattern</span><span class="p">.</span><span class="i">Match</span><span class="p">(</span><span class="i">image</span><span class="p">).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">Lolcat</span><span class="o">&gt;</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;Lolcat says &#39;?&#39;&quot;</span><span class="p">)).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">Lolrus</span><span class="o">&gt;</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;Lolrus has ? buckets&quot;</span><span class="p">)).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">ORlyOwl</span><span class="o">&gt;</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;O RLY?&quot;</span><span class="p">));</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">public</span> <span class="k">virtual</span> <span class="t">Matcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="t">Case</span><span class="o">&lt;</span><span class="t">TCase</span><span class="p">,</span> <span class="t">TArg</span><span class="o">&gt;</span><span class="p">(</span><span class="t">Action</span><span class="o">&lt;</span><span class="t">TArg</span><span class="o">&gt;</span> <span class="i">action</span><span class="p">)</span>
<span class="p">{</span>
    <span class="t">IMatchable</span><span class="o">&lt;</span><span class="t">TArg</span><span class="o">&gt;</span> <span class="i">matchable</span> <span class="o">=</span> <span class="i">mValue</span> <span class="k">as</span> <span class="t">IMatchable</span><span class="o">&lt;</span><span class="t">TArg</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="i">matchable</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="i">mValue</span> <span class="k">is</span> <span class="t">TCase</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="i">action</span><span class="p">(</span><span class="i">matchable</span><span class="p">.</span><span class="i">GetArg</span><span class="p">());</span>
        <span class="k">return</span> <span class="k">new</span> <span class="t">NullMatcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">interface</span> <span class="t">IMatchable</span><span class="o">&lt;</span><span class="t">TArg</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="t">TArg</span> <span class="i">GetArg</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">Lolcat</span> <span class="p">:</span> <span class="t">ImageMacro</span><span class="p">,</span> <span class="t">IMatchable</span><span class="o">&lt;</span><span class="t">string</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">string</span> <span class="i">Caption</span><span class="p">;</span>
    <span class="k">public</span> <span class="i">Lolcat</span><span class="p">(</span><span class="t">string</span> <span class="i">caption</span><span class="p">)</span> <span class="p">{</span> <span class="i">Caption</span> <span class="o">=</span> <span class="i">caption</span><span class="p">;</span> <span class="p">}</span>

    <span class="t">string</span> <span class="t">IMatchable</span><span class="o">&lt;</span><span class="t">string</span><span class="o">&gt;</span><span class="p">.</span><span class="i">GetArg</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="i">Caption</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">Lolrus</span> <span class="p">:</span> <span class="t">ImageMacro</span><span class="p">,</span> <span class="t">IMatchable</span><span class="o">&lt;</span><span class="t">int</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">int</span> <span class="i">NumBuckets</span><span class="p">;</span>
    <span class="k">public</span> <span class="i">Lolrus</span><span class="p">(</span><span class="t">int</span> <span class="i">numBuckets</span><span class="p">)</span> <span class="p">{</span> <span class="i">NumBuckets</span> <span class="o">=</span> <span class="i">numBuckets</span><span class="p">;</span> <span class="p">}</span>

    <span class="t">int</span> <span class="t">IMatchable</span><span class="o">&lt;</span><span class="t">int</span><span class="o">&gt;</span><span class="p">.</span><span class="i">GetArg</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="i">NumBuckets</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">Pattern</span><span class="p">.</span><span class="i">Match</span><span class="p">(</span><span class="i">image</span><span class="p">)</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">class</span> <span class="t">Pattern</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">Matcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="t">Match</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="t">T</span> <span class="i">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="t">Matcher</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span><span class="p">(</span><span class="i">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">Pattern</span><span class="p">.</span><span class="i">Match</span><span class="p">(</span><span class="i">image</span><span class="p">).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">Lolcat</span><span class="p">,</span> <span class="t">string</span><span class="o">&gt;</span><span class="p">(</span><span class="i">c</span>  <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;Lolcat says &#39;&quot;</span> <span class="o">+</span> <span class="i">c</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">)).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">Lolrus</span><span class="p">,</span> <span class="t">int</span><span class="o">&gt;</span>   <span class="p">(</span><span class="i">b</span>  <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;I has &quot;</span> <span class="o">+</span> <span class="i">b</span> <span class="o">+</span> <span class="s">&quot; buckets&quot;</span><span class="p">)).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">ORlyOwl</span><span class="o">&gt;</span>       <span class="p">(()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;O RLY?&quot;</span><span class="p">));</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">Case</span><span class="o">&lt;</span><span class="t">Loldog</span><span class="p">,</span> <span class="t">string</span><span class="p">,</span> <span class="t">int</span><span class="o">&gt;</span> <span class="p">((</span><span class="i">caption</span><span class="p">,</span> <span class="i">dogs</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="i">Print</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="i">caption</span> <span class="o">+</span> <span class="s">&quot;&#39;, says &quot;</span> <span class="o">+</span> <span class="i">dogs</span> <span class="o">+</span> <span class="s">&quot; hotdogs&quot;</span><span class="p">)).</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">Pattern</span><span class="p">.</span><span class="i">Match</span><span class="p">(</span><span class="i">image</span><span class="p">).</span>
    <span class="t">Case</span><span class="o">&lt;</span><span class="t">Lolrus</span><span class="p">,</span> <span class="t">int</span><span class="o">&gt;</span> <span class="p">(</span><span class="i">b</span>  <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;I has &quot;</span> <span class="o">+</span> <span class="i">buckets</span> <span class="o">+</span> <span class="s">&quot; buckets&quot;</span><span class="p">)).</span>
    <span class="i">Default</span>           <span class="p">(()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">));</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">Pattern</span><span class="p">.</span><span class="i">Match</span><span class="p">(</span><span class="s">&quot;a string&quot;</span><span class="p">).</span>
    <span class="i">Case</span><span class="p">(</span><span class="s">&quot;not&quot;</span><span class="p">,</span>      <span class="p">()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;should not match&quot;</span><span class="p">)).</span>
    <span class="i">Case</span><span class="p">(</span><span class="s">&quot;a string&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;should match&quot;</span><span class="p">));</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="i">Pattern</span><span class="p">.</span><span class="i">Match</span><span class="p">(</span><span class="n">123</span><span class="p">).</span>
    <span class="i">Case</span><span class="p">(</span><span class="i">value</span> <span class="o">=&gt;</span> <span class="i">value</span> <span class="o">&lt;</span> <span class="n">100</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;less than 100&quot;</span><span class="p">)).</span>
    <span class="i">Case</span><span class="p">(</span><span class="i">value</span> <span class="o">=&gt;</span> <span class="i">value</span> <span class="o">&gt;</span> <span class="n">100</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="i">Print</span><span class="p">(</span><span class="s">&quot;greater than 100&quot;</span><span class="p">));</span>
</code></pre></div>
<p>fsharp</p>
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c">// F#:</span>
<span class="k">let</span> <span class="i">isTwo</span> <span class="o">=</span> <span class="k">match</span> <span class="n">2</span> <span class="k">with</span>
            <span class="o">|</span> <span class="n">2</span> <span class="o">-&gt;</span> <span class="k">true</span>
            <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="k">false</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="c">// C#:</span>
<span class="t">bool</span> <span class="i">isTwo</span><span class="p">;</span>
<span class="k">switch</span> <span class="p">(</span><span class="n">2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">case</span> <span class="n">2</span><span class="p">:</span>  <span class="i">isTwo</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">default</span><span class="p">:</span> <span class="i">isTwo</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">bool</span> <span class="i">isTwo</span> <span class="o">=</span> <span class="i">Pattern</span><span class="p">.</span><span class="i">Match</span><span class="o">&lt;</span><span class="t">int</span><span class="p">,</span> <span class="t">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">2</span><span class="p">).</span>
                 <span class="i">Case</span><span class="p">(</span><span class="n">2</span><span class="p">,</span>  <span class="k">true</span><span class="p">).</span>
                 <span class="i">Default</span><span class="p">(</span> <span class="k">false</span><span class="p">);</span>
</code></pre></div>
<h2>2009/05/15/loops-in-magpie</h2>

<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="k">for</span> <span class="x">&lt;var&gt;</span> <span class="o">&lt;-</span> <span class="x">&lt;generator&gt;</span> <span class="k">do</span>
    <span class="p">...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="c">// Evaluate the generator expression once.</span>
<span class="k">def</span> <span class="i">_generator</span> <span class="o">&lt;-</span> <span class="i">Generate</span> <span class="x">&lt;generator&gt;</span>

<span class="c">// Advance to the first item.</span>
<span class="i">_generator</span><span class="p">.</span><span class="i">MoveNext</span>
<span class="k">while</span> <span class="i">Not</span> <span class="i">_generator</span><span class="p">.</span><span class="i">IsDone</span> <span class="k">do</span>
    <span class="k">def</span> <span class="x">&lt;var&gt;</span> <span class="o">&lt;-</span> <span class="i">_generator</span><span class="p">.</span><span class="i">Current</span>
    <span class="p">...</span>
    <span class="i">_generator</span><span class="p">.</span><span class="i">MoveNext</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="c">// Iterating through a collection.</span>
<span class="k">for</span> <span class="i">item</span> <span class="o">&lt;-</span> <span class="i">someList</span> <span class="k">do</span>
    <span class="i">Print</span> <span class="i">item</span>
<span class="k">end</span>

<span class="c">// Iterating multiple collections in lockstep.</span>
<span class="k">for</span> <span class="i">a</span> <span class="o">&lt;-</span> <span class="i">someList1</span>
<span class="k">for</span> <span class="i">b</span> <span class="o">&lt;-</span> <span class="i">someList2</span> <span class="k">do</span>
    <span class="i">Print</span> <span class="p">(</span><span class="i">a</span> <span class="o">==</span> <span class="i">b</span><span class="p">).</span><span class="i">String</span>
<span class="k">end</span>

<span class="c">// Iterating backwards.</span>
<span class="k">for</span> <span class="i">item</span> <span class="o">&lt;-</span> <span class="i">Reverse</span> <span class="i">someList</span>
    <span class="i">Print</span> <span class="i">item</span>
<span class="k">end</span>

<span class="c">// Assigning to array elements.</span>
<span class="k">for</span> <span class="i">index</span> <span class="o">&lt;-</span> <span class="i">array</span><span class="p">.</span><span class="i">Indexes</span>
    <span class="i">array</span><span class="p">.</span><span class="i">index</span> <span class="o">&lt;-</span> <span class="n">0</span>
<span class="k">end</span>

<span class="c">// Iterating a fixed number of times.</span>
<span class="k">for</span> <span class="i">i</span> <span class="o">&lt;-</span> <span class="n">50.</span><span class="i">Times</span>
    <span class="i">Print</span> <span class="i">i</span><span class="p">.</span><span class="i">String</span>
<span class="k">end</span>

<span class="c">// Iterating through a range.</span>
<span class="k">for</span> <span class="i">i</span> <span class="o">&lt;-</span> <span class="i">Range</span> <span class="p">(</span><span class="n">10</span><span class="p">,</span> <span class="n">30</span><span class="p">)</span>
    <span class="i">Print</span> <span class="i">i</span><span class="p">.</span><span class="i">String</span>
<span class="k">end</span>
</code></pre></div>
<h2>2009/06/05/naming-things-in-code</h2>

<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  Happy
Good: Happiness
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  SystemOnlineMessage
Good: System::Online::Message
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  IAbstractFactoryPatternBase
Good: IFactory
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  ConnectionManager
      XmlHelper
Good: Connection
      XmlDocument, XmlNode, etc.
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  IncomingMessageQueue
      CharacterArray
      SpatialOrganizer
Good: Mailbox
      String
      Map
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  Mailbox, DestinationID
Good: Mailbox, Address
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  list.GetNumberOfItems();
Good: list.Count();
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  list.Verify();
Good: list.ContainsNull();
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  list.Srt();
Good: list.Sort();
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  obj.RefCount();
Good: list.Clear();
      list.Sort();
      obj.AddReference();
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  list.Empty();
Good: list.IsEmpty();
      list.Contains(item);
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  list.GetCount();
Good: list.Count();
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  list.AddItem(item);
      handler.ReceiveMessage(msg);
Good: list.Add(item);
      handler.Receive(msg);
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  list.AddToList(item);
Good: list.Add(item);
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  list.GetCountInt();
Good: list.GetCount();
      message.GetIntValue();
      message.GetFloatValue();
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Bad:  mail.VerifyAddressAndSendStatus();
Good: mail.VerifyAddress();
      mail.SendStatus();
</code></pre></div>
<h2>2009/07/02/closures-and-the-command-pattern</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">interface</span> <span class="t">ICommand</span>
<span class="p">{</span>
    <span class="k">void</span> <span class="i">Invoke</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">MovePieceCommand</span> <span class="p">:</span> <span class="t">ICommand</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">Piece</span> <span class="i">Piece</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">int</span>   <span class="i">X</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">int</span>   <span class="i">Y</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Invoke</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="i">Piece</span><span class="p">.</span><span class="i">MoveTo</span><span class="p">(</span><span class="i">X</span><span class="p">,</span> <span class="i">Y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">static</span> <span class="k">class</span> <span class="t">Commands</span>
<span class="p">{</span>
    <span class="c">// Create a command to move a piece.</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">ICommand</span> <span class="i">MovePiece</span><span class="p">(</span><span class="t">Piece</span> <span class="i">piece</span><span class="p">,</span> <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">var</span> <span class="i">command</span> <span class="o">=</span> <span class="k">new</span> <span class="t">MovePieceCommand</span><span class="p">();</span>
        <span class="i">command</span><span class="p">.</span><span class="i">Piece</span> <span class="o">=</span> <span class="i">piece</span><span class="p">;</span>
        <span class="i">command</span><span class="p">.</span><span class="i">X</span> <span class="o">=</span> <span class="i">x</span><span class="p">;</span>
        <span class="i">command</span><span class="p">.</span><span class="i">Y</span> <span class="o">=</span> <span class="i">y</span><span class="p">;</span>

        <span class="k">return</span> <span class="i">command</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">class</span> <span class="t">Program</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="i">Main</span><span class="p">(</span><span class="t">string</span><span class="p">[]</span> <span class="i">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c">// UI or AI creates command.</span>
        <span class="k">var</span> <span class="i">piece</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Piece</span><span class="p">();</span>
        <span class="k">var</span> <span class="i">command</span> <span class="o">=</span> <span class="i">Commands</span><span class="p">.</span><span class="i">MovePiece</span><span class="p">(</span><span class="i">piece</span><span class="p">,</span> <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">);</span>

        <span class="c">// Chess engine invokes it.</span>
        <span class="i">command</span><span class="p">.</span><span class="i">Invoke</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">delegate</span> <span class="i">CommandDel</span><span class="p">();</span>

<span class="k">class</span> <span class="t">MovePieceCommand</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">Piece</span> <span class="i">Piece</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">int</span>   <span class="i">X</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">int</span>   <span class="i">Y</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">void</span> <span class="i">Invoke</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="i">Piece</span><span class="p">.</span><span class="i">MoveTo</span><span class="p">(</span><span class="i">X</span><span class="p">,</span> <span class="i">Y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">class</span> <span class="t">Commands</span>
<span class="p">{</span>
    <span class="c">// Create a command to move a piece.</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">CommandDel</span> <span class="i">MovePiece</span><span class="p">(</span><span class="t">Piece</span> <span class="i">piece</span><span class="p">,</span> <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">var</span> <span class="i">command</span> <span class="o">=</span> <span class="k">new</span> <span class="t">MovePieceCommand</span><span class="p">();</span>
        <span class="i">command</span><span class="p">.</span><span class="i">Piece</span> <span class="o">=</span> <span class="i">piece</span><span class="p">;</span>
        <span class="i">command</span><span class="p">.</span><span class="i">X</span> <span class="o">=</span> <span class="i">x</span><span class="p">;</span>
        <span class="i">command</span><span class="p">.</span><span class="i">Y</span> <span class="o">=</span> <span class="i">y</span><span class="p">;</span>

        <span class="k">return</span> <span class="i">command</span><span class="p">.</span><span class="i">Invoke</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">Program</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="i">Main</span><span class="p">(</span><span class="t">string</span><span class="p">[]</span> <span class="i">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c">// UI or AI creates command.</span>
        <span class="k">var</span> <span class="i">piece</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Piece</span><span class="p">();</span>
        <span class="k">var</span> <span class="i">command</span> <span class="o">=</span> <span class="i">Commands</span><span class="p">.</span><span class="i">MovePiece</span><span class="p">(</span><span class="i">piece</span><span class="p">,</span> <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">);</span>

        <span class="c">// Chess engine invokes it.</span>
        <span class="i">command</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">class</span> <span class="t">MovePieceCommand</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="t">Piece</span> <span class="i">Piece</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">int</span>   <span class="i">X</span><span class="p">;</span>
    <span class="k">public</span> <span class="t">int</span>   <span class="i">Y</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">class</span> <span class="t">Commands</span>
<span class="p">{</span>
    <span class="c">// create a command to move a piece</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">Action</span> <span class="i">MovePiece</span><span class="p">(</span><span class="t">Piece</span> <span class="i">piece</span><span class="p">,</span> <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">var</span> <span class="i">command</span> <span class="o">=</span> <span class="k">new</span> <span class="t">MovePieceCommand</span><span class="p">();</span>
        <span class="i">command</span><span class="p">.</span><span class="i">Piece</span> <span class="o">=</span> <span class="i">piece</span><span class="p">;</span>
        <span class="i">command</span><span class="p">.</span><span class="i">X</span>     <span class="o">=</span> <span class="i">x</span><span class="p">;</span>
        <span class="i">command</span><span class="p">.</span><span class="i">Y</span>     <span class="o">=</span> <span class="i">y</span><span class="p">;</span>

        <span class="t">CommandDelegate</span> <span class="i">invoke</span> <span class="o">=</span> <span class="k">delegate</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="i">command</span><span class="p">.</span><span class="i">Piece</span><span class="p">.</span><span class="i">MoveTo</span><span class="p">(</span><span class="i">command</span><span class="p">.</span><span class="i">X</span><span class="p">,</span> <span class="i">command</span><span class="p">.</span><span class="i">Y</span><span class="p">);</span>
            <span class="p">};</span>

        <span class="k">return</span> <span class="i">invoke</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">static</span> <span class="k">class</span> <span class="t">Commands</span>
<span class="p">{</span>
    <span class="c">// create a command to move a piece</span>
    <span class="k">public</span> <span class="k">static</span> <span class="t">Action</span> <span class="i">MovePiece</span><span class="p">(</span><span class="t">Piece</span> <span class="i">piece</span><span class="p">,</span> <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="i">piece</span><span class="p">.</span><span class="i">MoveTo</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2009/12/26/conditional-binding-with-let-in-magpie</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">int</span> <span class="i">value</span> <span class="o">=</span> <span class="i">Int32</span><span class="p">.</span><span class="i">Parse</span><span class="p">(</span><span class="s">&quot;1234&quot;</span><span class="p">);</span>
<span class="c">// Do something with value...</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">int</span> <span class="i">value</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="i">Int32</span><span class="p">.</span><span class="i">TryParse</span><span class="p">(</span><span class="s">&quot;1234&quot;</span><span class="p">,</span> <span class="k">out</span> <span class="i">value</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c">// Do something with value...</span>

<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">Derived</span> <span class="i">derived</span> <span class="o">=</span> <span class="i">someBase</span> <span class="k">as</span> <span class="t">Derived</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="i">derived</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c">// Do something with derived...</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">Dictionary</span><span class="o">&lt;</span><span class="t">string</span><span class="p">,</span> <span class="t">int</span><span class="o">&gt;</span> <span class="i">dict</span> <span class="o">=</span> <span class="c">// Get dictionary...</span>

<span class="t">int</span> <span class="i">value</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="i">dict</span><span class="p">.</span><span class="i">TryGetValue</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span> <span class="k">out</span> <span class="i">value</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c">// Do something with value...</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="c">// Parse:</span>
<span class="k">let</span> <span class="i">value</span> <span class="o">&lt;-</span> <span class="s">&quot;1234&quot;</span><span class="p">.</span><span class="i">AsInt</span> <span class="k">then</span>
    <span class="c">// Do something with value...</span>
<span class="k">end</span>

<span class="c">// Downcast:</span>
<span class="k">let</span> <span class="i">derived</span> <span class="o">&lt;-</span> <span class="i">someBase</span><span class="p">.</span><span class="i">As</span><span class="p">&#39;</span><span class="t">Derived</span> <span class="k">then</span>
    <span class="c">// Do something with derived...</span>
<span class="k">end</span>

<span class="c">// Look up in dictionary:</span>
<span class="k">let</span> <span class="i">value</span> <span class="o">&lt;-</span> <span class="i">Find</span> <span class="p">(</span><span class="i">dict</span><span class="p">,</span> <span class="s">&quot;key&quot;</span><span class="p">)</span> <span class="k">then</span>
    <span class="c">// Do something with value.</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="k">let</span> <span class="x">&lt;variable&gt;</span> <span class="o">&lt;-</span> <span class="x">&lt;expression&gt;</span> <span class="k">then</span> <span class="x">&lt;body&gt;</span>
</code></pre></div>
<p>magpie1</p>
<div class="highlight"><pre><code class="language-magpie1" data-lang="magpie1"><span class="c">// Parse:</span>
<span class="k">let</span> <span class="i">value</span> <span class="o">&lt;-</span> <span class="s">&quot;1234&quot;</span><span class="p">.</span><span class="i">AsInt</span> <span class="k">then</span>
    <span class="c">// Do something with value...</span>
<span class="k">else</span>
    <span class="i">Print</span> <span class="s">&quot;Couldn&#39;t parse string.&quot;</span>
<span class="k">end</span>
</code></pre></div>
<h2>2010/06/25/methods-on-the-ether-or-creating-your-own-control-structures-for-fun-and-profit</h2>

<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">if</span> <span class="p">(</span><span class="i">numWeasels</span> <span class="o">&gt;</span> <span class="i">numCakes</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;Not enough cakes!&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">i</span> <span class="o">&lt;</span> <span class="i">numWeasels</span><span class="p">;</span> <span class="i">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;A weasel eats a cake!&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>smalltalk</p>
<div class="highlight"><pre><code class="language-smalltalk" data-lang="smalltalk"><span class="i">numWeasels</span> <span class="o">&gt;</span> <span class="i">numCakes</span> <span class="k">ifTrue:</span> <span class="p">[</span>
  <span class="s">&#39;Not enough cakes!&#39;</span> <span class="i">print</span>
<span class="p">]</span> <span class="k">ifFalse:</span> <span class="p">[</span>
  <span class="i">i</span> <span class="o">:=</span> <span class="n">0</span><span class="p">.</span>
  <span class="p">[</span> <span class="i">i</span> <span class="o">&lt;</span> <span class="i">numWeasels</span> <span class="p">]</span> <span class="k">whileTrue:</span> <span class="p">[</span>
    <span class="s">&#39;A weasel eats a cake!&#39;</span> <span class="i">print</span><span class="p">.</span>
    <span class="i">i</span> <span class="o">:=</span> <span class="i">i</span> <span class="o">+</span> <span class="n">1</span>
  <span class="p">]</span>
<span class="p">]</span>
</code></pre></div>
<p>smalltalk</p>
<div class="highlight"><pre><code class="language-smalltalk" data-lang="smalltalk"><span class="p">...</span> <span class="k">ifTrue:</span> <span class="p">[</span>
  <span class="p">...</span>
<span class="p">]</span> <span class="k">ifFalse:</span> <span class="p">[</span>
  <span class="p">[</span> <span class="p">...</span> <span class="p">]</span> <span class="k">whileTrue:</span> <span class="p">[</span> <span class="p">...</span> <span class="p">]</span>
<span class="p">]</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">ifThen</span><span class="p">(</span><span class="t">bool</span> <span class="i">condition</span><span class="p">,</span> <span class="t">Code</span> <span class="i">ifTrue</span><span class="p">,</span> <span class="t">Code</span> <span class="i">ifFalse</span><span class="p">);</span>
</code></pre></div>
<p>smalltalk</p>
<div class="highlight"><pre><code class="language-smalltalk" data-lang="smalltalk"><span class="p">[</span> <span class="s">&#39;hi&#39;</span> <span class="i">print</span> <span class="p">]</span>
</code></pre></div>
<p>smalltalk</p>
<div class="highlight"><pre><code class="language-smalltalk" data-lang="smalltalk"><span class="p">[</span> <span class="s">&#39;hi&#39;</span> <span class="i">print</span> <span class="p">]</span> <span class="i">value</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="k">if:</span> <span class="i">numWeasels</span> <span class="o">&gt;</span> <span class="i">numCakes</span> <span class="k">then:</span> <span class="p">{</span>
  <span class="k">write:</span> <span class="s">&quot;Not enough cakes!&quot;</span>
<span class="p">}</span> <span class="k">else:</span> <span class="p">{</span>
  <span class="k">from:</span> <span class="n">1</span> <span class="k">to:</span> <span class="i">numWeasels</span> <span class="k">do:</span> <span class="p">{</span>
    <span class="k">write:</span> <span class="s">&quot;A weasel eats a cake!&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">Ether</span> <span class="p">::</span> <span class="k">from:</span> <span class="i">start</span> <span class="k">to:</span> <span class="i">end</span> <span class="k">do:</span> <span class="i">block</span> <span class="p">{</span>
  <span class="i">i</span> <span class="o">&lt;-</span> <span class="i">start</span>
  <span class="k">while:</span> <span class="p">{</span> <span class="i">i</span> <span class="o">&lt;=</span> <span class="i">end</span> <span class="p">}</span> <span class="k">do:</span> <span class="p">{</span>
    <span class="i">block</span> <span class="k">call:</span> <span class="i">i</span>
    <span class="i">i</span> <span class="o">&lt;--</span> <span class="i">i</span> <span class="o">+</span> <span class="n">1</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2010/07/02/new-syntax-for-binding-methods-in-finch</h2>

<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">True</span> <span class="k">addMethod:</span> <span class="s">&quot;not&quot;</span> <span class="k">body:</span> <span class="p">{</span> <span class="t">False</span> <span class="p">}</span>

<span class="c">&#39; Define a for-style loop.</span>
<span class="t">Ether</span> <span class="k">addMethod:</span> <span class="s">&quot;from:to:step:do:&quot;</span> <span class="p">{</span> <span class="p">|</span><span class="i">start</span> <span class="i">end</span> <span class="i">step</span> <span class="i">block</span><span class="p">|</span>

  <span class="i">i</span> <span class="o">&lt;-</span> <span class="i">start</span>

  <span class="k">while:</span> <span class="p">{</span> <span class="i">i</span> <span class="o">&lt;=</span> <span class="i">end</span> <span class="p">}</span> <span class="k">do:</span> <span class="p">{</span>
    <span class="i">block</span> <span class="k">call:</span> <span class="i">i</span>
    <span class="i">i</span> <span class="o">&lt;--</span> <span class="i">i</span> <span class="o">+</span> <span class="i">step</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c">&#39; Concatenate two arrays.</span>
<span class="t">Array</span> <span class="i">prototype</span> <span class="k">addMethod:</span> <span class="s">&quot;++&quot;</span> <span class="k">body:</span> <span class="p">{</span> <span class="p">|</span><span class="i">right</span><span class="p">|</span>
  <span class="i">result</span> <span class="o">&lt;-</span> <span class="p">[]</span>

  <span class="k">self</span> <span class="k">each:</span> <span class="p">{|</span><span class="i">e</span><span class="p">|</span> <span class="i">result</span> <span class="k">add:</span> <span class="i">e</span> <span class="p">}</span>
  <span class="i">right</span> <span class="k">each:</span> <span class="p">{|</span><span class="i">e</span><span class="p">|</span> <span class="i">result</span> <span class="k">add:</span> <span class="i">e</span> <span class="p">}</span>

  <span class="i">result</span>
<span class="p">}</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">True</span> <span class="p">::</span> <span class="i">not</span> <span class="p">{</span> <span class="t">False</span> <span class="p">}</span>

<span class="c">&#39; Define a for-style loop.</span>
<span class="t">Ether</span> <span class="p">::</span> <span class="k">from:</span> <span class="i">start</span> <span class="k">to:</span> <span class="i">end</span> <span class="k">step:</span> <span class="i">step</span> <span class="k">do:</span> <span class="i">block</span> <span class="p">{</span>
  <span class="i">i</span> <span class="o">&lt;-</span> <span class="i">start</span>

  <span class="k">while:</span> <span class="p">{</span> <span class="i">i</span> <span class="o">&lt;=</span> <span class="i">end</span> <span class="p">}</span> <span class="k">do:</span> <span class="p">{</span>
    <span class="i">block</span> <span class="k">call:</span> <span class="i">i</span>
    <span class="i">i</span> <span class="o">&lt;--</span> <span class="i">i</span> <span class="o">+</span> <span class="i">step</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c">&#39; Concatenate two arrays.</span>
<span class="t">Array</span> <span class="i">prototype</span> <span class="p">::</span> <span class="o">++</span> <span class="i">right</span> <span class="p">{</span>
  <span class="i">result</span> <span class="o">&lt;-</span> <span class="p">[]</span>

  <span class="k">self</span> <span class="k">each:</span> <span class="p">{|</span><span class="i">e</span><span class="p">|</span> <span class="i">result</span> <span class="k">add:</span> <span class="i">e</span> <span class="p">}</span>
  <span class="i">right</span> <span class="k">each:</span> <span class="p">{|</span><span class="i">e</span><span class="p">|</span> <span class="i">result</span> <span class="k">add:</span> <span class="i">e</span> <span class="p">}</span>

  <span class="i">result</span>
<span class="p">}</span>
</code></pre></div>
<h2>2010/07/07/meltwater-a-color-theme-for-xcode</h2>

<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>~&#47;Library&#47;Application Support&#47;XCode&#47;Color Themes
</code></pre></div>
<h2>2010/07/13/fibers-coroutines-in-finch</h2>

<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="c">&#39; Create a fiber.</span>
<span class="i">fiber</span> <span class="o">&lt;-</span> <span class="t">Fiber</span> <span class="k">new:</span> <span class="p">{</span>
  <span class="k">writeLine:</span> <span class="s">&quot;fiber started&quot;</span>
  <span class="t">Fiber</span> <span class="i">yield</span>
  <span class="k">writeLine:</span> <span class="s">&quot;fiber resumed&quot;</span>
<span class="p">}</span>

<span class="c">&#39; Transfer control from this fiber (the main one) to it.</span>
<span class="k">writeLine:</span> <span class="s">&quot;main started&quot;</span>
<span class="i">fiber</span> <span class="i">run</span>
<span class="k">writeLine:</span> <span class="s">&quot;main resumed&quot;</span>
<span class="i">fiber</span> <span class="i">run</span>
<span class="k">writeLine:</span> <span class="s">&quot;done&quot;</span>
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>main started
fiber started
main resumed
fiber resumed
done
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="i">someFiberObj</span> <span class="i">run</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">Fiber</span> <span class="i">yield</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="i">fiber</span> <span class="o">&lt;-</span> <span class="t">Fiber</span> <span class="k">new:</span> <span class="p">{</span>
  <span class="t">Fiber</span> <span class="k">yield:</span> <span class="s">&quot;a marmot&quot;</span>
<span class="p">}</span>

<span class="i">result</span> <span class="o">&lt;-</span> <span class="i">fiber</span> <span class="i">run</span>
<span class="k">writeLine:</span> <span class="i">result</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="i">fiber</span> <span class="o">&lt;-</span> <span class="t">Fiber</span> <span class="k">new:</span> <span class="p">{</span>
  <span class="i">result</span> <span class="o">&lt;-</span> <span class="t">Fiber</span> <span class="i">yield</span>
  <span class="k">writeLine:</span> <span class="i">result</span>
<span class="p">}</span>

<span class="i">fiber</span> <span class="i">run</span>
<span class="i">fiber</span> <span class="k">run:</span> <span class="s">&quot;a dingo&quot;</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="t">Patroller</span><span class="p">::</span><span class="i">update</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="i">state_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="r">WALK_LEFT</span><span class="p">:</span>
      <span class="i">x_</span> <span class="o">-=</span> <span class="r">WALK_SPEED</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">x_</span> <span class="o">&lt;=</span> <span class="r">MIN_X</span><span class="p">)</span> <span class="p">{</span>
        <span class="i">state_</span> <span class="o">=</span> <span class="r">WAIT_LEFT</span><span class="p">;</span>
        <span class="i">wait_</span> <span class="o">=</span> <span class="r">WAIT_FRAMES</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="r">WAIT_LEFT</span><span class="p">:</span>
      <span class="i">wait_</span><span class="o">--</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">wait_</span> <span class="o">==</span> <span class="n">0</span><span class="p">)</span> <span class="i">state_</span> <span class="o">=</span> <span class="r">WALK_RIGHT</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="r">WALK_RIGHT</span><span class="p">:</span>
      <span class="i">x_</span> <span class="o">+=</span> <span class="r">WALK_SPEED</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">x_</span> <span class="o">&gt;=</span> <span class="r">MAX_X</span><span class="p">)</span> <span class="p">{</span>
        <span class="i">state_</span> <span class="o">=</span> <span class="r">WAIT_RIGHT</span><span class="p">;</span>
        <span class="i">wait_</span> <span class="o">=</span> <span class="r">WAIT_FRAMES</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="r">WAIT_RIGHT</span><span class="p">:</span>
      <span class="i">wait_</span><span class="o">--</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">wait_</span> <span class="o">==</span> <span class="n">0</span><span class="p">)</span> <span class="i">state_</span> <span class="o">=</span> <span class="r">WALK_LEFT</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">Patroller</span> <span class="p">::</span> <span class="i">behavior</span> <span class="p">{</span>
  <span class="c">&#39; Walk left.</span>
  <span class="k">from:</span> <span class="t">MaxX</span> <span class="k">to:</span> <span class="t">MinX</span> <span class="k">do:</span> <span class="p">{|</span><span class="i">x</span><span class="p">|</span>
    <span class="f">_x</span> <span class="o">&lt;-</span> <span class="i">x</span>
    <span class="t">Fiber</span> <span class="i">yield</span>
  <span class="p">}</span>

  <span class="c">&#39; Wait.</span>
  <span class="k">from:</span> <span class="n">1</span> <span class="k">to:</span> <span class="t">WaitTime</span> <span class="k">do:</span> <span class="p">{</span> <span class="t">Fiber</span> <span class="i">yield</span> <span class="p">}</span>

  <span class="c">&#39; Walk right.</span>
  <span class="k">from:</span> <span class="t">MinX</span> <span class="k">to:</span> <span class="t">MaxX</span> <span class="k">do:</span> <span class="p">{|</span><span class="i">x</span><span class="p">|</span>
    <span class="f">_x</span> <span class="o">&lt;-</span> <span class="i">x</span>
    <span class="t">Fiber</span> <span class="i">yield</span>
  <span class="p">}</span>

  <span class="c">&#39; Wait.</span>
  <span class="k">from:</span> <span class="n">1</span> <span class="k">to:</span> <span class="t">WaitTime</span> <span class="k">do:</span> <span class="p">{</span> <span class="t">Fiber</span> <span class="i">yield</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">Patroller</span> <span class="p">::</span> <span class="p">(</span>
  <span class="i">behavior</span> <span class="p">{</span>
    <span class="k">self</span> <span class="k">walkFrom:</span> <span class="t">MaxX</span> <span class="k">to:</span> <span class="t">MinX</span>
    <span class="k">self</span> <span class="k">wait:</span> <span class="t">WaitTime</span>
    <span class="k">self</span> <span class="k">walkFrom:</span> <span class="t">MinX</span> <span class="k">to:</span> <span class="t">MaxX</span>
    <span class="k">self</span> <span class="k">wait:</span> <span class="t">WaitTime</span>
  <span class="p">}</span>

  <span class="k">walkFrom:</span> <span class="i">a</span> <span class="k">to:</span> <span class="i">b</span> <span class="p">{</span>
    <span class="k">from:</span> <span class="i">a</span> <span class="k">to:</span> <span class="i">b</span> <span class="k">do:</span> <span class="p">{|</span><span class="i">x</span><span class="p">|</span>
      <span class="f">_x</span> <span class="o">&lt;-</span> <span class="i">x</span>
      <span class="t">Fiber</span> <span class="i">yield</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">wait:</span> <span class="i">frames</span> <span class="p">{</span>
    <span class="k">from:</span> <span class="n">1</span> <span class="k">to:</span> <span class="t">WaitTime</span> <span class="k">do:</span> <span class="p">{</span> <span class="t">Fiber</span> <span class="i">yield</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<h2>2010/07/18/jasic-a-complete-interpreter-in-one-java-file</h2>

<p>jasic</p>
<div class="highlight"><pre><code class="language-jasic" data-lang="jasic"><span class="c">&#39; Initialize the loop counter.</span>
<span class="i">count</span> <span class="o">=</span> <span class="n">10</span>

<span class="c">&#39; Stop looping if we&#39;re done.</span>
<span class="a">top:</span>
<span class="k">if</span> <span class="i">count</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span class="i">end</span>
<span class="k">print</span> <span class="s">&quot;Hello, world!&quot;</span>

<span class="c">&#39; Decrement and restart the loop.</span>
<span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">-</span> <span class="n">1</span>
<span class="k">goto</span> <span class="i">top</span>
<span class="a">end:</span>
</code></pre></div>
<h2>2010/07/24/killing-primitive-loops-and-conditionals</h2>

<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="k">if:</span> <span class="i">rapper</span> <span class="o">=</span> <span class="i">vanilla</span> <span class="i">ice</span> <span class="k">then:</span> <span class="p">{</span>
  <span class="k">writeLine:</span> <span class="s">&quot;Too cold&quot;</span>
<span class="p">}</span> <span class="k">else:</span> <span class="p">{</span>
  <span class="k">writeLine:</span> <span class="s">&quot;Wack MC&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">Object</span> <span class="i">prototype</span> <span class="p">::</span> <span class="k">ifTrue:</span> <span class="i">then</span> <span class="k">else:</span> <span class="i">else</span> <span class="p">{</span> <span class="i">else</span> <span class="i">call</span> <span class="p">}</span>
<span class="t">True</span> <span class="p">::</span> <span class="k">ifTrue:</span> <span class="i">then</span> <span class="k">else:</span> <span class="i">else</span> <span class="p">{</span> <span class="i">then</span> <span class="i">call</span> <span class="p">}</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">Ether</span> <span class="p">::</span> <span class="k">if:</span> <span class="i">condition</span> <span class="k">then:</span> <span class="i">then</span> <span class="k">else:</span> <span class="i">else</span> <span class="p">{</span>
    <span class="i">condition</span> <span class="k">ifTrue:</span> <span class="i">then</span> <span class="k">else:</span> <span class="i">else</span>
<span class="p">}</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="k">while:</span> <span class="p">{</span> <span class="i">mother</span> <span class="i">burnedDown?</span> <span class="i">not</span> <span class="p">}</span> <span class="k">do:</span> <span class="p">{</span>
    <span class="k">writeLine:</span> <span class="s">&quot;Burn, baby, burn&quot;</span>
    <span class="k">writeLine:</span> <span class="s">&quot;Disco inferno&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>finch</p>
<div class="highlight"><pre><code class="language-finch" data-lang="finch"><span class="t">Ether</span> <span class="p">::</span> <span class="k">while:</span> <span class="i">condition</span> <span class="k">do:</span> <span class="i">block</span> <span class="p">{</span>
    <span class="k">if:</span> <span class="i">condition</span> <span class="i">call</span> <span class="k">then:</span> <span class="p">{</span>
        <span class="i">block</span> <span class="i">call</span>
        <span class="k">while:</span> <span class="i">condition</span> <span class="k">do:</span> <span class="i">block</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2010/08/01/class-in-the-front-proto-in-the-back</h2>

<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">invoke</span><span class="p">(</span><span class="i">obj</span><span class="p">,</span> <span class="i">methodName</span><span class="p">,</span> <span class="i">arg</span><span class="p">)</span>
  <span class="i">classObj</span> <span class="o">=</span> <span class="i">obj</span><span class="p">.</span><span class="i">getClass</span>
  <span class="i">method</span> <span class="o">=</span> <span class="i">classObj</span><span class="p">.</span><span class="i">findMethod</span><span class="p">(</span><span class="i">methodName</span><span class="p">)</span>
  <span class="i">method</span><span class="p">.</span><span class="i">invoke</span><span class="p">(</span><span class="i">obj</span><span class="p">,</span> <span class="i">arg</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">ClassObj</span> <span class="p">{</span>
  <span class="t">Map</span><span class="o">&lt;</span><span class="t">String</span><span class="p">,</span> <span class="t">Method</span><span class="o">&gt;</span> <span class="i">methods</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">Obj</span> <span class="p">{</span>
  <span class="t">ClassObj</span> <span class="i">theClass</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">foo</span> <span class="o">=</span> <span class="t">Foo</span><span class="p">.</span><span class="i">new</span>   <span class="c">// Call a class method on Foo.</span>
<span class="i">foo</span><span class="p">.</span><span class="i">toString</span>        <span class="c">// Call an instance method on a Foo.</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">ClassObj</span> <span class="p">{</span>
  <span class="t">Map</span><span class="o">&lt;</span><span class="t">String</span><span class="p">,</span> <span class="t">Method</span><span class="o">&gt;</span> <span class="i">classMethods</span><span class="p">;</span>
  <span class="t">Map</span><span class="o">&lt;</span><span class="t">String</span><span class="p">,</span> <span class="t">Method</span><span class="o">&gt;</span> <span class="i">instanceMethods</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">Obj</span> <span class="p">{</span>
  <span class="t">Map</span><span class="o">&lt;</span><span class="t">String</span><span class="p">,</span> <span class="t">Method</span><span class="o">&gt;</span> <span class="i">methods</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">Obj</span> <span class="p">{</span>
  <span class="t">Obj</span> <span class="i">parent</span><span class="p">;</span>
  <span class="t">Map</span><span class="o">&lt;</span><span class="t">String</span><span class="p">,</span> <span class="t">Method</span><span class="o">&gt;</span> <span class="i">methods</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">invoke</span><span class="p">(</span><span class="i">obj</span><span class="p">,</span> <span class="i">methodName</span><span class="p">,</span> <span class="i">arg</span><span class="p">)</span>
  <span class="i">thisObj</span> <span class="o">=</span> <span class="i">obj</span>
  <span class="k">loop</span>
    <span class="i">method</span> <span class="o">=</span> <span class="i">thisObj</span><span class="p">.</span><span class="i">findMethod</span><span class="p">(</span><span class="i">methodName</span><span class="p">)</span>
    <span class="k">if</span> <span class="i">method</span> <span class="o">!=</span> <span class="k">null</span> <span class="k">then</span>
      <span class="k">return</span> <span class="i">method</span><span class="p">.</span><span class="i">invoke</span><span class="p">(</span><span class="i">obj</span><span class="p">,</span> <span class="i">arg</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c">// Walk up the parent chain.</span>
    <span class="i">thisObj</span> <span class="o">=</span> <span class="i">obj</span><span class="p">.</span><span class="i">parent</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Foo</span>
  <span class="k">def</span> <span class="i">sayHi</span> <span class="p">()</span> <span class="i">print</span> <span class="s">&quot;hi&quot;</span>
<span class="k">end</span>

<span class="k">def</span> <span class="i">a</span> <span class="o">=</span> <span class="t">Foo</span><span class="p">.</span><span class="i">new</span>
<span class="k">def</span> <span class="i">b</span> <span class="o">=</span> <span class="t">Foo</span><span class="p">.</span><span class="i">new</span>
<span class="i">a</span><span class="p">.</span><span class="i">sayHi</span>
<span class="i">b</span><span class="p">.</span><span class="i">sayHi</span>
</code></pre></div>
<h2>2010/08/23/void-null-maybe-and-nothing</h2>

<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">sayHi</span><span class="p">()</span> <span class="p">{</span>
  <span class="i">printf</span><span class="p">(</span><span class="s">&quot;hi!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">int</span> <span class="i">a</span> <span class="o">=</span> <span class="i">sayHi</span><span class="p">();</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="t">File</span> <span class="i">openFile</span><span class="p">(</span><span class="t">String</span> <span class="i">path</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">isValid</span><span class="p">(</span><span class="i">path</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="t">File</span><span class="p">(</span><span class="i">path</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">sayHi</span><span class="p">(</span><span class="o">-&gt;</span><span class="p">)</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;hi&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">sayHi</span><span class="p">(</span><span class="o">-&gt;</span> <span class="t">Nothing</span><span class="p">)</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;hi&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">openFile</span><span class="p">(</span><span class="i">path</span> <span class="t">String</span> <span class="o">-&gt;</span> <span class="t">File</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">path</span> <span class="i">valid?</span> <span class="k">then</span> <span class="t">File</span> <span class="i">new</span><span class="p">(</span><span class="i">path</span><span class="p">)</span>
  <span class="k">else</span> <span class="k">nothing</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">openFile</span><span class="p">(</span><span class="i">path</span> <span class="t">String</span> <span class="o">-&gt;</span> <span class="t">File</span> <span class="o">|</span> <span class="t">Nothing</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">path</span> <span class="i">valid?</span> <span class="k">then</span> <span class="t">File</span> <span class="i">new</span><span class="p">(</span><span class="i">path</span><span class="p">)</span>
  <span class="k">else</span> <span class="k">nothing</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">myFile</span> <span class="o">=</span> <span class="i">openFile</span><span class="p">(</span><span class="s">&quot;path/to/file.txt&quot;</span><span class="p">)</span>
<span class="i">myFile</span> <span class="i">read</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">let</span> <span class="i">myFile</span> <span class="o">=</span> <span class="i">openFile</span><span class="p">(</span><span class="s">&quot;path/to/file.txt&quot;</span><span class="p">)</span> <span class="k">then</span>
  <span class="i">myFile</span> <span class="i">read</span>
<span class="k">else</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t open file!&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<h2>2010/08/31/type-checking-a-dynamic-language</h2>

<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">public</span> <span class="k">class</span> <span class="t">Hello</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="t">void</span> <span class="i">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="t">Hello</span> <span class="i">hello</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Hello</span><span class="p">();</span>
    <span class="i">hello</span><span class="p">.</span><span class="i">say</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="t">void</span> <span class="i">say</span><span class="p">(</span><span class="t">String</span> <span class="i">greeting</span><span class="p">)</span> <span class="p">{</span>
    <span class="t">System</span><span class="p">.</span><span class="i">out</span><span class="p">.</span><span class="i">println</span><span class="p">(</span><span class="i">greeting</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>python</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="t">Hello</span><span class="p">:</span>
    <span class="k">def</span> <span class="i">say</span><span class="p">(</span><span class="i">self</span><span class="p">,</span> <span class="i">greeting</span><span class="p">):</span>
        <span class="k">print</span> <span class="i">greeting</span>

<span class="i">hello</span> <span class="o">=</span> <span class="t">Hello</span><span class="p">()</span>
<span class="i">hello</span><span class="p">.</span><span class="i">say</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Hello</span>
<span class="k">end</span>

<span class="k">def</span> <span class="t">Hello</span> <span class="i">say</span><span class="p">(</span><span class="i">greeting</span><span class="p">)</span> <span class="i">print</span><span class="p">(</span><span class="i">greeting</span><span class="p">)</span>

<span class="k">var</span> <span class="i">hello</span> <span class="o">=</span> <span class="t">Hello</span> <span class="i">new</span>
<span class="i">hello</span> <span class="i">say</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Hello</span>
<span class="k">end</span>

<span class="k">def</span> <span class="t">Hello</span> <span class="i">say</span><span class="p">(</span><span class="i">greeting</span> <span class="t">String</span> <span class="o">-&gt;</span><span class="p">)</span> <span class="i">print</span><span class="p">(</span><span class="i">greeting</span><span class="p">)</span>

<span class="k">var</span> <span class="i">main</span><span class="p">()</span>
  <span class="k">var</span> <span class="i">hello</span> <span class="o">=</span> <span class="t">Hello</span> <span class="i">new</span>
  <span class="i">hello</span> <span class="i">say</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Foo</span>
<span class="k">end</span>

<span class="t">Foo</span> <span class="i">bar</span><span class="p">()</span> <span class="i">print</span> <span class="s">&quot;called bar&quot;</span>

<span class="k">var</span> <span class="i">main</span><span class="p">(</span><span class="o">-&gt;</span><span class="p">)</span>
  <span class="c">// Break Foo!</span>
  <span class="t">Foo</span> <span class="i">removeMethod</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">)</span>

  <span class="c">// Now try to call it!</span>
  <span class="k">var</span> <span class="i">foo</span> <span class="o">=</span> <span class="t">Foo</span> <span class="i">new</span>
  <span class="i">foo</span> <span class="i">bar</span>
<span class="k">end</span>
</code></pre></div>
<h2>2010/09/01/a-type-checking-conundrum</h2>

<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">say</span><span class="p">(</span><span class="i">what</span> <span class="t">String</span> <span class="o">-&gt;</span><span class="p">)</span>
  <span class="i">print</span><span class="p">(</span><span class="i">what</span><span class="p">)</span>
<span class="k">end</span>

<span class="i">say</span><span class="p">(</span><span class="s">&quot;hey&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">say</span><span class="p">(</span><span class="i">what</span> <span class="t">String</span> <span class="o">-&gt;</span><span class="p">)</span>
  <span class="i">print</span><span class="p">(</span><span class="i">what</span><span class="p">)</span>
<span class="k">end</span>

<span class="i">say</span><span class="p">(</span><span class="n">123</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">say</span><span class="p">(</span><span class="i">what</span> <span class="t">String</span> <span class="o">-&gt;</span><span class="p">)</span>
    <span class="i">print</span><span class="p">(</span><span class="i">what</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">var</span> <span class="i">main</span><span class="p">(</span><span class="o">-&gt;</span><span class="p">)</span>
    <span class="i">say</span><span class="p">(</span><span class="n">123</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">returnString</span><span class="p">(</span><span class="o">-&gt;</span> <span class="t">String</span><span class="p">)</span>
  <span class="k">var</span> <span class="i">a</span> <span class="o">=</span> <span class="n">123</span>
  <span class="i">a</span> <span class="o">=</span> <span class="s">&quot;string&quot;</span>
  <span class="k">return</span> <span class="i">a</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">a</span> <span class="o">=</span> <span class="n">123</span>

<span class="k">var</span> <span class="i">returnInt</span><span class="p">(</span><span class="o">-&gt;</span> <span class="t">Int</span><span class="p">)</span>
  <span class="k">return</span> <span class="i">a</span>
<span class="k">end</span>

<span class="i">a</span> <span class="o">=</span> <span class="s">&quot;string&quot;</span>
<span class="i">returnInt</span><span class="p">()</span>
</code></pre></div>
<h2>2010/09/18/futureproofing-uniform-access-and-masquerades</h2>

<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">public</span> <span class="k">class</span> <span class="t">Person</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">String</span> <span class="i">name</span><span class="p">;</span>
  <span class="k">public</span> <span class="t">int</span> <span class="i">age</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">PersonFactory</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">Person</span> <span class="i">create</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="t">Person</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="t">void</span> <span class="i">doSomething</span><span class="p">(</span><span class="t">PersonFactory</span> <span class="i">factory</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">Person</span> <span class="i">person</span> <span class="o">=</span> <span class="i">factory</span><span class="p">.</span><span class="i">create</span><span class="p">();</span>
  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">interface</span> <span class="t">IPerson</span>
<span class="p">{</span>
  <span class="t">string</span> <span class="i">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="t">int</span>    <span class="i">Age</span>  <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">Person</span> <span class="p">:</span> <span class="t">IPerson</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="t">string</span> <span class="i">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="t">int</span>    <span class="i">Age</span>  <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">void</span> <span class="i">DoSomethingWithPerson</span><span class="p">(</span><span class="t">IPerson</span> <span class="i">person</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">bob</span> <span class="o">=</span> <span class="t">Person</span> <span class="i">new</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="t">Person</span> <span class="i">defineMethod</span><span class="p">(</span><span class="s">&quot;rawNew&quot;</span><span class="p">,</span> <span class="t">Person</span> <span class="i">getMethod</span><span class="p">(</span><span class="s">&quot;new&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="t">Person</span> <span class="i">new</span><span class="p">(</span><span class="i">name</span><span class="p">)</span>
  <span class="c">// Don&#39;t want to create a person...</span>
  <span class="t">Dude</span> <span class="i">new</span><span class="p">(</span><span class="i">name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">makeSomeone</span><span class="p">(</span><span class="i">name</span><span class="p">,</span> <span class="i">factory</span><span class="p">)</span>
  <span class="i">factory</span> <span class="i">new</span><span class="p">(</span><span class="i">name</span><span class="p">)</span>
<span class="k">end</span>

<span class="i">makeSomeone</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span> <span class="t">Person</span><span class="p">)</span> <span class="c">// Makes a person.</span>
<span class="i">makeSomeone</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span> <span class="t">Hero</span><span class="p">)</span>   <span class="c">// Makes a hero.</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">interface</span> <span class="t">NamedFactory</span>
  <span class="i">new</span><span class="p">(</span><span class="i">name</span> <span class="t">String</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Person</span>
  <span class="k">this</span> <span class="p">(</span><span class="i">name</span><span class="p">)</span>
    <span class="k">this</span> <span class="i">name</span> <span class="o">=</span> <span class="i">name</span>
  <span class="k">end</span>

  <span class="i">greet</span><span class="p">()</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;Hi, I&#39;m &quot;</span> <span class="o">+</span> <span class="i">name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">greetEachOther</span><span class="p">(</span><span class="i">a</span> <span class="t">Person</span><span class="p">,</span> <span class="i">b</span> <span class="t">Person</span><span class="p">)</span>
  <span class="i">a</span> <span class="i">greet</span>
  <span class="i">b</span> <span class="i">greet</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Robot</span>
  <span class="i">name</span> <span class="o">=</span> <span class="s">&quot;Robot&quot;</span>

  <span class="i">greet</span><span class="p">()</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;Greetings, fleshy human.&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">main</span><span class="p">(</span><span class="o">-&gt;</span><span class="p">)</span>
  <span class="k">var</span> <span class="i">robot</span> <span class="o">=</span> <span class="t">Robot</span> <span class="i">new</span>
  <span class="c">// robot&#39;s type is Robot</span>
  <span class="k">var</span> <span class="i">imposter</span> <span class="o">=</span> <span class="i">robot</span> <span class="i">masqueradeAs</span><span class="p">[</span><span class="t">Person</span><span class="p">]</span>
  <span class="c">// imposter&#39;s type is Person but is still a reference to robot</span>
  <span class="c">// and this is now type-safe:</span>
  <span class="i">greetEachOther</span><span class="p">(</span><span class="t">Person</span> <span class="i">new</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">),</span> <span class="i">imposter</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<h2>2010/09/28/ruby-blocks-pythons-with-and-magpies-test-suite</h2>

<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">describe</span> <span class="s">&quot;The &#39;and&#39; statement&quot;</span> <span class="k">do</span>
  <span class="i">it</span> <span class="s">&quot;short-circuits evaluation at the first false condition&quot;</span> <span class="k">do</span>
    <span class="i">x</span> <span class="o">=</span> <span class="t">nil</span>
    <span class="t">true</span> <span class="k">and</span> <span class="t">false</span> <span class="k">and</span> <span class="i">x</span> <span class="o">=</span> <span class="n">1</span>
    <span class="i">x</span><span class="p">.</span><span class="i">should</span> <span class="i">be_nil</span>
  <span class="k">end</span>

  <span class="i">it</span> <span class="s">&quot;evaluates to the first condition not to be true&quot;</span> <span class="k">do</span>
    <span class="p">(</span><span class="s">&quot;yes&quot;</span> <span class="k">and</span> <span class="n">1</span> <span class="k">and</span> <span class="t">nil</span> <span class="k">and</span> <span class="t">true</span><span class="p">).</span><span class="i">should</span> <span class="o">==</span> <span class="t">nil</span>
    <span class="p">(</span><span class="s">&quot;yes&quot;</span> <span class="k">and</span> <span class="n">1</span> <span class="k">and</span> <span class="t">false</span> <span class="k">and</span> <span class="t">true</span><span class="p">).</span><span class="i">should</span> <span class="o">==</span> <span class="t">false</span>
  <span class="k">end</span>

  <span class="i">it</span> <span class="s">&quot;evaluates to the last condition if all are true&quot;</span> <span class="k">do</span>
    <span class="p">(</span><span class="s">&quot;yes&quot;</span> <span class="k">and</span> <span class="n">1</span><span class="p">).</span><span class="i">should</span> <span class="o">==</span> <span class="n">1</span>
    <span class="p">(</span><span class="n">1</span> <span class="k">and</span> <span class="s">&quot;yes&quot;</span><span class="p">).</span><span class="i">should</span> <span class="o">==</span> <span class="s">&quot;yes&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">blocky</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="k">do</span>
  <span class="i">puts</span> <span class="s">&quot;hi&quot;</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">blocky</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="i">lambda</span> <span class="p">{</span>
  <span class="i">puts</span> <span class="s">&quot;hi&quot;</span>
<span class="p">})</span>
</code></pre></div>
<p>python</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">with</span> <span class="i">open</span><span class="p">(</span><span class="s">&#39;somefile.text&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="i">f</span><span class="p">:</span>
  <span class="i">contents</span> <span class="o">=</span> <span class="i">f</span><span class="p">.</span><span class="i">read</span><span class="p">()</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Object</span>
  <span class="k">def</span> <span class="i">with</span><span class="p">(</span><span class="i">obj</span><span class="p">)</span>
    <span class="i">obj</span><span class="p">.</span><span class="i">__enter__</span>
    <span class="k">yield</span>
    <span class="i">obj</span><span class="p">.</span><span class="i">__exit__</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">with</span> <span class="t">File</span><span class="p">.</span><span class="i">open</span><span class="p">(</span><span class="s">&quot;somefile.text&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="i">f</span><span class="o">|</span>
  <span class="i">contents</span> <span class="o">=</span> <span class="i">f</span><span class="p">.</span><span class="i">read</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">specify</span><span class="p">(</span><span class="s">&quot;An &#39;and&#39; expression&quot;</span><span class="p">)</span> <span class="k">with</span>
  <span class="k">it</span> <span class="i">should</span><span class="p">(</span><span class="s">&quot;return the first arg if it is false.&quot;</span><span class="p">)</span> <span class="k">with</span>
    <span class="p">(</span><span class="n">0</span> <span class="k">and</span> <span class="k">false</span><span class="p">)</span> <span class="i">shouldBe</span><span class="p">(</span><span class="n">0</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">it</span> <span class="i">should</span><span class="p">(</span><span class="s">&quot;return the second arg if the first is true.&quot;</span><span class="p">)</span> <span class="k">with</span>
    <span class="p">(</span><span class="n">0</span> <span class="k">and</span> <span class="n">1</span><span class="p">)</span> <span class="i">shouldBe</span><span class="p">(</span><span class="n">1</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">it</span> <span class="i">should</span><span class="p">(</span><span class="s">&quot;short-circuit if the first arg is false.&quot;</span><span class="p">)</span> <span class="k">with</span>
    <span class="k">var</span> <span class="i">called</span> <span class="o">=</span> <span class="k">false</span>
    <span class="k">false</span> <span class="k">and</span> <span class="p">(</span><span class="i">called</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span>
    <span class="i">called</span> <span class="i">shouldBe</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// Functional idioms:</span>
<span class="k">var</span> <span class="i">waldo</span> <span class="o">=</span> <span class="i">people</span> <span class="i">find</span> <span class="k">with</span> <span class="k">it</span> <span class="i">name</span> <span class="o">==</span> <span class="s">&quot;waldo&quot;</span>
<span class="k">var</span> <span class="i">positives</span> <span class="o">=</span> <span class="i">numbers</span> <span class="i">filter</span> <span class="k">with</span> <span class="k">it</span> <span class="o">&gt;</span> <span class="n">0</span>

<span class="c">// Context management:</span>
<span class="t">File</span> <span class="i">open</span><span class="p">(</span><span class="s">&quot;name.text&quot;</span><span class="p">)</span> <span class="i">use</span> <span class="k">with</span>
  <span class="k">while</span> <span class="k">it</span> <span class="i">eof</span> <span class="i">not</span> <span class="k">do</span> <span class="i">print</span><span class="p">(</span><span class="k">it</span> <span class="i">readLine</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="t">File</span> <span class="i">use</span><span class="p">(</span><span class="i">block</span><span class="p">)</span>
  <span class="k">this</span> <span class="i">setup</span>
  <span class="i">block</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="k">this</span> <span class="i">teardown</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// Sort by name:</span>
<span class="i">collection</span> <span class="i">sort</span> <span class="k">with</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="i">a</span> <span class="i">name</span> <span class="i">compareTo</span><span class="p">(</span><span class="i">b</span> <span class="i">name</span><span class="p">)</span>
</code></pre></div>
<h2>2010/10/01/solving-the-expression-problem</h2>

<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart">            Text       Drawing   Spreadsheet
        ┌───────────┬───────────┬───────────┐
draw()  │           │           │           │
        ├───────────┼───────────┼───────────┤
load()  │           │           │           │
        ├───────────┼───────────┼───────────┤
save()  │           │           │           │
        └───────────┴───────────┴───────────┘
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">public</span> <span class="k">interface</span> <span class="t">Document</span> <span class="p">{</span>
  <span class="t">void</span> <span class="i">draw</span><span class="p">();</span>
  <span class="t">void</span> <span class="i">load</span><span class="p">();</span>
  <span class="t">void</span> <span class="i">save</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="t">TextDocument</span> <span class="k">implements</span> <span class="t">Document</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">draw</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Draw text doc... */</span> <span class="p">}</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">load</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Load text doc... */</span> <span class="p">}</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">save</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Save text doc... */</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="t">DrawingDocument</span> <span class="k">implements</span> <span class="t">Document</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">draw</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Draw drawing... */</span> <span class="p">}</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">load</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Load drawing... */</span> <span class="p">}</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">save</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Save drawing... */</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="t">SpreadsheetDocument</span> <span class="k">implements</span> <span class="t">Document</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">draw</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Draw spreadsheet... */</span> <span class="p">}</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">load</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Load spreadsheet... */</span> <span class="p">}</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">save</span><span class="p">()</span> <span class="p">{</span> <span class="c">/* Save spreadsheet... */</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>ocaml</p>
<div class="highlight"><pre><code class="language-ocaml" data-lang="ocaml"><span class="k">type</span> <span class="i">document</span>
  <span class="o">=</span> <span class="t">Text</span>
  <span class="o">|</span> <span class="t">Drawing</span>
  <span class="o">|</span> <span class="t">Spreadsheet</span>

<span class="k">fun</span> <span class="i">draw</span> <span class="p">(</span><span class="t">Text</span><span class="p">)</span>        <span class="o">=</span> <span class="c">(* Draw text doc... *)</span>
  <span class="o">|</span> <span class="i">draw</span> <span class="p">(</span><span class="t">Drawing</span><span class="p">)</span>     <span class="o">=</span> <span class="c">(* Draw drawing doc... *)</span>
  <span class="o">|</span> <span class="i">draw</span> <span class="p">(</span><span class="t">Spreadsheet</span><span class="p">)</span> <span class="o">=</span> <span class="c">(* Draw spreadsheet... *)</span>

<span class="k">fun</span> <span class="i">load</span> <span class="p">(</span><span class="t">Text</span><span class="p">)</span>        <span class="o">=</span> <span class="c">(* Load text doc... *)</span>
  <span class="o">|</span> <span class="i">load</span> <span class="p">(</span><span class="t">Drawing</span><span class="p">)</span>     <span class="o">=</span> <span class="c">(* Load drawing doc... *)</span>
  <span class="o">|</span> <span class="i">load</span> <span class="p">(</span><span class="t">Spreadsheet</span><span class="p">)</span> <span class="o">=</span> <span class="c">(* Load spreadsheet... *)</span>

<span class="k">fun</span> <span class="i">save</span> <span class="p">(</span><span class="t">Text</span><span class="p">)</span>        <span class="o">=</span> <span class="c">(* Save text doc... *)</span>
  <span class="o">|</span> <span class="i">save</span> <span class="p">(</span><span class="t">Drawing</span><span class="p">)</span>     <span class="o">=</span> <span class="c">(* Save drawing doc... *)</span>
  <span class="o">|</span> <span class="i">save</span> <span class="p">(</span><span class="t">Spreadsheet</span><span class="p">)</span> <span class="o">=</span> <span class="c">(* Save spreadsheet... *)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">interface</span> <span class="t">Document</span>
  <span class="i">draw</span><span class="p">()</span>
  <span class="i">load</span><span class="p">()</span>
  <span class="i">save</span><span class="p">()</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">TextDocument</span>
  <span class="i">draw</span><span class="p">()</span> <span class="c">// Draw text doc...</span>
  <span class="i">load</span><span class="p">()</span> <span class="c">// Load text doc...</span>
  <span class="i">save</span><span class="p">()</span> <span class="c">// Save text doc...</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">DrawingDocument</span>
  <span class="i">draw</span><span class="p">()</span> <span class="c">// Draw drawing...</span>
  <span class="i">load</span><span class="p">()</span> <span class="c">// Load drawing...</span>
  <span class="i">save</span><span class="p">()</span> <span class="c">// Save drawing...</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">SpreadsheetDocument</span>
  <span class="i">draw</span><span class="p">()</span> <span class="c">// Draw spreadsheet...</span>
  <span class="i">load</span><span class="p">()</span> <span class="c">// Load spreadsheet...</span>
  <span class="i">save</span><span class="p">()</span> <span class="c">// Save spreadsheet...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">extend</span> <span class="k">interface</span> <span class="t">Document</span>
    <span class="i">print</span><span class="p">()</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="t">TextDocument</span> <span class="i">print</span><span class="p">()</span> <span class="c">// Print text doc...</span>
<span class="k">def</span> <span class="t">DrawingDocument</span> <span class="i">print</span><span class="p">()</span> <span class="c">// Print drawing...</span>
<span class="k">def</span> <span class="t">SpreadsheetDocument</span> <span class="i">print</span><span class="p">()</span> <span class="c">// Print spreadsheet...</span>
</code></pre></div>
<h2>2010/10/21/the-language-i-wish-go-was</h2>

<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">substring</span><span class="p">(</span><span class="i">from</span><span class="p">:</span> <span class="i">start</span><span class="p">,</span> <span class="i">to</span><span class="p">:</span> <span class="i">end</span><span class="p">)</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">substring__from__to</span><span class="p">(</span><span class="i">start</span><span class="p">,</span> <span class="i">end</span><span class="p">)</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">substring</span><span class="p">(</span><span class="i">from</span><span class="p">:</span> <span class="i">start</span><span class="p">,</span> <span class="i">to</span><span class="p">:</span> <span class="i">end</span><span class="p">)</span>
<span class="i">substring</span><span class="p">(</span><span class="i">from</span><span class="p">:</span> <span class="i">start</span><span class="p">,</span> <span class="i">length</span><span class="p">:</span> <span class="i">end</span><span class="p">)</span>
<span class="i">substring</span><span class="p">(</span><span class="i">from</span><span class="p">:</span> <span class="i">start</span><span class="p">)</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">file</span> <span class="p">:</span><span class="o">=</span> <span class="i">os</span><span class="p">.</span><span class="i">Open</span><span class="p">(</span><span class="i">filename</span><span class="p">)</span>
<span class="i">fmt</span><span class="p">.</span><span class="i">println</span><span class="p">(</span><span class="i">file</span><span class="p">.</span><span class="i">Read</span><span class="p">())</span>
<span class="i">file</span><span class="p">.</span><span class="i">Close</span><span class="p">()</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">func</span> <span class="i">ReadFile</span><span class="p">(</span><span class="i">filename</span> <span class="t">string</span><span class="p">,</span> <span class="i">block</span> <span class="k">func</span><span class="p">(</span><span class="i">f</span> <span class="o">*</span><span class="t">File</span><span class="p">))</span> <span class="p">{</span>
  <span class="i">file</span> <span class="p">:</span><span class="o">=</span> <span class="i">os</span><span class="p">.</span><span class="i">Open</span><span class="p">(</span><span class="i">filename</span><span class="p">)</span>
  <span class="i">block</span><span class="p">(</span><span class="i">file</span><span class="p">)</span>
  <span class="i">file</span><span class="p">.</span><span class="i">Close</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">ReadFile</span><span class="p">(</span><span class="i">filename</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="i">file</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">fmt</span><span class="p">.</span><span class="i">println</span><span class="p">(</span><span class="i">file</span><span class="p">.</span><span class="i">Read</span><span class="p">())</span>
<span class="p">})</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">ReadFile</span><span class="p">(</span><span class="i">filename</span><span class="p">)</span> <span class="k">do</span><span class="p">(</span><span class="i">file</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">fmt</span><span class="p">.</span><span class="i">println</span><span class="p">(</span><span class="i">file</span><span class="p">.</span><span class="i">Read</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">position</span> <span class="p">:</span><span class="o">=</span> <span class="i">origin</span> <span class="o">+</span> <span class="i">offset</span> <span class="o">+</span> <span class="i">orientation</span> <span class="o">*</span> <span class="i">speed</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">position</span> <span class="p">:</span><span class="o">=</span> <span class="i">Add</span><span class="p">(</span><span class="i">Add</span><span class="p">(</span><span class="i">origin</span><span class="p">,</span> <span class="i">offset</span><span class="p">),</span> <span class="i">Multiply</span><span class="p">(</span><span class="i">orientation</span><span class="p">,</span> <span class="i">speed</span><span class="p">))</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">point</span> <span class="p">:</span><span class="o">=</span> <span class="n">1</span><span class="p">,</span> <span class="n">2</span>          <span class="c">// Create a tuple of two ints.</span>
<span class="i">doSomething</span><span class="p">(</span><span class="i">true</span><span class="p">,</span> <span class="s">&quot;s&quot;</span><span class="p">)</span> <span class="c">// Pass a tuple to a function.</span>
<span class="k">return</span> <span class="i">value</span><span class="p">,</span> <span class="i">err</span>      <span class="c">// Return a tuple.</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">x</span><span class="p">,</span> <span class="i">y</span> <span class="p">:</span><span class="o">=</span> <span class="i">point</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">func</span> <span class="i">ParseInt</span><span class="p">(</span><span class="i">text</span> <span class="t">string</span><span class="p">)</span> <span class="t">int</span> <span class="o">|</span> <span class="o">*</span><span class="t">Error</span> <span class="p">{</span>
  <span class="c">// Code to parse...</span>
  <span class="k">if</span> <span class="i">success</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">value</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">ParseError</span><span class="p">(</span><span class="s">&quot;Could not parse string.&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">parsed</span> <span class="p">:</span><span class="o">=</span> <span class="i">ParseInt</span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">)</span>
<span class="k">switch</span> <span class="i">parsed</span> <span class="p">{</span>
<span class="k">case</span> <span class="t">int</span> <span class="k">as</span> <span class="i">i</span><span class="p">:</span>
  <span class="c">// Here, i is the parsed int value.</span>
<span class="k">case</span> <span class="o">*</span><span class="t">Error</span> <span class="k">as</span> <span class="i">err</span><span class="p">:</span>
  <span class="c">// Here, err is the error.</span>
<span class="p">}</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">pt</span> <span class="p">:</span><span class="o">=</span> <span class="i">Point</span><span class="p">(</span><span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">);</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="i">pt</span> <span class="p">:</span><span class="o">=</span> <span class="k">new</span> <span class="i">Point</span><span class="p">(</span><span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">);</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">func</span> <span class="i">CopyFile</span><span class="p">(</span><span class="i">dstName</span><span class="p">,</span> <span class="i">srcName</span> <span class="t">string</span><span class="p">)</span> <span class="p">(</span><span class="i">written</span> <span class="t">int64</span><span class="p">,</span> <span class="i">err</span> <span class="i">os</span><span class="p">.</span><span class="i">Error</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">src</span><span class="p">,</span> <span class="i">err</span> <span class="p">:</span><span class="o">=</span> <span class="i">os</span><span class="p">.</span><span class="i">Open</span><span class="p">(</span><span class="i">srcName</span><span class="p">,</span> <span class="i">os</span><span class="p">.</span><span class="i">O_RDONLY</span><span class="p">,</span> <span class="n">0</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">err</span> <span class="o">!=</span> <span class="i">nil</span> <span class="p">{</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="k">defer</span> <span class="i">src</span><span class="p">.</span><span class="i">Close</span><span class="p">()</span>

  <span class="i">dst</span><span class="p">,</span> <span class="i">err</span> <span class="p">:</span><span class="o">=</span> <span class="i">os</span><span class="p">.</span><span class="i">Open</span><span class="p">(</span><span class="i">dstName</span><span class="p">,</span> <span class="i">os</span><span class="p">.</span><span class="i">O_WRONLY</span><span class="o">|</span><span class="i">os</span><span class="p">.</span><span class="i">O_CREATE</span><span class="p">,</span> <span class="n">0644</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">err</span> <span class="o">!=</span> <span class="i">nil</span> <span class="p">{</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="k">defer</span> <span class="i">dst</span><span class="p">.</span><span class="i">Close</span><span class="p">()</span>

  <span class="k">return</span> <span class="i">io</span><span class="p">.</span><span class="i">Copy</span><span class="p">(</span><span class="i">dst</span><span class="p">,</span> <span class="i">src</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">try</span> <span class="p">{</span>
  <span class="t">File</span> <span class="i">file</span> <span class="o">=</span> <span class="i">openFile</span><span class="p">(</span><span class="i">filename</span><span class="p">);</span>
  <span class="i">file</span><span class="p">.</span><span class="i">read</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="t">RuntimeException</span> <span class="i">ex</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">System</span><span class="p">.</span><span class="i">out</span><span class="p">.</span><span class="i">println</span><span class="p">(</span><span class="s">&quot;Oh noes!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>1: MyObject::doSomething()
2: ThirdPartyLib::callMyObject()
3: MyCode::passObjectToLib()
4: main()
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="c">// CAUTION: If this file is not vector.go, it was generated</span>
<span class="c">// automatically from vector.go - DO NOT EDIT in that case!</span>
</code></pre></div>
<p>go</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="c">// Property getter like `vector.Magnitude`:</span>
<span class="k">func</span> <span class="p">(</span><span class="i">vector</span> <span class="o">*</span><span class="t">Vector</span><span class="p">)</span> <span class="i">Magnitude__get__</span><span class="p">()</span> <span class="i">float</span> <span class="p">{</span>
  <span class="c">// Calculate the magnitude of a vector...</span>
<span class="p">}</span>

<span class="c">// Property setter like `rect.Width = 4`:</span>
<span class="k">func</span> <span class="p">(</span><span class="i">rect</span> <span class="o">*</span><span class="t">Rect</span><span class="p">)</span> <span class="i">Width__set__</span><span class="p">(</span><span class="i">value</span> <span class="t">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// Set the width of the rectangle...</span>
<span class="p">}</span>

<span class="c">// Subscript operator like `list[index]`:</span>
<span class="k">func</span> <span class="p">(</span><span class="i">s</span> <span class="o">*</span><span class="t">StringList</span><span class="p">)</span> <span class="i">Subscript__</span><span class="p">(</span><span class="i">index</span> <span class="t">int</span><span class="p">)</span> <span class="t">string</span> <span class="p">{</span>
  <span class="c">// Get the element at index...</span>
<span class="p">}</span>

<span class="c">// Subscript operator in assignment like `list[index] = &quot;value&quot;`:</span>
<span class="k">func</span> <span class="p">(</span><span class="i">s</span> <span class="o">*</span><span class="t">StringList</span><span class="p">)</span> <span class="i">SubscriptSet__</span><span class="p">(</span><span class="i">index</span> <span class="t">int</span><span class="p">,</span> <span class="i">value</span> <span class="t">string</span><span class="p">)</span> <span class="t">string</span> <span class="p">{</span>
  <span class="c">// Set the element at index to value...</span>
<span class="p">}</span>

<span class="c">// Initialization function automatically called after `new(Thing)`</span>
<span class="c">// creates a zero-valued object.</span>
<span class="k">func</span> <span class="p">(</span><span class="i">t</span> <span class="o">*</span><span class="t">Thing</span><span class="p">)</span> <span class="i">Init__</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">// Initialize the value...</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="i">book</span><span class="p">.</span><span class="i">getChapters</span><span class="p">().</span><span class="i">put</span><span class="p">(</span><span class="i">book</span><span class="p">.</span><span class="i">getChapters</span><span class="p">().</span><span class="i">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">1</span><span class="p">,</span>
  <span class="t">ChapterFactory</span><span class="p">.</span><span class="i">instance</span><span class="p">().</span><span class="i">create</span><span class="p">(</span><span class="s">&quot;Prologue&quot;</span><span class="p">));</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="i">book</span><span class="p">.</span><span class="i">chapters</span><span class="p">[</span><span class="i">book</span><span class="p">.</span><span class="i">chapters</span><span class="p">.</span><span class="i">size</span> <span class="o">-</span> <span class="n">1</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Chapter</span><span class="p">(</span><span class="s">&quot;Prologue&quot;</span><span class="p">);</span>
</code></pre></div>
<h2>2010/10/29/bootstrapping-a-type-system</h2>

<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">i</span> <span class="o">=</span> <span class="n">123</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">list</span> <span class="i">add</span><span class="p">(</span><span class="s">&quot;item&quot;</span><span class="p">)</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">interface</span> <span class="t">Type</span> <span class="p">{</span>
  <span class="t">boolean</span> <span class="i">canAssignFrom</span><span class="p">(</span><span class="t">Type</span> <span class="i">other</span><span class="p">);</span>
  <span class="t">Type</span> <span class="i">getMemberType</span><span class="p">(</span><span class="t">String</span> <span class="i">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">monkey</span> <span class="o">=</span> <span class="t">Monkey</span> <span class="i">new</span><span class="p">(</span><span class="s">&quot;Bobo&quot;</span><span class="p">)</span>
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>(print)
   |
(string)
   |
  (+)
  &#47; \
(1) (2)
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">interface</span> <span class="t">Type</span>
  <span class="i">canAssignFrom</span><span class="p">(</span><span class="i">other</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Bool</span><span class="p">)</span>
  <span class="i">getMemberType</span><span class="p">(</span><span class="i">name</span> <span class="t">String</span> <span class="o">-&gt;</span> <span class="t">Type</span> <span class="o">|</span> <span class="t">Nothing</span><span class="p">)</span>
  <span class="c">// Some other stuff...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Interface</span>
  <span class="i">canAssignFrom</span><span class="p">(</span><span class="i">other</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Bool</span><span class="p">)</span>
    <span class="c">// Check that other type has every member of this one.</span>
    <span class="k">for</span> <span class="i">member</span> <span class="o">=</span> <span class="i">members</span> <span class="k">do</span>
      <span class="k">var</span> <span class="i">type</span> <span class="o">=</span> <span class="i">member</span> <span class="i">memberType</span><span class="p">()</span>
      <span class="k">let</span> <span class="i">otherMem</span> <span class="o">=</span> <span class="i">other</span> <span class="i">getMemberType</span><span class="p">(</span><span class="i">member</span> <span class="i">name</span><span class="p">)</span> <span class="k">then</span>
        <span class="c">// Must be assignable.</span>
        <span class="k">if</span> <span class="i">type</span> <span class="i">canAssignFrom</span><span class="p">(</span><span class="i">otherMem</span><span class="p">)</span> <span class="i">not</span> <span class="k">then</span> <span class="k">return</span> <span class="k">false</span>
        <span class="k">end</span>
      <span class="k">else</span> <span class="k">return</span> <span class="k">false</span> <span class="c">// Must have members.</span>
    <span class="k">end</span>

    <span class="c">// If we got here, every method was found and matched.</span>
    <span class="k">true</span>
  <span class="k">end</span>

  <span class="i">getMemberType</span><span class="p">(</span><span class="i">name</span> <span class="t">String</span> <span class="o">-&gt;</span> <span class="t">Type</span> <span class="o">|</span> <span class="t">Nothing</span><span class="p">)</span>
    <span class="k">let</span> <span class="i">member</span> <span class="o">=</span> <span class="i">members</span> <span class="i">first</span><span class="p">(</span>
          <span class="k">fn</span> <span class="p">(</span><span class="i">m</span> <span class="t">Member</span> <span class="o">-&gt;</span> <span class="t">Bool</span><span class="p">)</span> <span class="i">m</span> <span class="i">name</span> <span class="o">==</span> <span class="i">name</span><span class="p">)</span> <span class="k">then</span>
      <span class="i">member</span> <span class="i">memberType</span><span class="p">()</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c">// Other stuff...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">parseNumber</span><span class="p">(</span><span class="i">value</span> <span class="t">String</span> <span class="o">-&gt;</span> <span class="t">Int</span> <span class="o">|</span> <span class="t">Nothing</span><span class="p">)</span>
    <span class="c">// ...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">what</span><span class="p">(</span><span class="i">arg</span> <span class="i">doSomething</span><span class="p">(</span><span class="t">Very</span> <span class="o">*</span> <span class="t">Strange</span><span class="p">))</span>
</code></pre></div>
<h2>2010/11/08/refining-exceptions-and-error-codes</h2>

<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="t">Collection</span> <span class="i">getItemAt</span><span class="p">(</span><span class="i">index</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">Item</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">index</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">or</span> <span class="i">index</span> <span class="o">&gt;</span> <span class="i">count</span> <span class="k">then</span> <span class="t">OutOfBoundsError</span> <span class="i">throw</span><span class="p">()</span>

  <span class="c">// Do stuff with index...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="t">Int</span> <span class="i">checkBounds</span><span class="p">(</span><span class="i">count</span> <span class="t">Int</span> <span class="o">-&gt;</span><span class="p">)</span>
  <span class="k">if</span> <span class="k">this</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">or</span> <span class="k">this</span> <span class="o">&gt;</span> <span class="i">count</span> <span class="k">then</span> <span class="t">OutOfBoundsError</span> <span class="i">throw</span><span class="p">()</span>
<span class="k">end</span>

<span class="k">def</span> <span class="t">Collection</span> <span class="i">getItemAt</span><span class="p">(</span><span class="i">index</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">Item</span><span class="p">)</span>
  <span class="i">index</span> <span class="i">checkBounds</span><span class="p">(</span><span class="i">count</span><span class="p">)</span>

  <span class="c">// Do stuff with index...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">try</span>
  <span class="c">// Allocate a huge array...</span>
<span class="k">catch</span> <span class="p">(</span><span class="i">err</span> <span class="t">OutOfMemoryError</span><span class="p">)</span>
  <span class="c">// Handle the error...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">copy</span><span class="p">(</span><span class="i">source</span> <span class="t">String</span><span class="p">,</span> <span class="i">dest</span> <span class="t">String</span> <span class="o">-&gt;</span><span class="p">)</span>
  <span class="k">try</span>
    <span class="c">// Copy files...</span>
  <span class="k">catch</span> <span class="p">(</span><span class="i">e</span> <span class="t">IOError</span><span class="p">)</span>
    <span class="c">// Handle error...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">copy</span><span class="p">(</span><span class="i">source</span> <span class="t">String</span><span class="p">,</span> <span class="i">dest</span> <span class="t">String</span> <span class="o">-&gt;</span><span class="p">)</span>
  <span class="c">// Copy files...</span>
<span class="k">catch</span> <span class="p">(</span><span class="i">e</span> <span class="t">IOError</span><span class="p">)</span>
  <span class="c">// Handle error...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">parseBool</span><span class="p">(</span><span class="i">text</span> <span class="t">String</span> <span class="o">-&gt;</span> <span class="t">Bool</span><span class="p">)</span>
  <span class="k">match</span> <span class="i">text</span>
  <span class="k">case</span> <span class="s">&quot;true&quot;</span> <span class="k">then</span> <span class="k">true</span>
  <span class="k">case</span> <span class="s">&quot;false&quot;</span> <span class="k">then</span> <span class="k">false</span>
  <span class="k">else</span> <span class="c">// ??? What do we do here?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">b</span> <span class="o">=</span> <span class="i">parseBool</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">parseBool</span><span class="p">(</span><span class="i">text</span> <span class="t">String</span> <span class="o">-&gt;</span> <span class="t">Bool</span> <span class="o">|</span> <span class="t">Nothing</span><span class="p">)</span>
    <span class="k">match</span> <span class="i">text</span>
    <span class="k">case</span> <span class="s">&quot;true&quot;</span> <span class="k">then</span> <span class="k">true</span>
    <span class="k">case</span> <span class="s">&quot;false&quot;</span> <span class="k">then</span> <span class="k">false</span>
    <span class="k">else</span> <span class="k">nothing</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">b</span> <span class="o">=</span> <span class="i">parseBool</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span>
<span class="k">var</span> <span class="i">notB</span> <span class="o">=</span> <span class="i">b</span> <span class="i">not</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">let</span> <span class="i">b</span> <span class="o">=</span> <span class="i">parseBool</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span>
  <span class="c">// In here, b is a Bool.</span>
  <span class="k">var</span> <span class="i">notB</span> <span class="o">=</span> <span class="i">b</span> <span class="i">not</span> <span class="c">// This is fine</span>
<span class="k">else</span>
  <span class="c">// Parse failed...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="t">Object</span> <span class="i">expecting</span><span class="p">[</span><span class="t">T</span><span class="p">]</span>
  <span class="k">let</span> <span class="i">cast</span> <span class="o">=</span> <span class="k">this</span> <span class="k">as</span><span class="p">[</span><span class="t">T</span><span class="p">]</span> <span class="k">then</span>
    <span class="i">cast</span>
  <span class="k">else</span> <span class="t">UnexpectedTypeError</span> <span class="i">throw</span><span class="p">(</span>
      <span class="s">&quot;Expected type &quot;</span> <span class="o">+</span> <span class="t">T</span> <span class="o">+</span> <span class="s">&quot; but was &quot;</span> <span class="o">+</span> <span class="k">this</span> <span class="i">type</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// Doesn&#39;t expect a parse error.</span>
<span class="k">var</span> <span class="i">b</span> <span class="o">=</span> <span class="i">parseBool</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span> <span class="i">expecting</span><span class="p">[</span><span class="t">Bool</span><span class="p">]</span>
<span class="k">var</span> <span class="i">notB</span> <span class="o">=</span> <span class="i">b</span> <span class="i">not</span> <span class="c">// OK, since b is a Bool.</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">readFile</span><span class="p">(</span><span class="i">path</span> <span class="t">String</span> <span class="o">-&gt;</span> <span class="t">String</span> <span class="o">|</span> <span class="t">IOError</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">pathExists</span><span class="p">(</span><span class="i">path</span><span class="p">)</span> <span class="k">then</span>
    <span class="c">// Return contents of file...</span>
  <span class="k">else</span> <span class="t">IOError</span> <span class="i">new</span><span class="p">(</span><span class="s">&quot;Could not find &quot;</span> <span class="o">+</span> <span class="i">path</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">printFile</span><span class="p">(</span><span class="i">path</span> <span class="t">String</span> <span class="o">-&gt;</span><span class="p">)</span>
    <span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="i">readFile</span><span class="p">(</span><span class="i">path</span><span class="p">)</span>
    <span class="k">let</span> <span class="i">contents</span> <span class="o">=</span> <span class="i">result</span> <span class="k">as</span><span class="p">[</span><span class="t">String</span><span class="p">]</span> <span class="k">then</span>
        <span class="i">print</span><span class="p">(</span><span class="i">contents</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">let</span> <span class="i">error</span> <span class="o">=</span> <span class="i">result</span> <span class="k">as</span><span class="p">[</span><span class="t">IOError</span><span class="p">]</span> <span class="k">then</span>
        <span class="i">print</span><span class="p">(</span><span class="s">&quot;Error!&quot;</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">printFile</span><span class="p">(</span><span class="i">path</span> <span class="t">String</span> <span class="o">-&gt;</span><span class="p">)</span>
    <span class="k">var</span> <span class="i">contents</span> <span class="o">=</span> <span class="i">readFile</span><span class="p">(</span><span class="i">path</span><span class="p">)</span> <span class="i">expecting</span><span class="p">[</span><span class="t">String</span><span class="p">]</span>
    <span class="i">print</span><span class="p">(</span><span class="i">contents</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<h2>2010/12/14/the-trouble-with-constructors</h2>

<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Point</span>
  <span class="k">var</span> <span class="i">x</span> <span class="t">Int</span>
  <span class="k">var</span> <span class="i">y</span> <span class="t">Int</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">point</span> <span class="o">=</span> <span class="t">Point</span> <span class="i">new</span><span class="p">(</span><span class="i">x</span><span class="p">:</span> <span class="n">1</span> <span class="i">y</span><span class="p">:</span> <span class="n">2</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">coords</span> <span class="o">=</span> <span class="i">x</span><span class="p">:</span> <span class="n">1</span> <span class="i">y</span><span class="p">:</span> <span class="n">2</span>
<span class="k">var</span> <span class="i">point</span> <span class="o">=</span> <span class="t">Point</span> <span class="i">new</span><span class="p">(</span><span class="i">coords</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">new</span><span class="p">(</span><span class="i">arg</span><span class="p">)</span> <span class="i">construct</span><span class="p">(</span><span class="i">arg</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Point</span>
  <span class="k">shared</span> <span class="k">def</span> <span class="i">new</span><span class="p">(</span><span class="i">theta</span> <span class="t">Int</span><span class="p">,</span> <span class="i">radius</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">Point</span><span class="p">)</span>
    <span class="k">var</span> <span class="i">x</span> <span class="o">=</span> <span class="i">cos</span><span class="p">(</span><span class="i">theta</span><span class="p">)</span> <span class="o">*</span> <span class="i">radius</span>
    <span class="k">var</span> <span class="i">y</span> <span class="o">=</span> <span class="i">sin</span><span class="p">(</span><span class="i">theta</span><span class="p">)</span> <span class="o">*</span> <span class="i">radius</span>
    <span class="i">construct</span><span class="p">(</span><span class="i">x</span><span class="p">:</span> <span class="i">x</span> <span class="i">y</span><span class="p">:</span> <span class="i">y</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">var</span> <span class="i">x</span> <span class="t">Int</span>
  <span class="k">var</span> <span class="i">y</span> <span class="t">Int</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Point</span>
  <span class="c">// &#39;this&#39; here defines a constructor method</span>
  <span class="k">this</span><span class="p">(</span><span class="i">x</span> <span class="t">Int</span><span class="p">,</span> <span class="i">y</span> <span class="t">Int</span><span class="p">)</span>
    <span class="k">this</span> <span class="i">x</span> <span class="o">=</span> <span class="i">x</span>
    <span class="k">this</span> <span class="i">y</span> <span class="o">=</span> <span class="i">y</span>
  <span class="k">end</span>

  <span class="k">var</span> <span class="i">x</span> <span class="t">Int</span>
  <span class="k">var</span> <span class="i">y</span> <span class="t">Int</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Point</span>
  <span class="k">this</span><span class="p">(</span><span class="i">x</span> <span class="t">Int</span><span class="p">,</span> <span class="i">y</span> <span class="t">Int</span><span class="p">)</span>
    <span class="k">this</span> <span class="i">x</span> <span class="o">=</span> <span class="i">x</span>
  <span class="k">end</span>

  <span class="k">var</span> <span class="i">x</span> <span class="t">Int</span>
  <span class="k">var</span> <span class="i">y</span> <span class="t">Int</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">Point</span>
  <span class="k">this</span><span class="p">(</span><span class="i">x</span> <span class="t">Int</span><span class="p">,</span> <span class="i">y</span> <span class="t">Int</span><span class="p">)</span>
    <span class="i">doSomethingWithAPoint</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="k">this</span> <span class="i">x</span> <span class="o">=</span> <span class="i">x</span>
    <span class="k">this</span> <span class="i">y</span> <span class="o">=</span> <span class="i">y</span>
  <span class="k">end</span>

  <span class="k">var</span> <span class="i">x</span> <span class="t">Int</span>
  <span class="k">var</span> <span class="i">y</span> <span class="t">Int</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">this</span><span class="p">(</span><span class="i">x</span> <span class="t">Int</span><span class="p">,</span> <span class="i">y</span> <span class="t">Int</span><span class="p">)</span>
  <span class="c">// Here &#39;this&#39; is &quot;Point with no fields assigned&quot;.</span>
  <span class="k">this</span> <span class="i">x</span> <span class="o">=</span> <span class="i">x</span>
  <span class="c">// Now it&#39;s &quot;Point with x&quot;.</span>
  <span class="k">this</span> <span class="i">y</span> <span class="o">=</span> <span class="i">y</span>
  <span class="c">// Now it&#39;s &quot;Point with x and y&quot; and we&#39;re good.</span>
<span class="k">end</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">Point</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">Point</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">doSomethingWithPoint</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="i">x</span> <span class="o">=</span> <span class="i">x</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="i">y</span> <span class="o">=</span> <span class="i">y</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">final</span> <span class="t">int</span> <span class="i">x</span><span class="p">;</span>
  <span class="k">private</span> <span class="k">final</span> <span class="t">int</span> <span class="i">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>2010/12/31/rethinking-user-defined-operators</h2>

<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="p">(</span><span class="o">+</span> <span class="n">1</span> <span class="p">(</span><span class="o">*</span> <span class="n">2</span> <span class="n">3</span><span class="p">))</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="n">2</span> <span class="n">3</span> <span class="o">*</span> <span class="n">1</span> <span class="o">+</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">a</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span> <span class="o">+</span> <span class="n">1</span> <span class="c">// &quot;11&quot;</span>
<span class="k">var</span> <span class="i">b</span> <span class="o">=</span> <span class="n">1</span> <span class="o">+</span> <span class="s">&quot;1&quot;</span> <span class="c">// Error!</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">extend</span> <span class="k">interface</span> <span class="t">Type</span>
  <span class="k">def</span> <span class="o">|</span><span class="p">(</span><span class="i">other</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Type</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="t">Class</span> <span class="o">|</span><span class="p">(</span><span class="i">other</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Type</span><span class="p">)</span> <span class="t">OrType</span> <span class="i">combine</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">other</span><span class="p">)</span>
<span class="k">def</span> <span class="t">FunctionType</span> <span class="o">|</span><span class="p">(</span><span class="i">other</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Type</span><span class="p">)</span> <span class="t">OrType</span> <span class="i">combine</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">other</span><span class="p">)</span>
<span class="k">def</span> <span class="t">Interface</span> <span class="o">|</span><span class="p">(</span><span class="i">other</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Type</span><span class="p">)</span> <span class="t">OrType</span> <span class="i">combine</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">other</span><span class="p">)</span>
<span class="k">def</span> <span class="t">OrType</span> <span class="o">|</span><span class="p">(</span><span class="i">other</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Type</span><span class="p">)</span> <span class="t">OrType</span> <span class="i">combine</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">other</span><span class="p">)</span>
<span class="k">def</span> <span class="t">Tuple</span> <span class="o">|</span><span class="p">(</span><span class="i">other</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Type</span><span class="p">)</span> <span class="t">OrType</span> <span class="i">combine</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">other</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="o">+</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
   <span class="i">left</span> <span class="i">add</span><span class="p">(</span><span class="i">right</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="o">==</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
  <span class="i">left</span> <span class="i">equals</span><span class="p">(</span><span class="i">right</span><span class="p">)</span> <span class="k">and</span> <span class="i">right</span> <span class="i">equals</span><span class="p">(</span><span class="i">left</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="o">==</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
  <span class="c">// `same?` tests for identity, i.e. reference equality.</span>
  <span class="k">if</span> <span class="t">Reflect</span> <span class="i">same?</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="k">true</span>

  <span class="i">left</span> <span class="i">equals</span><span class="p">(</span><span class="i">right</span><span class="p">)</span> <span class="k">and</span> <span class="i">right</span> <span class="i">equals</span><span class="p">(</span><span class="i">left</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="o">==</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
  <span class="c">// `same?` tests for identity, i.e. reference equality.</span>
  <span class="k">if</span> <span class="t">Reflect</span> <span class="i">same?</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="k">true</span>

  <span class="k">if</span> <span class="i">left</span> <span class="o">==</span> <span class="k">nothing</span> <span class="k">then</span> <span class="k">return</span> <span class="k">false</span>
  <span class="k">if</span> <span class="i">right</span> <span class="o">==</span> <span class="k">nothing</span> <span class="k">then</span> <span class="k">return</span> <span class="k">false</span>

  <span class="i">left</span> <span class="i">equals</span><span class="p">(</span><span class="i">right</span><span class="p">)</span> <span class="k">and</span> <span class="i">right</span> <span class="i">equals</span><span class="p">(</span><span class="i">left</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="o">==</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
  <span class="c">// Must be same class.</span>
  <span class="k">var</span> <span class="i">leftClass</span> <span class="o">=</span> <span class="t">Reflect</span> <span class="i">getClass</span><span class="p">(</span><span class="i">left</span><span class="p">)</span>
  <span class="k">var</span> <span class="i">rightClass</span> <span class="o">=</span> <span class="t">Reflect</span> <span class="i">getClass</span><span class="p">(</span><span class="i">right</span><span class="p">)</span>
  <span class="k">if</span> <span class="t">Reflect</span> <span class="i">same?</span><span class="p">(</span><span class="i">leftClass</span><span class="p">,</span> <span class="i">rightClass</span><span class="p">)</span> <span class="i">not</span> <span class="k">then</span> <span class="k">return</span> <span class="k">false</span>

  <span class="c">// Now let the class itself determine equality.</span>
  <span class="i">leftClass</span> <span class="i">equal?</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="o">|</span><span class="p">(</span><span class="i">left</span> <span class="t">Type</span><span class="p">,</span> <span class="i">right</span> <span class="t">Type</span> <span class="o">-&gt;</span> <span class="t">Type</span><span class="p">)</span> <span class="t">OrType</span> <span class="i">combine</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="o">!=</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">right</span> <span class="o">-&gt;</span> <span class="t">Bool</span><span class="p">)</span> <span class="p">(</span><span class="i">left</span> <span class="o">==</span> <span class="i">right</span><span class="p">)</span> <span class="i">not</span>
</code></pre></div>
<h2>2011/01/16/pattern-matching-in-a-dynamic-oop-language</h2>

<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">switch</span> <span class="p">(</span><span class="i">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">1</span><span class="p">:</span>  <span class="i">printf</span><span class="p">(</span><span class="s">&quot;first&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">2</span><span class="p">:</span>  <span class="i">printf</span><span class="p">(</span><span class="s">&quot;second&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">3</span><span class="p">:</span>  <span class="i">printf</span><span class="p">(</span><span class="s">&quot;third&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="k">default</span><span class="p">:</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;uh...&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">try</span> <span class="p">{</span>
  <span class="c">// Do something crazy...</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="t">ParseException</span> <span class="i">ex</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">System</span><span class="p">.</span><span class="i">out</span><span class="p">.</span><span class="i">println</span><span class="p">(</span><span class="s">&quot;Parse error!&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="t">IOException</span> <span class="i">ex</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">System</span><span class="p">.</span><span class="i">out</span><span class="p">.</span><span class="i">println</span><span class="p">(</span><span class="s">&quot;IO error!&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="t">Exception</span> <span class="i">ex</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">System</span><span class="p">.</span><span class="i">out</span><span class="p">.</span><span class="i">println</span><span class="p">(</span><span class="s">&quot;Uh-oh!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">var</span> <span class="i">point</span> <span class="o">=</span> <span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">];</span>
<span class="k">var</span> <span class="p">[</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">]</span> <span class="o">=</span> <span class="i">point</span><span class="p">;</span> <span class="c">// Destructure point.</span>
<span class="i">alert</span><span class="p">(</span><span class="i">x</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="i">y</span><span class="p">);</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="n">123</span>
<span class="k">true</span>
<span class="s">&quot;a string&quot;</span>
<span class="n">3</span> <span class="o">+</span> <span class="n">5</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="n">3</span><span class="p">,</span> <span class="s">&quot;four&quot;</span><span class="p">,</span> <span class="k">false</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">x</span><span class="p">:</span> <span class="n">1</span><span class="p">,</span> <span class="i">y</span><span class="p">:</span> <span class="n">2</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">_</span>              <span class="c">// No name or type.</span>
<span class="i">a</span>              <span class="c">// Name but no type.</span>
<span class="i">position</span> <span class="t">Point</span> <span class="c">// Name and type.</span>
<span class="i">_</span> <span class="t">Int</span> <span class="o">|</span> <span class="t">String</span> <span class="c">// No name but type.</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">name</span><span class="p">:</span> <span class="s">&quot;Dan&quot;</span><span class="p">,</span> <span class="i">pals</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;Sam&quot;</span><span class="p">,</span> <span class="s">&quot;Ed&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">name</span><span class="p">:</span> <span class="i">n</span><span class="p">,</span> <span class="i">pals</span><span class="p">:</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">match</span> <span class="i">i</span>
    <span class="k">case</span> <span class="n">1</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;first&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">2</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;second&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">3</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;third&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="i">_</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;uh...&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">match</span> <span class="i">name</span><span class="p">:</span> <span class="s">&quot;Dan&quot;</span><span class="p">,</span> <span class="i">pals</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;Sam&quot;</span><span class="p">,</span> <span class="s">&quot;Ed&quot;</span><span class="p">)</span>
  <span class="k">case</span> <span class="i">name</span><span class="p">:</span> <span class="s">&quot;Dave&quot;</span> <span class="k">then</span> <span class="s">&quot;don&#39;t care about Dave&#39;s friends&quot;</span>
  <span class="k">case</span> <span class="i">name</span><span class="p">:</span> <span class="i">a</span><span class="p">,</span> <span class="i">pals</span><span class="p">:</span> <span class="k">nothing</span> <span class="k">then</span> <span class="i">a</span> <span class="o">~</span> <span class="s">&quot; has no friends&quot;</span>
  <span class="k">case</span> <span class="i">name</span><span class="p">:</span> <span class="i">n</span><span class="p">,</span> <span class="i">pals</span><span class="p">:</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="k">then</span>
      <span class="i">n</span> <span class="o">~</span> <span class="s">&quot; is pals with &quot;</span> <span class="o">~</span> <span class="i">a</span> <span class="o">~</span> <span class="s">&quot; and &quot;</span> <span class="o">~</span> <span class="i">b</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">do</span>
  <span class="c">// Do something crazy...</span>
<span class="k">catch</span> <span class="i">ex</span> <span class="t">ParseException</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;Parse error!&quot;</span><span class="p">)</span>
<span class="k">catch</span> <span class="i">ex</span> <span class="t">IOException</span>    <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;IO error!&quot;</span><span class="p">)</span>
<span class="k">catch</span> <span class="i">_</span>                 <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;Uh-oh!&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">i</span> <span class="o">=</span> <span class="s">&quot;the queen of France&quot;</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">name</span><span class="p">:</span> <span class="i">n</span><span class="p">,</span> <span class="i">pals</span><span class="p">:</span> <span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="o">=</span> <span class="i">name</span><span class="p">:</span> <span class="s">&quot;Dan&quot;</span><span class="p">,</span> <span class="i">pals</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;Sam&quot;</span><span class="p">,</span> <span class="s">&quot;Ed&quot;</span><span class="p">)</span>
<span class="i">print</span><span class="p">(</span><span class="i">n</span><span class="p">)</span> <span class="c">// &quot;Dan&quot;</span>
<span class="i">print</span><span class="p">(</span><span class="i">a</span><span class="p">)</span> <span class="c">// &quot;Sam&quot;</span>
<span class="i">print</span><span class="p">(</span><span class="i">b</span><span class="p">)</span> <span class="c">// &quot;Ed&quot;</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">foo</span><span class="p">(</span><span class="i">name</span><span class="p">:</span> <span class="i">n</span> <span class="t">String</span><span class="p">,</span> <span class="i">pals</span><span class="p">:</span> <span class="p">(</span><span class="i">a</span> <span class="t">String</span><span class="p">,</span> <span class="i">b</span> <span class="t">String</span><span class="p">))</span>
  <span class="i">print</span><span class="p">(</span><span class="i">n</span><span class="p">)</span> <span class="c">// &quot;Dan&quot;</span>
  <span class="i">print</span><span class="p">(</span><span class="i">a</span><span class="p">)</span> <span class="c">// &quot;Sam&quot;</span>
  <span class="i">print</span><span class="p">(</span><span class="i">b</span><span class="p">)</span> <span class="c">// &quot;Ed&quot;</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">sayAge</span><span class="p">(</span><span class="i">name</span> <span class="t">String</span><span class="p">,</span> <span class="i">age</span> <span class="t">Int</span><span class="p">)</span>
    <span class="i">print</span><span class="p">(</span><span class="i">name</span> <span class="o">~</span> <span class="s">&quot; is &quot;</span> <span class="o">~</span> <span class="i">age</span> <span class="o">~</span> <span class="s">&quot; years old&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">match</span> <span class="s">&quot;not an int&quot;</span>
  <span class="k">case</span> <span class="n">1</span> <span class="k">then</span> <span class="s">&quot;match a string with an int?&quot;</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">expectInt</span><span class="p">(</span><span class="i">i</span> <span class="t">Int</span><span class="p">)</span> <span class="i">print</span><span class="p">(</span><span class="i">i</span><span class="p">)</span>
<span class="i">expectInt</span><span class="p">(</span><span class="s">&quot;not an int&quot;</span><span class="p">)</span>
</code></pre></div>
<h2>2011/02/13/extending-syntax-from-within-a-language</h2>

<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">doStuff</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">a</span> <span class="k">and</span> <span class="i">b</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;Both &quot;</span> <span class="o">~</span> <span class="i">a</span> <span class="o">~</span> <span class="s">&quot; and &quot;</span> <span class="o">~</span> <span class="i">b</span> <span class="o">~</span> <span class="s">&quot; are truthy&quot;</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;Their sum is &quot;</span> <span class="o">~</span> <span class="i">a</span> <span class="o">+</span> <span class="i">b</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">public</span> <span class="t">Expr</span> <span class="i">parseExpression</span><span class="p">(</span><span class="t">int</span> <span class="i">stickiness</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">Token</span> <span class="i">token</span> <span class="o">=</span> <span class="i">consume</span><span class="p">();</span>
  <span class="t">PrefixParser</span> <span class="i">prefix</span> <span class="o">=</span> <span class="i">mGrammar</span><span class="p">.</span><span class="i">getPrefixParser</span><span class="p">(</span><span class="i">token</span><span class="p">);</span>
  <span class="t">Expect</span><span class="p">.</span><span class="i">notNull</span><span class="p">(</span><span class="i">prefix</span><span class="p">);</span>
  <span class="t">Expr</span> <span class="i">left</span> <span class="o">=</span> <span class="i">prefix</span><span class="p">.</span><span class="i">parse</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">token</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="i">stickiness</span> <span class="o">&lt;</span> <span class="i">mGrammar</span><span class="p">.</span><span class="i">getStickiness</span><span class="p">(</span><span class="i">current</span><span class="p">()))</span> <span class="p">{</span>
    <span class="i">token</span> <span class="o">=</span> <span class="i">consume</span><span class="p">();</span>

    <span class="t">InfixParser</span> <span class="i">infix</span> <span class="o">=</span> <span class="i">mGrammar</span><span class="p">.</span><span class="i">getInfixParser</span><span class="p">(</span><span class="i">token</span><span class="p">);</span>
    <span class="i">left</span> <span class="o">=</span> <span class="i">infix</span><span class="p">.</span><span class="i">parse</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">left</span><span class="p">,</span> <span class="i">token</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="i">left</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">interface</span> <span class="t">PrefixParser</span> <span class="p">{</span>
  <span class="t">Expr</span> <span class="i">parse</span><span class="p">(</span><span class="t">MagpieParser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="t">InfixParser</span> <span class="p">{</span>
  <span class="t">Expr</span> <span class="i">parse</span><span class="p">(</span><span class="t">MagpieParser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Expr</span> <span class="i">left</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">);</span>
  <span class="t">int</span> <span class="i">getStickiness</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">private</span> <span class="k">static</span> <span class="k">class</span> <span class="t">MagpieInfixParser</span> <span class="k">extends</span> <span class="t">InfixParser</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">MagpieInfixParser</span><span class="p">(</span><span class="t">Interpreter</span> <span class="i">interpreter</span><span class="p">,</span> <span class="t">Obj</span> <span class="i">parser</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">mInterpreter</span> <span class="o">=</span> <span class="i">interpreter</span><span class="p">;</span>
    <span class="i">mParser</span> <span class="o">=</span> <span class="i">parser</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="t">Expr</span> <span class="i">parse</span><span class="p">(</span><span class="t">MagpieParser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Expr</span> <span class="i">left</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// Wrap the Java parser in a Magpie one.</span>
    <span class="t">Obj</span> <span class="i">parserObj</span> <span class="o">=</span> <span class="i">mInterpreter</span><span class="p">.</span><span class="i">instantiate</span><span class="p">(</span>
        <span class="i">mInterpreter</span><span class="p">.</span><span class="i">getMagpieParserClass</span><span class="p">(),</span> <span class="i">parser</span><span class="p">);</span>
    <span class="t">Obj</span> <span class="i">exprObj</span> <span class="o">=</span> <span class="t">JavaToMagpie</span><span class="p">.</span><span class="i">convert</span><span class="p">(</span><span class="i">mInterpreter</span><span class="p">,</span> <span class="i">left</span><span class="p">);</span>
    <span class="t">Obj</span> <span class="i">tokenObj</span> <span class="o">=</span> <span class="t">JavaToMagpie</span><span class="p">.</span><span class="i">convert</span><span class="p">(</span><span class="i">mInterpreter</span><span class="p">,</span> <span class="i">token</span><span class="p">);</span>
    <span class="t">Obj</span> <span class="i">arg</span> <span class="o">=</span> <span class="i">mInterpreter</span><span class="p">.</span><span class="i">createTuple</span><span class="p">(</span>
        <span class="i">parserObj</span><span class="p">,</span> <span class="i">exprObj</span><span class="p">,</span> <span class="i">tokenObj</span><span class="p">);</span>

    <span class="c">// Let the Magpie code do the parsing.</span>
    <span class="t">Obj</span> <span class="i">expr</span> <span class="o">=</span> <span class="i">mInterpreter</span><span class="p">.</span><span class="i">invokeMethod</span><span class="p">(</span><span class="i">mParser</span><span class="p">,</span> <span class="s">&quot;parse&quot;</span><span class="p">,</span> <span class="i">arg</span><span class="p">);</span>

    <span class="c">// Marshall it back to Java format.</span>
    <span class="k">return</span> <span class="t">MagpieToJava</span><span class="p">.</span><span class="i">convertExpr</span><span class="p">(</span><span class="i">mInterpreter</span><span class="p">,</span> <span class="i">expr</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="t">int</span> <span class="i">getStickiness</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">mInterpreter</span><span class="p">.</span><span class="i">getMember</span><span class="p">(</span><span class="t">Position</span><span class="p">.</span><span class="i">none</span><span class="p">(),</span>
        <span class="i">mParser</span><span class="p">,</span> <span class="s">&quot;stickiness&quot;</span><span class="p">).</span><span class="i">asInt</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="t">Interpreter</span> <span class="i">mInterpreter</span><span class="p">;</span>
  <span class="k">private</span> <span class="t">Obj</span> <span class="i">mParser</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">class</span> <span class="t">AndParser</span>
  <span class="k">def</span> <span class="i">parse</span><span class="p">(</span><span class="i">parser</span> <span class="t">MagpieParser</span><span class="p">,</span> <span class="i">left</span> <span class="t">Expression</span><span class="p">,</span>
        <span class="i">token</span> <span class="t">Token</span> <span class="o">-&gt;</span> <span class="t">Expression</span><span class="p">)</span>
    <span class="c">// Ignore a newline after &quot;and&quot;.</span>
    <span class="i">parser</span> <span class="i">matchToken</span><span class="p">(</span><span class="t">TokenType</span> <span class="i">line</span><span class="p">)</span>
    <span class="k">var</span> <span class="i">right</span> <span class="o">=</span> <span class="i">parser</span> <span class="i">parseExpression</span><span class="p">(</span><span class="i">stickiness</span><span class="p">)</span>
    <span class="p">{</span> <span class="k">do</span>
      <span class="k">var</span> <span class="i">temp__</span> <span class="o">=</span> <span class="r">`left</span>
      <span class="k">match</span> <span class="i">temp__</span> <span class="i">true?</span>
        <span class="k">case</span> <span class="k">true</span> <span class="k">then</span> <span class="r">`right</span>
        <span class="k">else</span> <span class="i">temp__</span>
      <span class="k">end</span>
    <span class="k">end</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="i">get</span> <span class="i">stickiness</span> <span class="t">Int</span> <span class="o">=</span> <span class="n">30</span>
<span class="k">end</span>

<span class="t">MagpieParser</span> <span class="i">registerInfixParser</span><span class="p">(</span><span class="s">&quot;and&quot;</span><span class="p">,</span> <span class="t">AndParser</span> <span class="i">new</span><span class="p">())</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="t">CallExpression</span> <span class="i">new</span><span class="p">(</span><span class="t">MessageExpression</span><span class="p">(</span><span class="i">name</span><span class="p">:</span> <span class="s">&quot;+&quot;</span><span class="p">),</span>
    <span class="t">TupleExpression</span> <span class="i">new</span><span class="p">(</span><span class="t">List</span> <span class="i">of</span><span class="p">(</span>
        <span class="t">IntExpression</span> <span class="i">new</span><span class="p">(</span><span class="n">1</span><span class="p">),</span> <span class="t">IntExpression</span> <span class="i">new</span><span class="p">(</span><span class="n">2</span><span class="p">))))</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="p">{</span> <span class="n">1</span> <span class="o">+</span> <span class="n">2</span> <span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">happy</span> <span class="k">and</span> <span class="i">know</span><span class="p">(</span><span class="k">it</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">do</span>
    <span class="k">var</span> <span class="i">temp__</span> <span class="o">=</span> <span class="i">happy</span>
    <span class="k">match</span> <span class="i">temp__</span> <span class="i">true?</span>
        <span class="k">case</span> <span class="k">true</span> <span class="k">then</span> <span class="i">know</span><span class="p">(</span><span class="k">it</span><span class="p">)</span>
        <span class="k">else</span> <span class="i">temp__</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">definfix</span> <span class="o">~*</span> <span class="n">60</span> <span class="p">(</span><span class="i">left</span> <span class="t">String</span><span class="p">,</span> <span class="i">count</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">String</span><span class="p">)</span>
  <span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
  <span class="k">for</span> <span class="i">i</span> <span class="o">=</span> <span class="n">1</span> <span class="i">to</span><span class="p">(</span><span class="i">count</span><span class="p">)</span> <span class="k">do</span> <span class="i">result</span> <span class="o">=</span> <span class="i">result</span> <span class="o">~</span> <span class="i">left</span>
  <span class="i">result</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="s">&quot;Beetlejuice &quot;</span> <span class="o">~*</span> <span class="n">3</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="o">~*</span><span class="p">(</span><span class="s">&quot;Beetlejuice &quot;</span><span class="p">,</span> <span class="n">3</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// In repeat.mag:</span>
<span class="i">definfix</span> <span class="o">~*</span> <span class="n">60</span> <span class="p">(</span><span class="i">left</span> <span class="t">String</span><span class="p">,</span> <span class="i">count</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">String</span><span class="p">)</span>
  <span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
  <span class="k">for</span> <span class="i">i</span> <span class="o">=</span> <span class="n">1</span> <span class="i">to</span><span class="p">(</span><span class="i">count</span><span class="p">)</span> <span class="k">do</span> <span class="i">result</span> <span class="o">=</span> <span class="i">result</span> <span class="o">~</span> <span class="i">left</span>
  <span class="i">result</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// In summon-ghost.mag:</span>
<span class="k">import</span><span class="p">(</span><span class="s">&quot;repeat.mag&quot;</span><span class="p">)</span>

<span class="i">print</span><span class="p">(</span><span class="s">&quot;Beetlejuice &quot;</span> <span class="o">~*</span> <span class="n">3</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">definfix</span> <span class="o">~*</span> <span class="n">60</span> <span class="p">(</span><span class="i">left</span> <span class="t">String</span><span class="p">,</span> <span class="i">count</span> <span class="t">Int</span> <span class="o">-&gt;</span> <span class="t">String</span><span class="p">)</span>
  <span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
  <span class="k">for</span> <span class="i">i</span> <span class="o">=</span> <span class="n">1</span> <span class="i">to</span><span class="p">(</span><span class="i">count</span><span class="p">)</span> <span class="k">do</span> <span class="i">result</span> <span class="o">=</span> <span class="i">result</span> <span class="o">~</span> <span class="i">left</span>
  <span class="i">result</span>
<span class="k">end</span>

<span class="i">print</span><span class="p">(</span><span class="s">&quot;Beetlejuice &quot;</span> <span class="o">~*</span> <span class="n">3</span><span class="p">)</span>
</code></pre></div>
<h2>2011/02/21/multiple-inheritance-in-javascript</h2>

<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart">       ┌────────┐
       │ Widget │
       └────┬───┘
            │
     ┌──────┴──────┐
┌────┴─────┐ ┌─────┴─────┐
│ Hideable │ │ Container │
└──────────┘ └───────────┘
</code></pre></div>
<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart"> ┌────────┐
 │ Widget │
 └────┬───┘
┌─────┴─────┐
│ Container │
└─────┬─────┘
┌─────┴────┐
│ Hideable │
└──────────┘
</code></pre></div>
<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart"> ┌────────┐
 │ Widget │
 └────┬───┘
┌─────┴────┐
│ Hideable │
└─────┬────┘
┌─────┴─────┐
│ Container │
└───────────┘
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">function</span> <span class="t">Widget</span><span class="p">(</span><span class="i">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="i">name</span> <span class="o">=</span> <span class="i">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="t">Widget</span><span class="p">.</span><span class="i">prototype</span><span class="p">.</span><span class="i">getName</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="i">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="t">Hideable</span><span class="p">()</span> <span class="p">{}</span>

<span class="t">Hideable</span><span class="p">.</span><span class="i">prototype</span><span class="p">.</span><span class="i">hide</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="i">log</span><span class="p">(</span><span class="s">&#39;hide &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="i">getName</span><span class="p">());</span>
<span class="p">}</span>

<span class="t">Hideable</span><span class="p">.</span><span class="i">prototype</span><span class="p">.</span><span class="i">show</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="i">log</span><span class="p">(</span><span class="s">&#39;show &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="i">getName</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">function</span> <span class="t">Container</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="i">children</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">}</span>

<span class="t">Container</span><span class="p">.</span><span class="i">prototype</span><span class="p">.</span><span class="i">addChild</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="i">widget</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">log</span><span class="p">(</span><span class="s">&#39;addChild &#39;</span> <span class="o">+</span> <span class="i">widget</span><span class="p">.</span><span class="i">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; to &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="i">getName</span><span class="p">());</span>
  <span class="k">this</span><span class="p">.</span><span class="i">children</span><span class="p">.</span><span class="i">push</span><span class="p">(</span><span class="i">widget</span><span class="p">);</span>
<span class="p">}</span>

<span class="t">Container</span><span class="p">.</span><span class="i">prototype</span><span class="p">.</span><span class="i">listChildren</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="i">log</span><span class="p">(</span><span class="s">&#39;children for &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="i">getName</span><span class="p">());</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">i</span> <span class="o">&amp;</span><span class="i">lt</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="i">children</span><span class="p">.</span><span class="i">length</span><span class="p">;</span> <span class="i">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">log</span><span class="p">(</span><span class="s">&#39;- &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="i">children</span><span class="p">[</span><span class="i">i</span><span class="p">].</span><span class="i">getName</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">var</span> <span class="t">MyWidget</span> <span class="o">=</span> <span class="i">magic</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="i">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="i">widget_p</span>    <span class="o">=</span> <span class="k">new</span> <span class="t">Widget</span><span class="p">(</span><span class="i">name</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="i">hider_p</span>     <span class="o">=</span> <span class="k">new</span> <span class="t">Hideable</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="i">container_p</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Container</span><span class="p">();</span>
<span class="p">})</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">var</span> <span class="i">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="t">MyWidget</span><span class="p">(</span><span class="s">&#39;Abe&#39;</span><span class="p">);</span>

<span class="c">// From Widget:</span>
<span class="i">log</span><span class="p">(</span><span class="i">widget</span><span class="p">.</span><span class="i">getName</span><span class="p">());</span>

<span class="c">// From Hideable:</span>
<span class="i">widget</span><span class="p">.</span><span class="i">hide</span><span class="p">();</span>
<span class="i">widget</span><span class="p">.</span><span class="i">show</span><span class="p">();</span>

<span class="c">// From Container:</span>
<span class="i">widget</span><span class="p">.</span><span class="i">addChild</span><span class="p">(</span><span class="k">new</span> <span class="t">MyWidget</span><span class="p">(</span><span class="s">&#39;Ben&#39;</span><span class="p">));</span>
<span class="i">widget</span><span class="p">.</span><span class="i">addChild</span><span class="p">(</span><span class="k">new</span> <span class="t">MyWidget</span><span class="p">(</span><span class="s">&#39;Cid&#39;</span><span class="p">));</span>
<span class="i">widget</span><span class="p">.</span><span class="i">addChild</span><span class="p">(</span><span class="k">new</span> <span class="t">MyWidget</span><span class="p">(</span><span class="s">&#39;Dan&#39;</span><span class="p">));</span>
<span class="i">widget</span><span class="p">.</span><span class="i">listChildren</span><span class="p">();</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">function</span> <span class="i">createSelfHandler</span><span class="p">(</span><span class="i">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="i">get</span><span class="p">:</span> <span class="k">function</span><span class="p">(</span><span class="i">receiver</span><span class="p">,</span> <span class="i">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="c">// Look in the main object.</span>
      <span class="k">var</span> <span class="i">value</span> <span class="o">=</span> <span class="i">obj</span><span class="p">[</span><span class="i">name</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">value</span> <span class="o">!==</span> <span class="i">undefined</span><span class="p">)</span> <span class="k">return</span> <span class="i">value</span><span class="p">;</span>

      <span class="c">// Look in the parents.</span>
      <span class="c">// BUG: Should look in field alphabetical order.</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">field</span> <span class="k">in</span> <span class="i">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">field</span><span class="p">.</span><span class="i">endsWith</span><span class="p">(</span><span class="s">&#39;_p&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="i">value</span> <span class="o">=</span> <span class="i">obj</span><span class="p">[</span><span class="i">field</span><span class="p">][</span><span class="i">name</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="i">value</span> <span class="o">!==</span> <span class="i">undefined</span><span class="p">)</span> <span class="k">return</span> <span class="i">value</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="c">// Not found.</span>
      <span class="k">return</span> <span class="i">undefined</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">function</span> <span class="i">magic</span><span class="p">(</span><span class="i">ctor</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">callTrap</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="i">args</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">var</span> <span class="i">constructTrap</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="i">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="t">Proxy</span><span class="p">.</span><span class="i">create</span><span class="p">(</span><span class="i">createSelfHandler</span><span class="p">(</span>
        <span class="k">new</span> <span class="i">ctor</span><span class="p">(</span><span class="i">args</span><span class="p">)),</span> <span class="t">Object</span><span class="p">.</span><span class="i">prototype</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="t">Proxy</span><span class="p">.</span><span class="i">createFunction</span><span class="p">(</span><span class="i">ctor</span><span class="p">,</span> <span class="i">callTrap</span><span class="p">,</span> <span class="i">constructTrap</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">var</span> <span class="i">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="t">MyWidget</span><span class="p">(</span><span class="s">&#39;Abe&#39;</span><span class="p">);</span>

<span class="c">// From Widget:</span>
<span class="i">log</span><span class="p">(</span><span class="i">widget</span><span class="p">.</span><span class="i">getWidget</span><span class="p">().</span><span class="i">getName</span><span class="p">());</span>

<span class="c">// From Hideable:</span>
<span class="i">widget</span><span class="p">.</span><span class="i">getHideable</span><span class="p">().</span><span class="i">hide</span><span class="p">();</span>

<span class="c">// From Container:</span>
<span class="i">widget</span><span class="p">.</span><span class="i">getContainer</span><span class="p">().</span><span class="i">addChild</span><span class="p">(</span><span class="k">new</span> <span class="t">MyWidget</span><span class="p">(</span><span class="s">&#39;Ben&#39;</span><span class="p">));</span>
</code></pre></div>
<h2>2011/03/19/pratt-parsers-expression-parsing-made-easy</h2>

<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>NAME &quot;from&quot;
PLUS &quot;+&quot;
NAME &quot;offset&quot;
LEFT_PAREN &quot;(&quot;
NAME &quot;time&quot;
RIGHT_PAREN &quot;)&quot;
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">ConditionalExpression</span> <span class="k">implements</span> <span class="t">Expression</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">ConditionalExpression</span><span class="p">(</span>
      <span class="t">Expression</span> <span class="i">condition</span><span class="p">,</span>
      <span class="t">Expression</span> <span class="i">thenArm</span><span class="p">,</span>
      <span class="t">Expression</span> <span class="i">elseArm</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="i">condition</span> <span class="o">=</span> <span class="i">condition</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="i">thenArm</span>   <span class="o">=</span> <span class="i">thenArm</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="i">elseArm</span>   <span class="o">=</span> <span class="i">elseArm</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">final</span> <span class="t">Expression</span> <span class="i">condition</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">final</span> <span class="t">Expression</span> <span class="i">thenArm</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">final</span> <span class="t">Expression</span> <span class="i">elseArm</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="t">Expression</span> <span class="i">parseExpression</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">match</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">NAME</span><span class="p">))</span>       <span class="c">// Return NameExpression...</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">match</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">PLUS</span><span class="p">))</span>  <span class="c">// Return prefix + operator...</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">match</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">MINUS</span><span class="p">))</span> <span class="c">// Return prefix - operator...</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">match</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">TILDE</span><span class="p">))</span> <span class="c">// Return prefix ~ operator...</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">match</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">BANG</span><span class="p">))</span>  <span class="c">// Return prefix ! operator...</span>
  <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="t">ParseException</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">interface</span> <span class="t">PrefixParselet</span> <span class="p">{</span>
  <span class="t">Expression</span> <span class="i">parse</span><span class="p">(</span><span class="t">Parser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">NameParselet</span> <span class="k">implements</span> <span class="t">PrefixParselet</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">Expression</span> <span class="i">parse</span><span class="p">(</span><span class="t">Parser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="t">NameExpression</span><span class="p">(</span><span class="i">token</span><span class="p">.</span><span class="i">getText</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">PrefixOperatorParselet</span> <span class="k">implements</span> <span class="t">PrefixParselet</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">Expression</span> <span class="i">parse</span><span class="p">(</span><span class="t">Parser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="t">Expression</span> <span class="i">operand</span> <span class="o">=</span> <span class="i">parser</span><span class="p">.</span><span class="i">parseExpression</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="t">PrefixExpression</span><span class="p">(</span><span class="i">token</span><span class="p">.</span><span class="i">getType</span><span class="p">(),</span> <span class="i">operand</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">Parser</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">Expression</span> <span class="i">parseExpression</span><span class="p">()</span> <span class="p">{</span>
    <span class="t">Token</span> <span class="i">token</span> <span class="o">=</span> <span class="i">consume</span><span class="p">();</span>
    <span class="t">PrefixParselet</span> <span class="i">prefix</span> <span class="o">=</span> <span class="i">mPrefixParselets</span><span class="p">.</span><span class="i">get</span><span class="p">(</span><span class="i">token</span><span class="p">.</span><span class="i">getType</span><span class="p">());</span>

    <span class="k">if</span> <span class="p">(</span><span class="i">prefix</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="t">ParseException</span><span class="p">(</span>
        <span class="s">&quot;Could not parse </span><span class="e">\&quot;</span><span class="s">&quot;</span> <span class="o">+</span> <span class="i">token</span><span class="p">.</span><span class="i">getText</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="e">\&quot;</span><span class="s">.&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="i">prefix</span><span class="p">.</span><span class="i">parse</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">token</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c">// Other stuff...</span>

  <span class="k">private</span> <span class="k">final</span> <span class="t">Map</span><span class="o">&lt;</span><span class="t">TokenType</span><span class="p">,</span> <span class="t">PrefixParselet</span><span class="o">&gt;</span> <span class="i">mPrefixParselets</span> <span class="o">=</span>
      <span class="k">new</span> <span class="t">HashMap</span><span class="o">&lt;</span><span class="t">TokenType</span><span class="p">,</span> <span class="t">PrefixParselet</span><span class="o">&gt;</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">public</span> <span class="t">void</span> <span class="i">register</span><span class="p">(</span><span class="t">TokenType</span> <span class="i">token</span><span class="p">,</span> <span class="t">PrefixParselet</span> <span class="i">parselet</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">mPrefixParselets</span><span class="p">.</span><span class="i">put</span><span class="p">(</span><span class="i">token</span><span class="p">,</span> <span class="i">parselet</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="t">void</span> <span class="i">prefix</span><span class="p">(</span><span class="t">TokenType</span> <span class="i">token</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">register</span><span class="p">(</span><span class="i">token</span><span class="p">,</span> <span class="k">new</span> <span class="t">PrefixOperatorParselet</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="i">register</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">NAME</span><span class="p">,</span> <span class="k">new</span> <span class="t">NameParselet</span><span class="p">());</span>
<span class="i">prefix</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">PLUS</span><span class="p">);</span>
<span class="i">prefix</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">MINUS</span><span class="p">);</span>
<span class="i">prefix</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">TILDE</span><span class="p">);</span>
<span class="i">prefix</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">BANG</span><span class="p">);</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">-</span><span class="i">a</span> <span class="o">+</span> <span class="i">b</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">interface</span> <span class="t">InfixParselet</span> <span class="p">{</span>
  <span class="t">Expression</span> <span class="i">parse</span><span class="p">(</span><span class="t">Parser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Expression</span> <span class="i">left</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">Parser</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">void</span> <span class="i">register</span><span class="p">(</span><span class="t">TokenType</span> <span class="i">token</span><span class="p">,</span> <span class="t">InfixParselet</span> <span class="i">parselet</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">mInfixParselets</span><span class="p">.</span><span class="i">put</span><span class="p">(</span><span class="i">token</span><span class="p">,</span> <span class="i">parselet</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="t">Expression</span> <span class="i">parseExpression</span><span class="p">()</span> <span class="p">{</span>
    <span class="t">Token</span> <span class="i">token</span> <span class="o">=</span> <span class="i">consume</span><span class="p">();</span>
    <span class="t">PrefixParselet</span> <span class="i">prefix</span> <span class="o">=</span> <span class="i">mPrefixParselets</span><span class="p">.</span><span class="i">get</span><span class="p">(</span><span class="i">token</span><span class="p">.</span><span class="i">getType</span><span class="p">());</span>

    <span class="k">if</span> <span class="p">(</span><span class="i">prefix</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="t">ParseException</span><span class="p">(</span>
        <span class="s">&quot;Could not parse </span><span class="e">\&quot;</span><span class="s">&quot;</span> <span class="o">+</span> <span class="i">token</span><span class="p">.</span><span class="i">getText</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="e">\&quot;</span><span class="s">.&quot;</span><span class="p">);</span>

    <span class="t">Expression</span> <span class="i">left</span> <span class="o">=</span> <span class="i">prefix</span><span class="p">.</span><span class="i">parse</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">token</span><span class="p">);</span>

    <span class="i">token</span> <span class="o">=</span> <span class="i">lookAhead</span><span class="p">(</span><span class="n">0</span><span class="p">);</span>
    <span class="t">InfixParselet</span> <span class="i">infix</span> <span class="o">=</span> <span class="i">mInfixParselets</span><span class="p">.</span><span class="i">get</span><span class="p">(</span><span class="i">token</span><span class="p">.</span><span class="i">getType</span><span class="p">());</span>

    <span class="c">// No infix expression at this point, so we&#39;re done.</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">infix</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="i">left</span><span class="p">;</span>

    <span class="i">consume</span><span class="p">();</span>
    <span class="k">return</span> <span class="i">infix</span><span class="p">.</span><span class="i">parse</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">left</span><span class="p">,</span> <span class="i">token</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c">// Other stuff...</span>

  <span class="k">private</span> <span class="k">final</span> <span class="t">Map</span><span class="o">&lt;</span><span class="t">TokenType</span><span class="p">,</span> <span class="t">InfixParselet</span><span class="o">&gt;</span> <span class="i">mInfixParselets</span> <span class="o">=</span>
      <span class="k">new</span> <span class="t">HashMap</span><span class="o">&lt;</span><span class="t">TokenType</span><span class="p">,</span> <span class="t">InfixParselet</span><span class="o">&gt;</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">BinaryOperatorParselet</span> <span class="k">implements</span> <span class="t">InfixParselet</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">Expression</span> <span class="i">parse</span><span class="p">(</span><span class="t">Parser</span> <span class="i">parser</span><span class="p">,</span>
      <span class="t">Expression</span> <span class="i">left</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="t">Expression</span> <span class="i">right</span> <span class="o">=</span> <span class="i">parser</span><span class="p">.</span><span class="i">parseExpression</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="t">OperatorExpression</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">token</span><span class="p">.</span><span class="i">getType</span><span class="p">(),</span> <span class="i">right</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">PostfixOperatorParselet</span> <span class="k">implements</span> <span class="t">InfixParselet</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">Expression</span> <span class="i">parse</span><span class="p">(</span><span class="t">Parser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Expression</span> <span class="i">left</span><span class="p">,</span>
      <span class="t">Token</span> <span class="i">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="t">PostfixExpression</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">token</span><span class="p">.</span><span class="i">getType</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">ConditionalParselet</span> <span class="k">implements</span> <span class="t">InfixParselet</span> <span class="p">{</span>
  <span class="k">public</span> <span class="t">Expression</span> <span class="i">parse</span><span class="p">(</span><span class="t">Parser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Expression</span> <span class="i">left</span><span class="p">,</span>
      <span class="t">Token</span> <span class="i">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="t">Expression</span> <span class="i">thenArm</span> <span class="o">=</span> <span class="i">parser</span><span class="p">.</span><span class="i">parseExpression</span><span class="p">();</span>
    <span class="i">parser</span><span class="p">.</span><span class="i">consume</span><span class="p">(</span><span class="t">TokenType</span><span class="p">.</span><span class="i">COLON</span><span class="p">);</span>
    <span class="t">Expression</span> <span class="i">elseArm</span> <span class="o">=</span> <span class="i">parser</span><span class="p">.</span><span class="i">parseExpression</span><span class="p">();</span>

    <span class="k">return</span> <span class="k">new</span> <span class="t">ConditionalExpression</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">thenArm</span><span class="p">,</span> <span class="i">elseArm</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">public</span> <span class="k">interface</span> <span class="t">InfixParselet</span> <span class="p">{</span>
  <span class="t">Expression</span> <span class="i">parse</span><span class="p">(</span><span class="t">Parser</span> <span class="i">parser</span><span class="p">,</span> <span class="t">Expression</span> <span class="i">left</span><span class="p">,</span> <span class="t">Token</span> <span class="i">token</span><span class="p">);</span>
  <span class="t">int</span> <span class="i">getPrecedence</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">public</span> <span class="t">Expression</span> <span class="i">parseExpression</span><span class="p">(</span><span class="t">int</span> <span class="i">precedence</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">Token</span> <span class="i">token</span> <span class="o">=</span> <span class="i">consume</span><span class="p">();</span>
  <span class="t">PrefixParselet</span> <span class="i">prefix</span> <span class="o">=</span> <span class="i">mPrefixParselets</span><span class="p">.</span><span class="i">get</span><span class="p">(</span><span class="i">token</span><span class="p">.</span><span class="i">getType</span><span class="p">());</span>

  <span class="k">if</span> <span class="p">(</span><span class="i">prefix</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="t">ParseException</span><span class="p">(</span>
      <span class="s">&quot;Could not parse </span><span class="e">\&quot;</span><span class="s">&quot;</span> <span class="o">+</span> <span class="i">token</span><span class="p">.</span><span class="i">getText</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="e">\&quot;</span><span class="s">.&quot;</span><span class="p">);</span>

  <span class="t">Expression</span> <span class="i">left</span> <span class="o">=</span> <span class="i">prefix</span><span class="p">.</span><span class="i">parse</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">token</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="i">precedence</span> <span class="o">&lt;</span> <span class="i">getPrecedence</span><span class="p">())</span> <span class="p">{</span>
    <span class="i">token</span> <span class="o">=</span> <span class="i">consume</span><span class="p">();</span>

    <span class="t">InfixParselet</span> <span class="i">infix</span> <span class="o">=</span> <span class="i">mInfixParselets</span><span class="p">.</span><span class="i">get</span><span class="p">(</span><span class="i">token</span><span class="p">.</span><span class="i">getType</span><span class="p">());</span>
    <span class="i">left</span> <span class="o">=</span> <span class="i">infix</span><span class="p">.</span><span class="i">parse</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="i">left</span><span class="p">,</span> <span class="i">token</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="i">left</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">private</span> <span class="t">int</span> <span class="i">getPrecedence</span><span class="p">()</span> <span class="p">{</span>
  <span class="t">InfixParselet</span> <span class="i">parser</span> <span class="o">=</span> <span class="i">mInfixParselets</span><span class="p">.</span><span class="i">get</span><span class="p">(</span>
      <span class="i">lookAhead</span><span class="p">(</span><span class="n">0</span><span class="p">).</span><span class="i">getType</span><span class="p">());</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">parser</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="i">parser</span><span class="p">.</span><span class="i">getPrecedence</span><span class="p">();</span>

  <span class="k">return</span> <span class="n">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">public</span> <span class="k">class</span> <span class="t">Precedence</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">final</span> <span class="t">int</span> <span class="i">ASSIGNMENT</span>  <span class="o">=</span> <span class="n">1</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">final</span> <span class="t">int</span> <span class="i">CONDITIONAL</span> <span class="o">=</span> <span class="n">2</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">final</span> <span class="t">int</span> <span class="i">SUM</span>         <span class="o">=</span> <span class="n">3</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">final</span> <span class="t">int</span> <span class="i">PRODUCT</span>     <span class="o">=</span> <span class="n">4</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">final</span> <span class="t">int</span> <span class="i">EXPONENT</span>    <span class="o">=</span> <span class="n">5</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">final</span> <span class="t">int</span> <span class="i">PREFIX</span>      <span class="o">=</span> <span class="n">6</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">final</span> <span class="t">int</span> <span class="i">POSTFIX</span>     <span class="o">=</span> <span class="n">7</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">final</span> <span class="t">int</span> <span class="i">CALL</span>        <span class="o">=</span> <span class="n">8</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>2011/04/21/multimethods-multiple-inheritance-multiawesome</h2>

<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">Positioned</span> <span class="p">{</span>
<span class="k">public</span><span class="p">:</span>
  <span class="t">int</span> <span class="i">x</span><span class="p">;</span>
  <span class="t">int</span> <span class="i">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">Item</span> <span class="p">:</span> <span class="k">public</span> <span class="t">Positioned</span> <span class="p">{</span>
  <span class="c">// Stuff...</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">Monster</span> <span class="p">:</span> <span class="k">public</span> <span class="t">Positioned</span> <span class="p">{</span>
  <span class="c">// Stuff...</span>
<span class="p">}</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">ChestMonster</span> <span class="p">:</span> <span class="k">public</span> <span class="t">Monster</span><span class="p">,</span> <span class="k">public</span> <span class="t">Item</span> <span class="p">{</span>
  <span class="c">// Stuff...</span>
<span class="p">}</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">Positioned</span> <span class="p">{</span>
<span class="k">protected</span><span class="p">:</span>
  <span class="k">bool</span> <span class="i">canBeAt</span><span class="p">(</span><span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="t">int</span> <span class="i">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">Base</span> <span class="p">{</span>
<span class="k">public</span><span class="p">:</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">method</span><span class="p">()</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;Base!&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">Derived</span> <span class="p">:</span> <span class="k">public</span> <span class="t">Base</span> <span class="p">{</span>
<span class="k">public</span><span class="p">:</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">method</span><span class="p">()</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;Derived!&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c">// Later...</span>
<span class="t">Base</span><span class="o">*</span> <span class="i">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Derived</span><span class="p">();</span>
<span class="i">obj</span><span class="o">-&gt;</span><span class="i">method</span><span class="p">();</span> <span class="c">// Prints &quot;Derived!&quot;</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="t">void</span> <span class="i">method</span><span class="p">(</span><span class="t">Base</span><span class="o">*</span> <span class="i">obj</span><span class="p">)</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;Base!&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="t">void</span> <span class="i">method</span><span class="p">(</span><span class="t">Derived</span><span class="o">*</span> <span class="i">obj</span><span class="p">)</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;Derived!&quot;</span><span class="p">);</span> <span class="p">}</span>

<span class="c">// Later...</span>
<span class="t">Base</span><span class="o">*</span> <span class="i">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Derived</span><span class="p">();</span>
<span class="i">method</span><span class="p">(</span><span class="i">obj</span><span class="p">);</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="t">void</span> <span class="i">method</span><span class="p">(</span><span class="t">Base</span><span class="o">*</span> <span class="i">a</span><span class="p">,</span> <span class="t">Base</span><span class="o">*</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;base base&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="t">void</span> <span class="i">method</span><span class="p">(</span><span class="t">Base</span><span class="o">*</span> <span class="i">a</span><span class="p">,</span> <span class="t">Derived</span><span class="o">*</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;base derived&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="t">void</span> <span class="i">method</span><span class="p">(</span><span class="t">Derived</span><span class="o">*</span> <span class="i">a</span><span class="p">,</span> <span class="t">Base</span><span class="o">*</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;derived base&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="t">void</span> <span class="i">method</span><span class="p">(</span><span class="t">Derived</span><span class="o">*</span> <span class="i">a</span><span class="p">,</span> <span class="t">Derived</span><span class="o">*</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;derived derived&quot;</span><span class="p">);</span> <span class="p">}</span>

<span class="c">// Later...</span>
<span class="t">Base</span><span class="o">*</span> <span class="i">a</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Derived</span><span class="p">();</span>
<span class="t">Base</span><span class="o">*</span> <span class="i">b</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Derived</span><span class="p">();</span>
<span class="i">method</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">);</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="t">void</span> <span class="i">method</span><span class="p">(</span><span class="t">Base</span><span class="o">*</span> <span class="i">a</span><span class="p">,</span> <span class="t">Derived</span><span class="o">*</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;base derived&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="t">void</span> <span class="i">method</span><span class="p">(</span><span class="t">Derived</span><span class="o">*</span> <span class="i">a</span><span class="p">,</span> <span class="t">Base</span><span class="o">*</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span> <span class="i">printf</span><span class="p">(</span><span class="s">&quot;derived base&quot;</span><span class="p">);</span> <span class="p">}</span>

<span class="c">// Later...</span>
<span class="t">Base</span><span class="o">*</span> <span class="i">a</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Derived</span><span class="p">();</span>
<span class="t">Base</span><span class="o">*</span> <span class="i">b</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Derived</span><span class="p">();</span>
<span class="i">method</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">);</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">overloaded</span><span class="p">(</span><span class="i">a</span> <span class="k">is</span> <span class="t">Base</span><span class="p">,</span> <span class="i">b</span> <span class="k">is</span> <span class="t">Derived</span><span class="p">)</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;base derived&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">overloaded</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;who knows?!&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="i">planner</span><span class="p">.</span><span class="i">getAddressBook</span><span class="p">().</span><span class="i">getPhoneNumbers</span><span class="p">().</span><span class="i">add</span><span class="p">(</span><span class="s">&quot;867-5309&quot;</span><span class="p">);</span>
</code></pre></div>
<p>lisp</p>
<div class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span class="p">(</span><span class="i">add</span> <span class="p">(</span><span class="i">get-phone-numbers</span> <span class="p">(</span><span class="i">get-address-book</span> <span class="i">planner</span><span class="p">))</span> <span class="s">&quot;867-5309&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">planner</span> <span class="i">addressBook</span> <span class="i">phoneNumbers</span> <span class="i">add</span><span class="p">(</span><span class="s">&quot;867-5309&quot;</span><span class="p">)</span>
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$(selector, [context])
selector      - A string containing a selector expression.
context       - A DOM Element, Document, or jQuery to use as
                context.

$(element)
element       - A DOM element to wrap in a jQuery object.

$(elementArray)
elementArray  - An array containing a set of DOM elements to
                wrap in a jQuery object.

$(jQuery object)
jQuery object - An existing jQuery object to clone.

$()
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">$</span><span class="p">(</span><span class="i">selector</span> <span class="k">is</span> <span class="t">String</span><span class="p">)</span> <span class="p">...</span>
<span class="k">def</span> <span class="i">$</span><span class="p">(</span><span class="i">selector</span> <span class="k">is</span> <span class="t">String</span><span class="p">,</span> <span class="i">context</span><span class="p">)</span> <span class="p">...</span>
<span class="k">def</span> <span class="i">$</span><span class="p">(</span><span class="i">element</span> <span class="k">is</span> <span class="t">Element</span><span class="p">)</span> <span class="p">...</span>
<span class="k">def</span> <span class="i">$</span><span class="p">(</span><span class="i">elementArray</span> <span class="k">is</span> <span class="t">List</span><span class="p">)</span> <span class="p">...</span>
<span class="k">def</span> <span class="i">$</span><span class="p">(</span><span class="i">object</span> <span class="k">is</span> <span class="t">JQuery</span><span class="p">)</span> <span class="p">...</span>
<span class="k">def</span> <span class="i">$</span><span class="p">()</span> <span class="p">...</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="i">left</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="i">right</span><span class="p">)</span>
    <span class="i">not</span><span class="p">(</span><span class="i">left</span> <span class="o">==</span> <span class="i">right</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="i">left</span> <span class="k">is</span> <span class="t">Int</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="i">right</span> <span class="k">is</span> <span class="t">Int</span><span class="p">)</span> <span class="p">...</span>

<span class="k">def</span> <span class="p">(</span><span class="i">left</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="i">right</span><span class="p">)</span>
    <span class="i">concatenate</span><span class="p">(</span><span class="i">left</span> <span class="i">string</span><span class="p">,</span> <span class="i">right</span> <span class="i">string</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">fib</span><span class="p">(</span><span class="n">0</span><span class="p">)</span> <span class="n">0</span>
<span class="k">def</span> <span class="i">fib</span><span class="p">(</span><span class="n">1</span><span class="p">)</span> <span class="n">1</span>
<span class="k">def</span> <span class="i">fib</span><span class="p">(</span><span class="i">n</span> <span class="k">is</span> <span class="t">Int</span><span class="p">)</span> <span class="i">fib</span><span class="p">(</span><span class="i">n</span> <span class="o">-</span> <span class="n">2</span><span class="p">)</span> <span class="o">+</span> <span class="i">fib</span><span class="p">(</span><span class="i">n</span> <span class="o">-</span> <span class="n">1</span><span class="p">)</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="t">Integer</span><span class="p">.</span><span class="i">parseInt</span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">);</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="o">==</span> <span class="t">Int</span><span class="p">)</span> <span class="i">parse</span><span class="p">(</span><span class="i">text</span> <span class="t">String</span><span class="p">)</span> <span class="p">...</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="i">list</span><span class="p">.</span><span class="i">reverse</span><span class="p">();</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="t">Collections</span><span class="p">.</span><span class="i">reverse</span><span class="p">(</span><span class="i">list</span><span class="p">);</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="i">list</span> <span class="k">is</span> <span class="t">List</span><span class="p">)</span> <span class="i">reverse</span><span class="p">()</span> <span class="p">...</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">import</span> <span class="i">bobs</span><span class="p">.</span><span class="i">list</span><span class="p">.</span><span class="i">methods</span> <span class="k">with</span>
    <span class="i">reverse</span> <span class="k">as</span> <span class="i">bobs</span><span class="p">.</span><span class="i">reverse</span>
<span class="k">end</span>
<span class="k">import</span> <span class="i">your</span><span class="p">.</span><span class="i">list</span><span class="p">.</span><span class="i">methods</span> <span class="k">with</span>
    <span class="i">reverse</span> <span class="k">as</span> <span class="i">your</span><span class="p">.</span><span class="i">reverse</span>
<span class="k">end</span>

<span class="k">var</span> <span class="i">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">]</span>
<span class="i">list</span> <span class="i">bobs</span><span class="p">.</span><span class="i">reverse</span><span class="p">()</span>
<span class="i">list</span> <span class="i">your</span><span class="p">.</span><span class="i">reverse</span><span class="p">()</span>
</code></pre></div>
<h2>2011/06/06/magpie-wants-you</h2>

<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="k">this</span> <span class="k">is</span> <span class="t">String</span><span class="p">)</span> <span class="i">split</span><span class="p">()</span>
  <span class="k">this</span> <span class="i">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="k">this</span> <span class="k">is</span> <span class="t">String</span><span class="p">)</span> <span class="i">split</span><span class="p">(</span><span class="i">separator</span> <span class="k">is</span> <span class="t">String</span><span class="p">)</span>
  <span class="p">...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="s">&quot;eenie-meenie-miney-moe&quot;</span> <span class="i">split</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">)</span>
<span class="s">&quot;eenie-meenie-miney-moe&quot;</span> <span class="i">split</span><span class="p">()</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="k">this</span> <span class="k">is</span> <span class="t">String</span><span class="p">)</span> <span class="i">split</span><span class="p">(</span><span class="i">maxResults</span> <span class="k">is</span> <span class="t">Int</span><span class="p">)</span>
    <span class="p">...</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="k">this</span> <span class="k">is</span> <span class="t">String</span><span class="p">)</span> <span class="i">split</span><span class="p">(</span><span class="i">separator</span> <span class="k">is</span> <span class="t">String</span><span class="p">,</span> <span class="i">maxResults</span> <span class="k">is</span> <span class="t">Int</span><span class="p">)</span>
    <span class="p">...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">import</span> <span class="i">io</span>
<span class="k">import</span> <span class="i">net</span>
<span class="k">import</span> <span class="k">async</span>

<span class="k">val</span> <span class="i">server</span> <span class="o">=</span> <span class="t">ServerSocket</span> <span class="i">new</span><span class="p">(</span><span class="n">8080</span><span class="p">)</span>
<span class="k">while</span> <span class="k">true</span> <span class="k">do</span>
  <span class="k">val</span> <span class="i">socket</span> <span class="o">=</span> <span class="i">server</span> <span class="i">accept</span><span class="p">()</span>
  <span class="c">// Start a new thread to respond to the request.</span>
  <span class="i">run</span> <span class="k">with</span>
    <span class="c">// Process the request (assume its a GET).</span>
    <span class="k">val</span> <span class="i">path</span> <span class="o">=</span> <span class="i">socket</span> <span class="i">readLine</span><span class="p">()</span> <span class="i">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="n">1</span><span class="p">]</span>

    <span class="c">// Open the file being served.</span>
    <span class="i">open</span><span class="p">(</span><span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="i">path</span><span class="p">)</span> <span class="i">use</span> <span class="k">with</span>
      <span class="c">// Read it and write it to the socket.</span>
      <span class="i">socket</span> <span class="i">write</span><span class="p">(</span><span class="k">it</span> <span class="i">read</span><span class="p">())</span>
    <span class="k">end</span>
    <span class="i">socket</span> <span class="i">close</span><span class="p">()</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>2011/10/21/wrapping-my-head-around-optional-typing</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">sum</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="i">a</span> <span class="o">+</span> <span class="i">b</span><span class="p">;</span>
  <span class="k">return</span> <span class="i">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">num</span> <span class="i">sum</span><span class="p">(</span><span class="t">num</span> <span class="i">a</span><span class="p">,</span> <span class="t">num</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="i">a</span> <span class="o">+</span> <span class="i">b</span><span class="p">;</span>
  <span class="k">return</span> <span class="i">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="i">someFunction</span><span class="p">();</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">_temp</span> <span class="o">=</span> <span class="i">someFunction</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="i">_temp</span> <span class="k">is</span><span class="o">!</span> <span class="t">int</span><span class="p">)</span> <span class="k">throw</span> <span class="s">&#39;Type error! Run for your life!&#39;</span><span class="p">;</span>
<span class="k">var</span> <span class="i">i</span> <span class="o">=</span> <span class="i">_temp</span><span class="p">;</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">if</span> <span class="p">(</span><span class="n">2</span> <span class="o">==</span> <span class="n">3</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// Should never get here.</span>
  <span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="s">&#39;not int&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="t">String</span><span class="p">[]</span> <span class="i">array</span> <span class="o">=</span> <span class="k">new</span> <span class="t">String</span><span class="p">[</span><span class="n">5</span><span class="p">];</span>
<span class="t">Object</span><span class="p">[]</span> <span class="i">untyped</span> <span class="o">=</span> <span class="i">array</span><span class="p">;</span>
<span class="i">untyped</span><span class="p">[</span><span class="n">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">123</span><span class="p">;</span> <span class="c">// Not a string.</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="t">void</span> <span class="i">callback</span><span class="p">(</span><span class="t">Object</span> <span class="i">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// It&#39;s my callback, so I know the data is an int.</span>
  <span class="t">int</span> <span class="i">value</span> <span class="o">=</span> <span class="p">(</span><span class="t">Integer</span><span class="p">)</span> <span class="i">data</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="s">&#39;not int&#39;</span><span class="p">;</span>
<span class="t">bool</span> <span class="i">b</span> <span class="o">=</span> <span class="s">&#39;not a bool either&#39;</span><span class="p">;</span>
<span class="t">num</span> <span class="i">wtf</span> <span class="o">=</span> <span class="i">i</span> <span class="o">+</span> <span class="i">b</span><span class="p">;</span>
<span class="i">print</span><span class="p">(</span><span class="i">wtf</span><span class="p">);</span> <span class="c">// &quot;not intnot a bool either&quot;.</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">var</span> <span class="c">/* int */</span> <span class="i">i</span> <span class="o">=</span> <span class="s">&#39;not int&#39;</span><span class="p">;</span>
<span class="k">var</span> <span class="c">/* bool */</span> <span class="i">b</span> <span class="o">=</span> <span class="s">&#39;not a bool either&#39;</span><span class="p">;</span>
<span class="k">var</span> <span class="c">/* num */</span> <span class="i">wtf</span> <span class="o">=</span> <span class="i">i</span> <span class="o">+</span> <span class="i">b</span><span class="p">;</span>
<span class="i">print</span><span class="p">(</span><span class="i">wtf</span><span class="p">);</span> <span class="c">// &quot;not intnot a bool either&quot;.</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">float</span> <span class="i">divide</span><span class="p">(</span><span class="t">float</span> <span class="i">num</span><span class="p">,</span> <span class="t">float</span> <span class="i">denom</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">assert</span><span class="p">(</span><span class="i">denom</span> <span class="o">!=</span> <span class="n">0</span><span class="p">);</span>
  <span class="k">return</span> <span class="i">num</span> <span class="o">/</span> <span class="i">denom</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">_temp</span> <span class="o">=</span> <span class="i">someFunction</span><span class="p">();</span>
<span class="k">assert</span><span class="p">(</span><span class="i">_temp</span> <span class="k">is</span> <span class="t">int</span><span class="p">);</span>
<span class="k">var</span> <span class="i">i</span> <span class="o">=</span> <span class="i">_temp</span><span class="p">;</span>
</code></pre></div>
<h2>2011/10/29/a-proposal-for-null-safety-in-dart</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">int</span> <span class="i">a</span><span class="p">;</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Point</span> <span class="p">{</span>
  <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">;</span>
  <span class="t">Point</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Point</span> <span class="p">{</span>
  <span class="t">int</span> <span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">;</span>
  <span class="t">Point</span><span class="p">()</span> <span class="p">:</span> <span class="i">x</span> <span class="o">=</span> <span class="n">0</span><span class="p">,</span> <span class="i">y</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Base</span> <span class="p">{}</span>
<span class="k">class</span> <span class="t">Derived</span> <span class="k">extends</span> <span class="t">Base</span> <span class="p">{}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">Base</span> <span class="i">b</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Derived</span><span class="p">();</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">Base</span> <span class="i">b</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Derived</span><span class="p">();</span>
<span class="t">Derived</span> <span class="i">d</span> <span class="o">=</span> <span class="i">b</span><span class="p">;</span> <span class="c">// Allowed.</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">int</span><span class="o">?</span> <span class="i">a</span> <span class="o">=</span> <span class="n">123</span><span class="p">;</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">int</span><span class="o">?</span> <span class="i">a</span> <span class="o">=</span> <span class="n">123</span><span class="p">;</span>
<span class="t">int</span> <span class="i">b</span> <span class="o">=</span> <span class="i">a</span><span class="p">;</span> <span class="c">// Allowed.</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">if</span> <span class="p">(</span><span class="i">a</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">int</span> <span class="i">b</span> <span class="o">=</span> <span class="i">a</span><span class="p">;</span> <span class="c">// Safe at runtime now too!</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart">    <span class="t">int</span> <span class="i">a</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">double</span><span class="p">(</span><span class="t">int</span><span class="o">?</span> <span class="i">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="i">i</span> <span class="o">*</span> <span class="n">2</span><span class="p">;</span> <span class="c">// Warn that we didn&#39;t test i for null first.</span>
<span class="p">}</span>

<span class="t">double</span><span class="p">(</span><span class="t">int</span><span class="o">?</span> <span class="i">i</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">i</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="i">i</span> <span class="o">*</span> <span class="n">2</span><span class="p">;</span> <span class="c">// OK now.</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">List</span><span class="o">&lt;</span><span class="t">int</span><span class="o">?&gt;</span> <span class="i">list</span> <span class="o">=</span> <span class="k">new</span> <span class="t">List</span><span class="o">&lt;</span><span class="t">int</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">SomeClass</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="t">T</span><span class="o">?</span> <span class="i">someField</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Expect</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">void</span> <span class="i">isFalse</span><span class="p">(</span><span class="i">actual</span><span class="p">,</span> <span class="p">[</span><span class="t">String</span> <span class="i">reason</span> <span class="o">=</span> <span class="k">null</span><span class="p">])</span>
  <span class="c">// more...</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">list</span> <span class="o">=</span> <span class="k">new</span> <span class="t">List</span><span class="o">&lt;</span><span class="t">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">4</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">list</span> <span class="o">=</span> <span class="k">new</span> <span class="t">List</span><span class="o">&lt;</span><span class="t">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">4</span><span class="p">,</span> <span class="i">fill</span><span class="p">:</span> <span class="n">1</span><span class="p">);</span>
<span class="i">print</span><span class="p">(</span><span class="i">list</span><span class="p">);</span> <span class="c">// [1, 1, 1, 1]</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">list</span> <span class="o">=</span> <span class="k">new</span> <span class="t">List</span><span class="o">&lt;</span><span class="t">int</span><span class="o">&gt;</span><span class="p">.</span><span class="i">generate</span><span class="p">(</span><span class="n">4</span><span class="p">,</span> <span class="p">(</span><span class="i">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="i">index</span> <span class="o">*</span> <span class="n">2</span><span class="p">);</span>
<span class="i">print</span><span class="p">(</span><span class="i">list</span><span class="p">);</span> <span class="c">// [0, 2, 4, 6]</span>
</code></pre></div>
<h2>2012/01/24/higher-order-macros-in-c</h2>

<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">BinaryOpExpr</span> <span class="p">:</span> <span class="k">public</span> <span class="t">Expression</span> <span class="p">{</span>
  <span class="t">BinaryOpExpr</span><span class="p">(</span><span class="t">Expression</span><span class="o">*</span> <span class="i">left</span><span class="p">,</span> <span class="t">Expression</span><span class="o">*</span> <span class="i">right</span><span class="p">)</span>
  <span class="p">:</span> <span class="i">left</span><span class="p">(</span><span class="i">left</span><span class="p">),</span>
    <span class="i">right</span><span class="p">(</span><span class="i">right</span><span class="p">)</span> <span class="p">{}</span>

  <span class="k">virtual</span> <span class="t">void</span> <span class="i">accept</span><span class="p">(</span><span class="t">AstVisitor</span><span class="o">&amp;</span> <span class="i">visitor</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">visitor</span><span class="p">.</span><span class="i">visitBinaryOpExpr</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="t">Expression</span><span class="o">*</span> <span class="i">left</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="i">left</span><span class="p">;</span> <span class="p">}</span>
  <span class="t">Expression</span><span class="o">*</span> <span class="i">right</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="i">right</span><span class="p">;</span> <span class="p">}</span>

<span class="k">private</span><span class="p">:</span>
  <span class="t">Expression</span><span class="o">*</span> <span class="i">left</span><span class="p">;</span>
  <span class="t">Expression</span><span class="o">*</span> <span class="i">right</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">AstVisitor</span> <span class="p">{</span>
<span class="k">public</span><span class="p">:</span>
  <span class="o">~</span><span class="k">virtual</span> <span class="t">AstVisitor</span><span class="p">()</span> <span class="p">{}</span>

  <span class="k">virtual</span> <span class="t">void</span> <span class="i">visitBoolLiteral</span><span class="p">(</span><span class="t">BoolLiteral</span><span class="o">*</span> <span class="i">expr</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">visitNumLiteral</span><span class="p">(</span><span class="t">NumLiteral</span><span class="o">*</span> <span class="i">expr</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">visitStringLiteral</span><span class="p">(</span><span class="t">StringLiteral</span><span class="o">*</span> <span class="i">expr</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">visitUnaryOpExpr</span><span class="p">(</span><span class="t">UnaryOpExpr</span><span class="o">*</span> <span class="i">expr</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">visitBinaryOpExpr</span><span class="p">(</span><span class="t">BinaryOpExpr</span><span class="o">*</span> <span class="i">expr</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">visitAssignmentExpr</span><span class="p">(</span><span class="t">AssignmentExpr</span><span class="o">*</span> <span class="i">expr</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">visitConditionalExpr</span><span class="p">(</span><span class="t">ConditionalExpr</span><span class="o">*</span> <span class="i">expr</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="t">void</span> <span class="i">visitIfThenStmt</span><span class="p">(</span><span class="t">IfThenStmt</span><span class="o">*</span> <span class="i">expr</span><span class="p">)</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="c">// 30 more of these, you get the idea...</span>
<span class="p">};</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">enum</span> <span class="t">AstType</span> <span class="p">{</span>
  <span class="i">kBoolLiteral</span><span class="p">,</span>
  <span class="i">kNumLiteral</span><span class="p">,</span>
  <span class="i">kStringLiteral</span><span class="p">,</span>
  <span class="i">kUnaryOpExpr</span><span class="p">,</span>
  <span class="i">kBinaryOpExpr</span><span class="p">,</span>
  <span class="c">// again, you get the idea...</span>
<span class="p">};</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">const</span> <span class="t">char</span><span class="o">*</span> <span class="i">typeString</span><span class="p">(</span><span class="t">AstType</span> <span class="i">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="i">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="i">kBoolLiteral</span><span class="p">:</span>  <span class="k">return</span> <span class="s">&quot;BoolLiteral&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="i">kIntLiteral</span><span class="p">:</span>   <span class="k">return</span> <span class="s">&quot;IntLiteral&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="i">kNumLiteral</span><span class="p">:</span>   <span class="k">return</span> <span class="s">&quot;NumLiteral&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="i">kUnaryOpExpr</span><span class="p">:</span>  <span class="k">return</span> <span class="s">&quot;UnaryOpLiteral&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="i">kBinaryOpExpr</span><span class="p">:</span> <span class="k">return</span> <span class="s">&quot;BinaryOpLiteral&quot;</span><span class="p">;</span>
    <span class="c">// yup...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="r">#define DEFINE_VISIT(type)  \
    virtual void visit##type(type* expr) = 0</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">AstVisitor</span> <span class="p">{</span>
<span class="k">public</span><span class="p">:</span>
  <span class="o">~</span><span class="k">virtual</span> <span class="t">AstVisitor</span><span class="p">()</span> <span class="p">{}</span>

  <span class="r">DEFINE_VISIT</span><span class="p">(</span><span class="t">BoolLiteral</span><span class="p">);</span>
  <span class="r">DEFINE_VISIT</span><span class="p">(</span><span class="t">NumLiteral</span><span class="p">);</span>
  <span class="r">DEFINE_VISIT</span><span class="p">(</span><span class="t">StringLiteral</span><span class="p">);</span>
  <span class="r">DEFINE_VISIT</span><span class="p">(</span><span class="t">UnaryOpExpr</span><span class="p">);</span>
  <span class="r">DEFINE_VISIT</span><span class="p">(</span><span class="t">BinaryOpExpr</span><span class="p">);</span>
  <span class="r">DEFINE_VISIT</span><span class="p">(</span><span class="t">AssignmentExpr</span><span class="p">);</span>
  <span class="r">DEFINE_VISIT</span><span class="p">(</span><span class="t">ConditionalExpr</span><span class="p">);</span>
  <span class="r">DEFINE_VISIT</span><span class="p">(</span><span class="t">IfThenStmt</span><span class="p">);</span>
  <span class="c">// 30 more of these, you get the idea...</span>
<span class="p">};</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="r">#define AST_NODE_LIST   \
    BoolLiteral         \
    NumLiteral          \
    StringLiteral       \
    UnaryOpExpr         \
    ...</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="r">#define AST_NODE_LIST(code) \
    code(BoolLiteral)       \
    code(NumLiteral)        \
    code(StringLiteral)     \
    code(UnaryOpExpr)       \
    ...</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="k">class</span> <span class="t">AstVisitor</span> <span class="p">{</span>
<span class="k">public</span><span class="p">:</span>
  <span class="o">~</span><span class="k">virtual</span> <span class="t">AstVisitor</span><span class="p">()</span> <span class="p">{}</span>

  <span class="r">#define DEFINE_VISIT(type) \
      virtual void visit##type(type* expr) = 0</span>

  <span class="r">AST_NODE_LIST</span><span class="p">(</span><span class="r">DEFINE_VISIT</span><span class="p">)</span>

  <span class="r">#undef DEFINE_VISIT </span><span class="c">// Clean it up since we&#39;re done with it.</span>
<span class="p">};</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="r">#define DEFINE_ENUM_TYPE(type) k##type,</span>

<span class="k">enum</span> <span class="t">AstType</span> <span class="p">{</span>
  <span class="r">AST_NODE_LIST</span><span class="p">(</span><span class="r">DEFINE_ENUM_TYPE</span><span class="p">)</span>
<span class="p">};</span>

<span class="r">#undef DEFINE_ENUM_TYPE</span>
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="r">#define DEFINE_TYPE_STRING(type) case k##type: return #type;</span>

<span class="k">const</span> <span class="t">char</span><span class="o">*</span> <span class="i">typeString</span><span class="p">(</span><span class="t">AstType</span> <span class="i">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="i">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="r">AST_NODE_LIST</span><span class="p">(</span><span class="r">DEFINE_TYPE_STRING</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="r">#undef DEFINE_TYPE_STRING</span>
</code></pre></div>
<h2>2012/06/12/multimethods-global-scope-and-monkey-patching</h2>

<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="p">{</span>
  <span class="t">int</span> <span class="i">a</span> <span class="o">=</span> <span class="n">1</span><span class="p">;</span>
  <span class="p">{</span>
    <span class="t">int</span> <span class="i">a</span> <span class="o">=</span> <span class="n">2</span><span class="p">;</span>
    <span class="i">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="i">a</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="i">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="i">a</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">function</span><span class="p">(</span><span class="i">who</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">alert</span><span class="p">(</span><span class="i">who</span><span class="p">.</span><span class="i">favoriteColor</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">list</span> <span class="i">add</span><span class="p">(</span><span class="i">item</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="i">list</span> <span class="k">is</span> <span class="t">List</span><span class="p">)</span> <span class="i">add</span><span class="p">(</span><span class="i">item</span><span class="p">)</span>
    <span class="c">// add stuff to list...</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="i">set</span> <span class="k">is</span> <span class="t">Set</span><span class="p">)</span> <span class="i">add</span><span class="p">(</span><span class="i">item</span><span class="p">)</span>
    <span class="c">// add stuff to set...</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="i">map</span> <span class="k">is</span> <span class="t">Map</span><span class="p">)</span> <span class="i">add</span><span class="p">(</span><span class="i">item</span><span class="p">)</span>
    <span class="c">// add stuff to map...</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// sandwich.mag</span>
<span class="k">defclass</span> <span class="t">Sandwich</span>
  <span class="k">val</span> <span class="i">meat</span>
  <span class="k">val</span> <span class="i">condiment</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="i">sandwich</span> <span class="k">is</span> <span class="t">Sandwich</span><span class="p">)</span> <span class="i">isVegetarian</span>
  <span class="i">sandwich</span> <span class="i">meat</span> <span class="o">==</span> <span class="s">&quot;tofu&quot;</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="i">sandwich</span> <span class="k">is</span> <span class="t">Sandwich</span><span class="p">)</span> <span class="i">toString</span>
  <span class="s">&quot;A tasty &quot;</span> <span class="o">+</span> <span class="i">meat</span> <span class="o">+</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> <span class="i">condiment</span> <span class="o">+</span> <span class="s">&quot; sandwich&quot;</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// main.mag</span>
<span class="k">import</span> <span class="i">sandwich</span>

<span class="k">val</span> <span class="i">sandwich</span> <span class="o">=</span> <span class="t">Sandwich</span> <span class="i">new</span><span class="p">(</span><span class="i">meat</span><span class="p">:</span> <span class="s">&quot;ham&quot;</span><span class="p">,</span> <span class="i">condiment</span><span class="p">:</span> <span class="s">&quot;mayo&quot;</span><span class="p">)</span>
<span class="i">print</span><span class="p">(</span><span class="s">&quot;veggie? &quot;</span> <span class="o">+</span> <span class="i">sandwich</span> <span class="i">isVegetarian</span><span class="p">)</span>
<span class="i">print</span><span class="p">(</span><span class="i">sandwich</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">import</span> <span class="i">sandwich</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">val</span> <span class="i">sandwich</span> <span class="o">=</span> <span class="t">Sandwich</span> <span class="i">new</span><span class="p">(</span><span class="i">meat</span><span class="p">:</span> <span class="s">&quot;ham&quot;</span><span class="p">,</span> <span class="i">condiment</span><span class="p">:</span> <span class="s">&quot;mayo&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">print</span><span class="p">(</span><span class="s">&quot;veggie? &quot;</span> <span class="o">+</span> <span class="i">sandwich</span> <span class="i">isVegetarian</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">print</span><span class="p">(</span><span class="i">sandwich</span><span class="p">)</span>
</code></pre></div>
<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart">core
 ^^
 │└───┐
 │ sandwich
 │┌───┘
main
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// pal.mag</span>
<span class="k">defclass</span> <span class="t">Pal</span>
  <span class="k">val</span> <span class="i">name</span>
<span class="k">end</span>

<span class="c">// pet.mag</span>
<span class="k">defclass</span> <span class="t">Pet</span>
  <span class="k">val</span> <span class="i">name</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// main.mag</span>
<span class="k">import</span> <span class="t">Pal</span>
<span class="k">import</span> <span class="t">Pet</span>

<span class="k">def</span> <span class="i">greet</span><span class="p">(</span><span class="i">who</span><span class="p">)</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;Hi, &quot;</span> <span class="o">+</span> <span class="i">who</span> <span class="i">name</span> <span class="o">+</span> <span class="s">&quot;!&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="i">greet</span><span class="p">(</span><span class="t">Pal</span> <span class="i">new</span><span class="p">(</span><span class="i">name</span><span class="p">:</span> <span class="s">&quot;Fred&quot;</span><span class="p">))</span>
<span class="i">greet</span><span class="p">(</span><span class="t">Pet</span> <span class="i">new</span><span class="p">(</span><span class="i">name</span><span class="p">:</span> <span class="s">&quot;Rex&quot;</span><span class="p">))</span>
</code></pre></div>
<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart">pal  pet
 ^    ^
 └─┐┌─┘
  main
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// main.mag</span>
<span class="k">import</span> <span class="t">Pal</span> <span class="k">with</span>
    <span class="i">name</span> <span class="k">as</span> <span class="i">pal</span><span class="p">.</span><span class="i">name</span>
<span class="k">end</span>
<span class="k">import</span> <span class="t">Pet</span> <span class="k">with</span>
    <span class="i">name</span> <span class="k">as</span> <span class="i">pet</span><span class="p">.</span><span class="i">name</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Cow</span>
  <span class="k">def</span> <span class="i">speak</span><span class="p">()</span>
    <span class="i">puts</span> <span class="s">&quot;moo&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">Dog</span>
  <span class="k">def</span> <span class="i">speak</span><span class="p">()</span>
    <span class="i">puts</span> <span class="s">&quot;woof&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">defclass</span> <span class="t">Cow</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="k">is</span> <span class="t">Cow</span><span class="p">)</span> <span class="i">speak</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;moo&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defclass</span> <span class="t">Dog</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="k">is</span> <span class="t">Dog</span><span class="p">)</span> <span class="i">speak</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;woof&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Dog</span>
  <span class="k">def</span> <span class="i">serialize</span><span class="p">(</span><span class="i">stream</span><span class="p">)</span>
    <span class="i">stream</span> <span class="i">write</span><span class="p">(</span><span class="s">&quot;dog&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">Cow</span>
  <span class="k">def</span> <span class="i">serialize</span><span class="p">(</span><span class="i">stream</span><span class="p">)</span>
    <span class="i">stream</span> <span class="i">write</span><span class="p">(</span><span class="s">&quot;cow&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Dog</span>
  <span class="k">def</span> <span class="i">serialize</span><span class="p">(</span><span class="i">xmlWriter</span><span class="p">)</span>
    <span class="i">xmlWriter</span> <span class="i">write</span><span class="p">(</span><span class="s">&quot;&lt;dog&gt;&lt;/dog&gt;&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">Cow</span>
  <span class="k">def</span> <span class="i">serialize</span><span class="p">(</span><span class="i">xmlWriter</span><span class="p">)</span>
    <span class="i">xmlWriter</span> <span class="i">write</span><span class="p">(</span><span class="s">&quot;&lt;cow&gt;&lt;/cow&gt;&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="i">dog</span> <span class="k">is</span> <span class="t">Dog</span><span class="p">)</span> <span class="i">write</span><span class="p">(</span><span class="i">stream</span> <span class="k">is</span> <span class="t">Stream</span><span class="p">)</span>
  <span class="i">stream</span> <span class="i">write</span><span class="p">(</span><span class="s">&quot;dog&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="i">cow</span> <span class="k">is</span> <span class="t">Cow</span><span class="p">)</span> <span class="i">write</span><span class="p">(</span><span class="i">stream</span> <span class="k">is</span> <span class="t">Stream</span><span class="p">)</span>
  <span class="i">stream</span> <span class="i">write</span><span class="p">(</span><span class="s">&quot;cow&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="i">dog</span> <span class="k">is</span> <span class="t">Dog</span><span class="p">)</span> <span class="i">write</span><span class="p">(</span><span class="i">writer</span> <span class="k">is</span> <span class="t">XmlWriter</span><span class="p">)</span>
  <span class="i">writer</span> <span class="i">write</span><span class="p">(</span><span class="s">&quot;&lt;dog&gt;&lt;/dog&gt;&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="p">(</span><span class="i">cow</span> <span class="k">is</span> <span class="t">Cow</span><span class="p">)</span> <span class="i">write</span><span class="p">(</span><span class="i">writer</span> <span class="k">is</span> <span class="t">XmlWriter</span><span class="p">)</span>
  <span class="i">writer</span> <span class="i">write</span><span class="p">(</span><span class="s">&quot;&lt;cow&gt;&lt;/cow&gt;&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<h2>2012/12/19/the-impoliteness-of-overriding-methods</h2>

<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Account:
  (# balance: @integer;
    Deposit:
      (# amount: @integer
      enter amount
      do balance+amount-&gt;balance
      exit balance
      #);

    Withdraw:
      (# amount: @integer
      enter amount
      do balance-amount-&gt;balance
      exit balance
      #);
  #)
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">var</span> <span class="i">account</span> <span class="o">=</span> <span class="p">{</span>
  <span class="i">balance</span><span class="p">:</span> <span class="i">undefined</span><span class="p">,</span>

  <span class="i">deposit</span><span class="p">:</span> <span class="k">function</span><span class="p">(</span><span class="i">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="i">balance</span> <span class="o">+=</span> <span class="i">amount</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="i">withdraw</span><span class="p">:</span> <span class="k">function</span><span class="p">(</span><span class="i">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="i">balance</span> <span class="o">-=</span> <span class="i">amount</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">Account</span> <span class="p">{</span>
  <span class="t">int</span> <span class="i">balance</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="t">int</span> <span class="i">deposit</span><span class="p">(</span><span class="t">int</span> <span class="i">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">balance</span> <span class="o">+=</span> <span class="i">amount</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">CrappyBankAccount</span> <span class="k">extends</span> <span class="t">Account</span> <span class="p">{</span>
  <span class="t">int</span> <span class="i">deposit</span><span class="p">(</span><span class="t">int</span> <span class="i">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// Service charge, sucker!</span>
    <span class="t">CrappyBank</span><span class="p">.</span><span class="i">mainAccount</span><span class="p">.</span><span class="i">deposit</span><span class="p">(</span><span class="n">2</span><span class="p">);</span>
    <span class="k">super</span><span class="p">.</span><span class="i">deposit</span><span class="p">(</span><span class="i">amount</span> <span class="o">-</span> <span class="n">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="t">Account</span> <span class="i">account</span> <span class="o">=</span> <span class="k">new</span> <span class="t">CrappyBankAccount</span><span class="p">();</span>
<span class="i">account</span><span class="p">.</span><span class="i">deposit</span><span class="p">(</span><span class="n">23</span><span class="p">);</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">GameObject</span> <span class="p">{</span>
  <span class="t">float</span> <span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">;</span>

  <span class="t">void</span> <span class="i">render</span><span class="p">(</span><span class="t">Renderer</span> <span class="i">renderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">setTransform</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">ScaryMonster</span> <span class="k">extends</span> <span class="t">GameObject</span> <span class="p">{</span>
  <span class="t">void</span> <span class="i">render</span><span class="p">(</span><span class="t">Renderer</span> <span class="i">renderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="i">render</span><span class="p">(</span><span class="i">renderer</span><span class="p">);</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">drawImage</span><span class="p">(</span><span class="t">Images</span><span class="p">.</span><span class="i">SCARY_MONSTER</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">GameObject</span> <span class="p">{</span>
  <span class="t">float</span> <span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">;</span>

  <span class="t">void</span> <span class="i">render</span><span class="p">(</span><span class="t">Renderer</span> <span class="i">renderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">setTransform</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">);</span>
    <span class="i">onRender</span><span class="p">(</span><span class="i">renderer</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">protected</span> <span class="k">abstract</span> <span class="t">void</span> <span class="i">onRender</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">ScaryMonster</span> <span class="k">extends</span> <span class="t">GameObject</span> <span class="p">{</span>
  <span class="k">protected</span> <span class="t">void</span> <span class="i">onRender</span><span class="p">(</span><span class="t">Renderer</span> <span class="i">renderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">drawImage</span><span class="p">(</span><span class="t">Images</span><span class="p">.</span><span class="i">SCARY_MONSTER</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">GameObject</span> <span class="p">{</span>
  <span class="t">float</span> <span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">;</span>

  <span class="t">void</span> <span class="i">render</span><span class="p">(</span><span class="t">Renderer</span> <span class="i">renderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">setTransform</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">);</span>
    <span class="i">inner</span><span class="p">(</span><span class="i">renderer</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">ScaryMonster</span> <span class="k">extends</span> <span class="t">GameObject</span> <span class="p">{</span>
  <span class="t">void</span> <span class="i">render</span><span class="p">(</span><span class="t">Renderer</span> <span class="i">renderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">drawImage</span><span class="p">(</span><span class="t">Images</span><span class="p">.</span><span class="i">SCARY_MONSTER</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>java</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">class</span> <span class="t">GameObject</span> <span class="p">{</span>
  <span class="t">float</span> <span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">;</span>

  <span class="t">void</span> <span class="i">render</span><span class="p">(</span><span class="t">Renderer</span> <span class="i">renderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">setTransform</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">);</span>
    <span class="i">inner</span><span class="p">(</span><span class="i">renderer</span><span class="p">);</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">restoreState</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">ScaryMonster</span> <span class="k">extends</span> <span class="t">GameObject</span> <span class="p">{</span>
  <span class="t">void</span> <span class="i">render</span><span class="p">(</span><span class="t">Renderer</span> <span class="i">renderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">renderer</span><span class="p">.</span><span class="i">drawImage</span><span class="p">(</span><span class="t">Images</span><span class="p">.</span><span class="i">SCARY_MONSTER</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2013/01/13/iteration-inside-and-out</h2>

<p>fortran</p>
<div class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="k">do</span> <span class="i">i</span><span class="o">=</span><span class="n">1</span><span class="p">,</span><span class="n">10</span>
  <span class="k">print</span> <span class="i">i</span>
<span class="k">end</span> <span class="k">do</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">,</span> <span class="n">5</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">i</span> <span class="k">in</span> <span class="i">elements</span><span class="p">)</span> <span class="i">print</span><span class="p">(</span><span class="i">i</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">,</span> <span class="n">5</span><span class="p">];</span>
<span class="k">var</span> <span class="i">__iterator</span> <span class="o">=</span> <span class="i">elements</span><span class="p">.</span><span class="i">iterator</span><span class="p">();</span>
<span class="k">while</span> <span class="p">(</span><span class="i">__iterator</span><span class="p">.</span><span class="i">moveNext</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">i</span> <span class="o">=</span> <span class="i">__iterator</span><span class="p">.</span><span class="i">current</span><span class="p">;</span>
  <span class="i">print</span><span class="p">(</span><span class="i">i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">bool</span> <span class="i">find</span><span class="p">(</span><span class="t">Iterable</span> <span class="i">haystack</span><span class="p">,</span> <span class="t">Object</span> <span class="i">needle</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">haystack</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">item</span> <span class="o">==</span> <span class="i">needle</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">Iterable</span> <span class="i">interleave</span><span class="p">(</span><span class="t">Iterable</span> <span class="i">a</span><span class="p">,</span> <span class="t">Iterable</span> <span class="i">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="t">InterleaveIterable</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">InterleaveIterable</span> <span class="p">{</span>
  <span class="t">Iterable</span> <span class="i">a</span><span class="p">;</span>
  <span class="t">Iterable</span> <span class="i">b</span><span class="p">;</span>
  <span class="t">InterleaveIterable</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">a</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="i">b</span><span class="p">);</span>

  <span class="t">Iterator</span> <span class="k">get</span> <span class="i">iterator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="t">InterleaveIterator</span><span class="p">(</span><span class="i">a</span><span class="p">.</span><span class="i">iterator</span><span class="p">(),</span> <span class="i">b</span><span class="p">.</span><span class="i">iterator</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">InterleaveIterator</span> <span class="p">{</span>
  <span class="t">Iterator</span> <span class="i">a</span><span class="p">;</span>
  <span class="t">Iterator</span> <span class="i">b</span><span class="p">;</span>
  <span class="t">InterleaveIterator</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">a</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="i">b</span><span class="p">);</span>

  <span class="t">bool</span> <span class="i">moveNext</span><span class="p">()</span> <span class="p">{</span>
    <span class="c">// Stop if we&#39;re done.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="i">a</span><span class="p">.</span><span class="i">moveNext</span><span class="p">())</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

    <span class="c">// Swap iterators so we pull from the other one next time.</span>
    <span class="k">var</span> <span class="i">temp</span> <span class="o">=</span> <span class="i">a</span><span class="p">;</span>
    <span class="i">a</span> <span class="o">=</span> <span class="i">b</span><span class="p">;</span>
    <span class="i">b</span> <span class="o">=</span> <span class="i">temp</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">get</span> <span class="i">current</span> <span class="o">=&gt;</span> <span class="i">a</span><span class="p">.</span><span class="i">current</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Tree</span> <span class="p">{</span>
  <span class="t">Tree</span> <span class="i">left</span><span class="p">;</span>
  <span class="t">String</span> <span class="i">label</span><span class="p">;</span>
  <span class="t">Tree</span> <span class="i">right</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">printTree</span><span class="p">(</span><span class="t">Tree</span> <span class="i">tree</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">left</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="i">printTree</span><span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">left</span><span class="p">);</span>
  <span class="i">print</span><span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">label</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">right</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="i">printTree</span><span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">right</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">printTree</span><span class="p">(</span><span class="t">Tree</span> <span class="i">tree</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">node</span> <span class="k">in</span> <span class="i">tree</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">print</span><span class="p">(</span><span class="i">node</span><span class="p">.</span><span class="i">label</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Tree</span> <span class="k">implements</span> <span class="t">Iterable</span><span class="o">&lt;</span><span class="t">Tree</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="t">Tree</span> <span class="i">left</span><span class="p">;</span>
  <span class="t">String</span> <span class="i">label</span><span class="p">;</span>
  <span class="t">Tree</span> <span class="i">right</span><span class="p">;</span>
  <span class="t">Tree</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">left</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="i">label</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="i">right</span><span class="p">);</span>
  <span class="t">Iterator</span> <span class="k">get</span> <span class="i">iterator</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="t">TreeIterator</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">IterateState</span> <span class="p">{</span>
  <span class="t">Tree</span> <span class="i">tree</span><span class="p">;</span>
  <span class="t">int</span> <span class="i">step</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="t">IterateState</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">tree</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">TreeIterator</span> <span class="k">implements</span> <span class="t">Iterator</span><span class="o">&lt;</span><span class="t">Tree</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">stack</span> <span class="o">=</span> <span class="o">&lt;</span><span class="t">IterateState</span><span class="o">&gt;</span><span class="p">[];</span>
  <span class="t">TreeIterator</span><span class="p">(</span><span class="t">Tree</span> <span class="i">tree</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">stack</span><span class="p">.</span><span class="i">add</span><span class="p">(</span><span class="t">IterateState</span><span class="p">(</span><span class="i">tree</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="t">bool</span> <span class="i">moveNext</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="i">hasValue</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="i">stack</span><span class="p">.</span><span class="i">length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="i">hasValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">var</span> <span class="i">state</span> <span class="o">=</span> <span class="i">stack</span><span class="p">.</span><span class="i">last</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span><span class="i">state</span><span class="p">.</span><span class="i">step</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">0</span><span class="p">:</span>
        <span class="i">state</span><span class="p">.</span><span class="i">step</span> <span class="o">=</span> <span class="n">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">state</span><span class="p">.</span><span class="i">tree</span><span class="p">.</span><span class="i">left</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="i">stack</span><span class="p">.</span><span class="i">add</span><span class="p">(</span><span class="t">IterateState</span><span class="p">(</span><span class="i">state</span><span class="p">.</span><span class="i">tree</span><span class="p">.</span><span class="i">left</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="n">1</span><span class="p">:</span>
        <span class="i">state</span><span class="p">.</span><span class="i">step</span> <span class="o">=</span> <span class="n">2</span><span class="p">;</span>
        <span class="i">current</span> <span class="o">=</span> <span class="i">state</span><span class="p">.</span><span class="i">tree</span><span class="p">;</span>
        <span class="i">hasValue</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="n">2</span><span class="p">:</span>
        <span class="i">stack</span><span class="p">.</span><span class="i">removeLast</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">state</span><span class="p">.</span><span class="i">tree</span><span class="p">.</span><span class="i">right</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="i">stack</span><span class="p">.</span><span class="i">add</span><span class="p">(</span><span class="t">IterateState</span><span class="p">(</span><span class="i">state</span><span class="p">.</span><span class="i">tree</span><span class="p">.</span><span class="i">right</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="i">hasValue</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="t">Tree</span> <span class="i">current</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">beatles</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;George&#39;</span><span class="p">,</span> <span class="s">&#39;John&#39;</span><span class="p">,</span> <span class="s">&#39;Paul&#39;</span><span class="p">,</span> <span class="s">&#39;Ringo&#39;</span><span class="p">]</span>
<span class="i">beatles</span><span class="p">.</span><span class="i">each</span> <span class="p">{</span> <span class="o">|</span><span class="i">beatle</span><span class="o">|</span> <span class="i">puts</span> <span class="i">beatle</span> <span class="p">}</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Tree</span>
  <span class="i">attr_accessor</span> <span class="p">:</span><span class="i">left</span><span class="p">,</span> <span class="p">:</span><span class="i">label</span><span class="p">,</span> <span class="p">:</span><span class="i">right</span>

  <span class="k">def</span> <span class="i">initialize</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">label</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
    <span class="f">@left</span> <span class="o">=</span> <span class="i">left</span>
    <span class="f">@label</span> <span class="o">=</span> <span class="i">label</span>
    <span class="f">@right</span> <span class="o">=</span> <span class="i">right</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">tree</span><span class="p">.</span><span class="i">in_order</span> <span class="p">{</span> <span class="o">|</span><span class="i">node</span><span class="o">|</span> <span class="i">puts</span> <span class="i">node</span><span class="p">.</span><span class="i">label</span> <span class="p">}</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Tree</span>
  <span class="k">def</span> <span class="i">in_order</span><span class="p">(</span><span class="o">&amp;</span><span class="i">code</span><span class="p">)</span>
    <span class="f">@left</span><span class="p">.</span><span class="i">in_order</span> <span class="o">&amp;</span><span class="i">code</span> <span class="k">if</span> <span class="f">@left</span>
    <span class="i">code</span><span class="p">.</span><span class="i">call</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="f">@right</span><span class="p">.</span><span class="i">in_order</span> <span class="o">&amp;</span><span class="i">code</span> <span class="k">if</span> <span class="f">@right</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">inOrder</span><span class="p">(</span><span class="t">Tree</span> <span class="i">tree</span><span class="p">,</span> <span class="k">void</span> <span class="k">Function</span><span class="p">(</span><span class="t">Tree</span> <span class="i">tree</span><span class="p">)</span> <span class="i">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">left</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="i">inOrder</span><span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">left</span><span class="p">);</span>
  <span class="i">callback</span><span class="p">(</span><span class="i">tree</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">right</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="i">inOrder</span><span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">right</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="i">contains</span><span class="p">(</span><span class="i">haystack</span><span class="p">,</span> <span class="i">needle</span><span class="p">)</span>
  <span class="i">haystack</span><span class="p">.</span><span class="i">each</span> <span class="p">{</span> <span class="o">|</span><span class="i">item</span><span class="o">|</span> <span class="k">return</span> <span class="t">true</span> <span class="k">if</span> <span class="i">item</span> <span class="o">==</span> <span class="i">needle</span> <span class="p">}</span>
  <span class="t">false</span>
<span class="k">end</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">bool</span> <span class="i">contains</span><span class="p">(</span><span class="t">Iterable</span> <span class="i">haystack</span><span class="p">,</span> <span class="i">needle</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">haystack</span><span class="p">.</span><span class="i">forEach</span><span class="p">((</span><span class="i">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">item</span> <span class="o">==</span> <span class="i">needle</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="p">(</span><span class="i">item</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">item</span> <span class="o">==</span> <span class="i">needle</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">lameExample</span><span class="p">()</span> <span class="p">{</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;I&#39;m at the top&quot;</span><span class="p">);</span>
  <span class="i">doSomething</span><span class="p">();</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;I&#39;m in the middle&quot;</span><span class="p">);</span>
  <span class="i">doSomething</span><span class="p">();</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;Dead last like a chump&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">printTree</span><span class="p">(</span><span class="t">Tree</span> <span class="i">tree</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">left</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="i">printTree</span><span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">left</span><span class="p">);</span>
  <span class="i">print</span><span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">label</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">right</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="i">printTree</span><span class="p">(</span><span class="i">tree</span><span class="p">.</span><span class="i">right</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart">┌────────────┐
│ moveNext() │
├────────────┤
│ loop body  │
└────────────┘
  ...

  main()
</code></pre></div>
<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart">┌────────────────────────┐
│ each()                 │
├────────────────────────┤
│ method containing loop │
└────────────────────────┘
  ...

  main()
</code></pre></div>
<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart">┌────────────────────────┐
│ block                  │
└────────────────────────┘
  stuff...
┌────────────────────────┐
│ each()                 │
├────────────────────────┤
│ method containing loop │
└────────────────────────┘
  ...

  main()
</code></pre></div>
<h2>2013/02/24/iteration-inside-and-out-part-2</h2>

<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">IEnumerable</span> <span class="i">Concat</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">,</span> <span class="t">IEnumerable</span> <span class="i">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="t">ConcatEnumerable</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">ConcatEnumerable</span>
<span class="p">{</span>
  <span class="t">IEnumerable</span> <span class="i">a</span><span class="p">;</span>
  <span class="t">IEnumerable</span> <span class="i">b</span><span class="p">;</span>
  <span class="i">ConcatEnumerable</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">,</span> <span class="t">IEnumerable</span> <span class="i">b</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="i">a</span> <span class="o">=</span> <span class="i">a</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="i">b</span> <span class="o">=</span> <span class="i">b</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="t">IEnumerable</span> <span class="i">GetEnumerator</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="t">ConcatEnumerator</span><span class="p">(</span>
        <span class="i">a</span><span class="p">.</span><span class="i">GetEnumerator</span><span class="p">(),</span> <span class="i">b</span><span class="p">.</span><span class="i">GetEnumerator</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">ConcatEnumerator</span>
<span class="p">{</span>
  <span class="t">IEnumerator</span> <span class="i">a</span><span class="p">;</span>
  <span class="t">IEnumerator</span> <span class="i">b</span><span class="p">;</span>
  <span class="t">bool</span> <span class="i">onFirst</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
  <span class="i">ConcatEnumerator</span><span class="p">(</span><span class="t">IEnumerator</span> <span class="i">a</span><span class="p">,</span> <span class="t">IEnumerator</span> <span class="i">b</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="i">a</span> <span class="o">=</span> <span class="i">a</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="i">b</span> <span class="o">=</span> <span class="i">b</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="t">bool</span> <span class="i">MoveNext</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="c">// Which sequence are we on?</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">onFirst</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c">// Stay on first.</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">a</span><span class="p">.</span><span class="i">MoveNext</span><span class="p">())</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

      <span class="c">// Move to the next sequence.</span>
      <span class="i">onFirst</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="i">b</span><span class="p">.</span><span class="i">MoveNext</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c">// On second.</span>
    <span class="k">return</span> <span class="i">b</span><span class="p">.</span><span class="i">MoveNext</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="t">Object</span> <span class="i">Current</span>
  <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="i">onFirst</span> <span class="o">?</span> <span class="i">a</span><span class="p">.</span><span class="i">Current</span> <span class="p">:</span> <span class="i">b</span><span class="p">.</span><span class="i">Current</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">IEnumerable</span> <span class="i">Concat</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">,</span> <span class="t">IEnumerable</span> <span class="i">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">a</span><span class="p">)</span> <span class="k">yield return</span> <span class="i">item</span><span class="p">;</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">b</span><span class="p">)</span> <span class="k">yield return</span> <span class="i">item</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">Concat</span><span class="p">(</span><span class="i">stuff</span><span class="p">,</span> <span class="i">moreStuff</span><span class="p">))</span>
<span class="p">{</span>
  <span class="i">Console</span><span class="p">.</span><span class="i">WriteLine</span><span class="p">(</span><span class="i">item</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>asciiart</p>
<div class="highlight"><pre><code class="language-asciiart" data-lang="asciiart">  stack                       heap
┌─────────────────────┐
│ iterator.MoveNext() │
├─────────────────────┤     ┌───────────────────┐
│ loop body           │ ──&gt; │ DesugaredIterator │
└─────────────────────┘     └───────────────────┘
  ...

  main()
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">IEnumerable</span> <span class="i">Concat</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">,</span> <span class="t">IEnumerable</span> <span class="i">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="i">WalkFirst</span><span class="p">(</span><span class="i">a</span><span class="p">);</span>
  <span class="i">WalkSecond</span><span class="p">(</span><span class="i">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="t">IEnumerable</span> <span class="i">WalkFirst</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">a</span><span class="p">)</span> <span class="k">yield return</span> <span class="i">item</span><span class="p">;</span>
<span class="p">}</span>

<span class="t">IEnumerable</span> <span class="i">WalkSecond</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">a</span><span class="p">)</span> <span class="k">yield return</span> <span class="i">item</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>csharp</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span></span><span class="t">IEnumerable</span> <span class="i">Concat</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">,</span> <span class="t">IEnumerable</span> <span class="i">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">WalkFirst</span><span class="p">(</span><span class="i">a</span><span class="p">))</span> <span class="k">yield return</span> <span class="i">item</span><span class="p">;</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">WalkSecond</span><span class="p">(</span><span class="i">a</span><span class="p">))</span> <span class="k">yield return</span> <span class="i">item</span><span class="p">;</span>
<span class="p">}</span>

<span class="t">IEnumerable</span> <span class="i">WalkFirst</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">a</span><span class="p">)</span> <span class="k">yield return</span> <span class="i">item</span><span class="p">;</span>
<span class="p">}</span>

<span class="t">IEnumerable</span> <span class="i">WalkSecond</span><span class="p">(</span><span class="t">IEnumerable</span> <span class="i">a</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="k">var</span> <span class="i">item</span> <span class="k">in</span> <span class="i">a</span><span class="p">)</span> <span class="k">yield return</span> <span class="i">item</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>python</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="i">concat</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">):</span>
  <span class="k">for</span> <span class="i">item</span> <span class="k">in</span> <span class="i">walkFirst</span><span class="p">(</span><span class="i">a</span><span class="p">):</span> <span class="k">yield</span> <span class="i">item</span>
  <span class="k">for</span> <span class="i">item</span> <span class="k">in</span> <span class="i">walkSecond</span><span class="p">(</span><span class="i">a</span><span class="p">):</span> <span class="k">yield</span> <span class="i">item</span>

<span class="k">def</span> <span class="i">walkFirst</span><span class="p">(</span><span class="i">a</span><span class="p">):</span>
  <span class="k">for</span> <span class="i">item</span> <span class="k">in</span> <span class="i">a</span><span class="p">:</span> <span class="k">yield</span> <span class="i">item</span>

<span class="k">def</span> <span class="i">walkSecond</span><span class="p">(</span><span class="i">a</span><span class="p">):</span>
  <span class="k">for</span> <span class="i">item</span> <span class="k">in</span> <span class="i">b</span><span class="p">:</span> <span class="k">yield</span> <span class="i">item</span>
</code></pre></div>
<p>python</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="i">concat</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">):</span>
  <span class="k">yield</span> <span class="k">from</span> <span class="i">walkFirst</span><span class="p">(</span><span class="i">a</span><span class="p">)</span>
  <span class="k">yield</span> <span class="k">from</span> <span class="i">walkSecond</span><span class="p">(</span><span class="i">a</span><span class="p">)</span>

<span class="k">def</span> <span class="i">walkFirst</span><span class="p">(</span><span class="i">a</span><span class="p">):</span>
  <span class="k">for</span> <span class="i">item</span> <span class="k">in</span> <span class="i">a</span><span class="p">:</span> <span class="k">yield</span> <span class="i">item</span>

<span class="k">def</span> <span class="i">walkSecond</span><span class="p">(</span><span class="i">a</span><span class="p">):</span>
  <span class="k">for</span> <span class="i">item</span> <span class="k">in</span> <span class="i">b</span><span class="p">:</span> <span class="k">yield</span> <span class="i">item</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Tree</span>
  <span class="i">attr_accessor</span> <span class="p">:</span><span class="i">left</span><span class="p">,</span> <span class="p">:</span><span class="i">label</span><span class="p">,</span> <span class="p">:</span><span class="i">right</span>

  <span class="k">def</span> <span class="i">initialize</span><span class="p">(</span><span class="i">left</span><span class="p">,</span> <span class="i">label</span><span class="p">,</span> <span class="i">right</span><span class="p">)</span>
    <span class="f">@left</span> <span class="o">=</span> <span class="i">left</span>
    <span class="f">@label</span> <span class="o">=</span> <span class="i">label</span>
    <span class="f">@right</span> <span class="o">=</span> <span class="i">right</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="i">each</span><span class="p">(</span><span class="o">&amp;</span><span class="i">code</span><span class="p">)</span>
    <span class="f">@left</span><span class="p">.</span><span class="i">each</span> <span class="o">&amp;</span><span class="i">code</span> <span class="k">if</span> <span class="f">@left</span>
    <span class="i">code</span><span class="p">.</span><span class="i">call</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="f">@right</span><span class="p">.</span><span class="i">each</span> <span class="o">&amp;</span><span class="i">code</span> <span class="k">if</span> <span class="f">@right</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">tree</span><span class="p">.</span><span class="i">each</span> <span class="p">{</span> <span class="o">|</span><span class="i">node</span><span class="o">|</span> <span class="i">puts</span> <span class="i">node</span><span class="p">.</span><span class="i">label</span> <span class="p">}</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Tree</span>
  <span class="c"># Mixin all of the enumerable methods to our class.</span>
  <span class="i">include</span> <span class="t">Enumerable</span>
<span class="k">end</span>

<span class="i">a</span> <span class="o">=</span> <span class="c"># Some tree...</span>
<span class="i">b</span> <span class="o">=</span> <span class="c"># Another tree...</span>

<span class="k">if</span> <span class="i">a</span><span class="p">.</span><span class="i">zip</span><span class="p">(</span><span class="i">b</span><span class="p">).</span><span class="i">each</span><span class="p">.</span><span class="i">all?</span> <span class="p">{</span> <span class="o">|</span><span class="i">pair</span><span class="o">|</span> <span class="i">pair</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="o">==</span> <span class="i">pair</span><span class="p">[</span><span class="n">1</span><span class="p">]</span> <span class="p">}</span>
  <span class="i">puts</span> <span class="s">&quot;Equal!&quot;</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">a</span> <span class="o">=</span> <span class="c"># Some tree...</span>
<span class="i">b</span> <span class="o">=</span> <span class="c"># Another tree...</span>

<span class="i">a_enum</span> <span class="o">=</span> <span class="i">a</span><span class="p">.</span><span class="i">to_enum</span>
<span class="i">b_enum</span> <span class="o">=</span> <span class="i">b</span><span class="p">.</span><span class="i">to_enum</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="i">loop</span> <span class="k">do</span>
  <span class="k">if</span> <span class="i">a_enum</span><span class="p">.</span><span class="k">next</span> <span class="o">!=</span> <span class="i">b_enum</span><span class="p">.</span><span class="k">next</span>
    <span class="i">puts</span> <span class="s">&quot;Not equal!&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">Object</span>
  <span class="k">def</span> <span class="i">to_enum</span>
    <span class="t">MyEnumerator</span><span class="p">.</span><span class="i">new</span> <span class="k">self</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>ruby</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="t">MyEnumerator</span>
  <span class="i">include</span> <span class="t">Enumerable</span>

  <span class="k">def</span> <span class="i">initialize</span><span class="p">(</span><span class="i">obj</span><span class="p">)</span>
    <span class="f">@fiber</span> <span class="o">=</span> <span class="t">Fiber</span><span class="p">.</span><span class="i">new</span> <span class="k">do</span>  <span class="c"># Spin up a new fiber.</span>
      <span class="i">obj</span><span class="p">.</span><span class="i">each</span> <span class="k">do</span> <span class="o">|</span><span class="i">value</span><span class="o">|</span>  <span class="c"># Run the internal iterator on it.</span>
        <span class="t">Fiber</span><span class="p">.</span><span class="k">yield</span><span class="p">(</span><span class="i">value</span><span class="p">)</span> <span class="c"># When it yields a value, suspend</span>
                           <span class="c"># the fiber and emit the value.</span>
      <span class="k">end</span>
      <span class="i">raise</span> <span class="t">StopIteration</span>  <span class="c"># Then signal that we&#39;re done.</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="k">next</span>
    <span class="f">@fiber</span><span class="p">.</span><span class="i">resume</span>          <span class="c"># When the next value is requested,</span>
                           <span class="c"># resume the fiber.</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>2013/04/17/well-done</h2>

<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">async</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;I&#39;m in another fiber!&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">async</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;I&#39;m in another fiber!&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="i">print</span><span class="p">(</span><span class="s">&quot;Before&quot;</span><span class="p">)</span>
<span class="i">print</span><span class="p">(</span><span class="s">&quot;After&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Before
I&#39;m in another fiber!
After
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">channel</span> <span class="o">=</span> <span class="t">Channel</span> <span class="i">new</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">channel</span> <span class="i">send</span><span class="p">(</span><span class="s">&quot;My value&quot;</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="i">channel</span> <span class="i">receive</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">channel</span> <span class="i">close</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">channel</span> <span class="o">=</span> <span class="t">Channel</span> <span class="i">new</span>

<span class="c">// Wait for a value and print it.</span>
<span class="k">async</span> <span class="i">print</span><span class="p">(</span><span class="i">channel</span> <span class="i">receive</span><span class="p">)</span>

<span class="c">// From the main fiber, close the channel.</span>
<span class="i">channel</span> <span class="i">close</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">async</span>
  <span class="k">do</span>
    <span class="i">print</span><span class="p">(</span><span class="i">channel</span> <span class="i">receive</span><span class="p">)</span>
  <span class="k">catch</span> <span class="i">err</span> <span class="k">is</span> <span class="t">ChannelClosedError</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;Sorry, no value for you&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">async</span>
  <span class="i">print</span><span class="p">(</span><span class="i">channel</span> <span class="i">receive</span><span class="p">)</span>
<span class="k">catch</span> <span class="i">err</span> <span class="k">is</span> <span class="t">ChannelClosedError</span> <span class="k">then</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;Sorry, no value for you&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">channel</span> <span class="o">=</span> <span class="t">Channel</span> <span class="i">new</span>

<span class="k">async</span>
  <span class="k">var</span> <span class="i">count</span> <span class="o">=</span> <span class="n">1</span>
  <span class="k">while</span> <span class="k">true</span> <span class="k">do</span>
    <span class="k">match</span> <span class="i">channel</span> <span class="i">receive</span>
      <span class="k">case</span> <span class="s">&quot;inc&quot;</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span>
      <span class="k">case</span> <span class="s">&quot;dec&quot;</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">-</span> <span class="n">1</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">async</span>
  <span class="k">var</span> <span class="i">count</span> <span class="o">=</span> <span class="n">1</span>
  <span class="k">while</span> <span class="k">true</span> <span class="k">do</span>
    <span class="k">match</span> <span class="i">channel</span> <span class="i">receive</span>
      <span class="k">case</span> <span class="s">&quot;inc&quot;</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span>
      <span class="k">case</span> <span class="s">&quot;dec&quot;</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">-</span> <span class="n">1</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">catch</span> <span class="i">err</span> <span class="k">is</span> <span class="t">ChannelClosedError</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;Closed&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">async</span>
  <span class="k">var</span> <span class="i">count</span> <span class="o">=</span> <span class="n">1</span>
  <span class="k">while</span> <span class="k">true</span> <span class="k">do</span>
    <span class="k">match</span> <span class="i">channel</span> <span class="i">receive</span>
      <span class="k">case</span> <span class="s">&quot;inc&quot;</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span>
      <span class="k">case</span> <span class="s">&quot;dec&quot;</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">-</span> <span class="n">1</span><span class="p">)</span>
      <span class="k">case</span> <span class="i">done</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;Closed&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="i">foo</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="i">result</span> <span class="o">===</span> <span class="s">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">console</span><span class="p">.</span><span class="i">log</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="i">result</span> <span class="o">===</span> <span class="s">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">console</span><span class="p">.</span><span class="i">log</span><span class="p">(</span><span class="s">&quot;string&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">match</span> <span class="i">foo</span><span class="p">()</span>
  <span class="k">case</span> <span class="k">is</span> <span class="t">Num</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">)</span>
  <span class="k">case</span> <span class="k">is</span> <span class="t">String</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;string&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">print</span><span class="p">(</span><span class="k">match</span> <span class="i">foo</span><span class="p">()</span>
  <span class="k">case</span> <span class="k">is</span> <span class="t">Num</span> <span class="k">then</span> <span class="s">&quot;number&quot;</span>
  <span class="k">case</span> <span class="k">is</span> <span class="t">String</span> <span class="k">then</span> <span class="s">&quot;string&quot;</span>
<span class="k">end</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="i">showType</span><span class="p">(</span><span class="k">is</span> <span class="t">Num</span><span class="p">)</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="i">showType</span><span class="p">(</span><span class="k">is</span> <span class="t">String</span><span class="p">)</span> <span class="i">print</span><span class="p">(</span><span class="s">&quot;string&quot;</span><span class="p">)</span>

<span class="i">showType</span><span class="p">(</span><span class="i">foo</span><span class="p">())</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">async</span>
    <span class="k">var</span> <span class="i">count</span> <span class="o">=</span> <span class="n">1</span>
    <span class="k">for</span> <span class="i">value</span> <span class="k">in</span> <span class="i">channel</span> <span class="i">receive</span>
        <span class="k">match</span> <span class="i">value</span>
            <span class="k">case</span> <span class="s">&quot;inc&quot;</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span>
            <span class="k">case</span> <span class="s">&quot;dec&quot;</span> <span class="k">then</span> <span class="i">print</span><span class="p">(</span><span class="i">count</span> <span class="o">=</span> <span class="i">count</span> <span class="o">-</span> <span class="n">1</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;Closed&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="k">is</span> <span class="t">Iterable</span><span class="p">)</span> <span class="i">iterate</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="k">is</span> <span class="t">Iterator</span><span class="p">)</span> <span class="i">advance</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">def</span> <span class="p">(</span><span class="k">is</span> <span class="t">Iterator</span><span class="p">)</span> <span class="i">current</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="k">var</span> <span class="i">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">]</span>
<span class="i">list</span> <span class="i">map</span><span class="p">(</span><span class="k">fn</span><span class="p">(</span><span class="i">i</span><span class="p">)</span> <span class="i">i</span> <span class="o">*</span> <span class="n">3</span><span class="p">)</span> <span class="c">// 3, 6, 9, 12.</span>
<span class="i">list</span> <span class="i">where</span><span class="p">(</span><span class="k">fn</span><span class="p">(</span><span class="i">i</span><span class="p">)</span> <span class="i">i</span> <span class="o">%</span> <span class="n">2</span> <span class="o">==</span> <span class="n">0</span><span class="p">)</span> <span class="c">// 2, 4.</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="c">// Send the sequence 2, 3, 4, ... to &#39;channel&#39;.</span>
<span class="k">def</span> <span class="i">generate</span><span class="p">(</span><span class="i">channel</span> <span class="k">is</span> <span class="t">Channel</span><span class="p">)</span> <span class="k">async</span>
  <span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">2.</span><span class="p">.</span><span class="n">9999</span> <span class="k">do</span> <span class="i">channel</span> <span class="i">send</span><span class="p">(</span><span class="i">i</span><span class="p">)</span>
<span class="k">end</span>

<span class="c">// Copy the values from &#39;input&#39; to &#39;out&#39;,</span>
<span class="c">// removing those divisible by &#39;prime&#39;.</span>
<span class="k">def</span> <span class="i">filter</span><span class="p">(</span><span class="i">input</span> <span class="k">is</span> <span class="t">Channel</span><span class="p">,</span> <span class="i">out</span> <span class="k">is</span> <span class="t">Channel</span><span class="p">,</span> <span class="i">prime</span> <span class="k">is</span> <span class="t">Int</span><span class="p">)</span> <span class="k">async</span>
  <span class="i">input</span> <span class="i">where</span><span class="p">(</span><span class="k">fn</span><span class="p">(</span><span class="i">i</span><span class="p">)</span> <span class="i">i</span> <span class="o">%</span> <span class="i">prime</span> <span class="o">!=</span> <span class="n">0</span><span class="p">)</span> <span class="i">pipeTo</span><span class="p">(</span><span class="i">out</span><span class="p">)</span>
<span class="k">end</span>

<span class="c">// The prime sieve: Daisy-chain Filter processes.</span>
<span class="k">var</span> <span class="i">channel</span> <span class="o">=</span> <span class="t">Channel</span> <span class="i">new</span>
<span class="i">generate</span><span class="p">(</span><span class="i">channel</span><span class="p">)</span> <span class="c">// Spawn generate fiber.</span>

<span class="k">for</span> <span class="i">i</span> <span class="k">in</span> <span class="n">0.</span><span class="p">.</span><span class="n">50</span> <span class="k">do</span>
  <span class="k">val</span> <span class="i">prime</span> <span class="o">=</span> <span class="i">print</span><span class="p">(</span><span class="i">channel</span> <span class="i">receive</span><span class="p">)</span>
  <span class="k">val</span> <span class="i">sieve</span> <span class="o">=</span> <span class="t">Channel</span> <span class="i">new</span>
  <span class="i">filter</span><span class="p">(</span><span class="i">channel</span><span class="p">,</span> <span class="i">sieve</span><span class="p">,</span> <span class="i">prime</span><span class="p">)</span>
  <span class="i">channel</span> <span class="o">=</span> <span class="i">sieve</span>
<span class="k">end</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="i">input</span> <span class="i">where</span><span class="p">(</span><span class="k">fn</span><span class="p">(</span><span class="i">i</span><span class="p">)</span> <span class="i">i</span> <span class="o">%</span> <span class="i">prime</span> <span class="o">!=</span> <span class="n">0</span><span class="p">)</span> <span class="i">pipeTo</span><span class="p">(</span><span class="i">output</span><span class="p">)</span>
</code></pre></div>
<p>magpie</p>
<div class="highlight"><pre><code class="language-magpie" data-lang="magpie"><span></span><span class="p">[</span><span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">]</span> <span class="i">map</span><span class="p">(</span><span class="k">fn</span><span class="p">(</span><span class="i">i</span><span class="p">)</span> <span class="k">if</span> <span class="i">i</span> <span class="o">&lt;</span> <span class="n">3</span> <span class="k">then</span> <span class="i">i</span> <span class="o">*</span> <span class="n">2</span> <span class="k">else</span> <span class="i">done</span><span class="p">)</span>
</code></pre></div>
<h2>2013/04/23/playing-with-generics-in-typescript-0.9.0</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Base</span> <span class="p">{}</span>
<span class="k">class</span> <span class="t">Derived</span> <span class="k">extends</span> <span class="t">Base</span> <span class="p">{}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="i">constructor</span><span class="p">(</span><span class="i">public</span> <span class="i">value</span><span class="p">:</span> <span class="t">T</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">a</span> <span class="p">:</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">Base</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">Base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
<span class="k">var</span> <span class="i">b</span> <span class="p">:</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">Derived</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">Derived</span><span class="o">&gt;</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">new</span> <span class="t">Box</span><span class="o">&lt;</span><span class="i">number</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;not num&quot;</span><span class="p">)</span>
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>&#47;generics.ts(5,0): error TS2081: Supplied parameters do not match
any signature of call target.
&#47;generics.ts(5,0): error TS2085: Could not select overload for
&#39;new&#39; expression.
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">c</span> <span class="p">:</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">Base</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">Derived</span><span class="o">&gt;</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">d</span> <span class="p">:</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">Derived</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">Base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">e</span> <span class="p">:</span> <span class="t">Box</span><span class="o">&lt;</span><span class="i">number</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">string</span><span class="o">&gt;</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</code></pre></div>
<p>text</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>&#47;generics.ts(73,4): error TS2012: Cannot convert &#39;Box&lt;string&gt;&#39; to
&#39;Box&lt;number&gt;&#39;: Types of property &#39;value&#39; of types &#39;Box&lt;string&gt;&#39; and
&#39;Box&lt;number&gt;&#39; are incompatible.
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">A</span> <span class="p">{</span>
  <span class="i">foo</span><span class="p">(</span><span class="i">arg</span> <span class="p">:</span> <span class="t">Base</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">B</span> <span class="p">{</span>
  <span class="i">foo</span><span class="p">(</span><span class="i">arg</span> <span class="p">:</span> <span class="t">Derived</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">var</span> <span class="i">f</span> <span class="p">:</span> <span class="t">A</span> <span class="o">=</span> <span class="k">new</span> <span class="t">B</span><span class="p">();</span>
<span class="k">var</span> <span class="i">g</span> <span class="p">:</span> <span class="t">B</span> <span class="o">=</span> <span class="k">new</span> <span class="t">A</span><span class="p">();</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Box</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="i">constructor</span><span class="p">(</span><span class="i">public</span> <span class="i">value</span><span class="p">:</span> <span class="t">T</span><span class="p">)</span> <span class="p">{}</span>
  <span class="i">takeParam</span><span class="p">(</span><span class="i">arg</span><span class="p">:</span> <span class="t">T</span><span class="p">)</span> <span class="p">{}</span>
  <span class="i">returnType</span><span class="p">():</span> <span class="t">T</span> <span class="p">{</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Generic</span><span class="o">&lt;</span><span class="t">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="i">method</span><span class="p">(</span><span class="i">arg</span><span class="p">:</span> <span class="t">T</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">NotGeneric</span> <span class="p">{</span>
  <span class="i">method</span><span class="p">(</span><span class="i">arg</span><span class="p">:</span> <span class="i">number</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="i">h</span> <span class="p">:</span> <span class="t">NotGeneric</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Generic</span><span class="o">&lt;</span><span class="i">number</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ git clone https:&#47;&#47;git01.codeplex.com&#47;typescript
$ cd typescript
$ git checkout develop
$ jake local
$ chmod +x bin&#47;tsc
</code></pre></div>
<h2>2013/08/26/what-is-open-recursion</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">makeCounter</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">// Declare the instance state for the &quot;object&quot;.</span>
  <span class="k">var</span> <span class="i">count</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>

  <span class="c">// Declare functions for the &quot;methods&quot;. They are closures,</span>
  <span class="c">// so they can access `count`.</span>
  <span class="i">increment</span><span class="p">()</span> <span class="p">{</span>
    <span class="i">count</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">count</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">set</span><span class="p">(</span><span class="i">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">count</span> <span class="o">=</span> <span class="i">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c">// Make an &quot;object&quot; as a map of functions.</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="s">&#39;get&#39;</span><span class="p">:</span> <span class="k">get</span><span class="p">,</span>
    <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="k">set</span><span class="p">,</span>
    <span class="s">&#39;increment&#39;</span><span class="p">:</span> <span class="i">increment</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">makeCounter</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">// Declare the instance state for the &quot;object&quot;.</span>
  <span class="k">var</span> <span class="i">count</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>

  <span class="c">// Declare functions for the &quot;methods&quot;. They are closures,</span>
  <span class="c">// so they can access count.</span>
  <span class="i">increment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">set</span><span class="p">(</span><span class="k">get</span><span class="p">()</span> <span class="o">+</span> <span class="n">1</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="k">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">count</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">set</span><span class="p">(</span><span class="i">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">count</span> <span class="o">=</span> <span class="i">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c">// Make an &quot;object&quot; as a map of functions.</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="s">&#39;get&#39;</span><span class="p">:</span> <span class="k">get</span><span class="p">,</span>
    <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="k">set</span><span class="p">,</span>
    <span class="s">&#39;increment&#39;</span><span class="p">:</span> <span class="i">increment</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">makeCounter</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">// Declare the instance state for the &quot;object&quot;.</span>
  <span class="k">var</span> <span class="i">count</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>

  <span class="c">// Declare the variables up front.</span>
  <span class="k">var</span> <span class="i">increment</span><span class="p">,</span> <span class="k">get</span><span class="p">,</span> <span class="k">set</span><span class="p">.</span>

  <span class="c">// Now that the names are all in scope,</span>
  <span class="c">// create the function bodies.</span>
  <span class="i">increment</span> <span class="o">=</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">set</span><span class="p">(</span><span class="k">get</span><span class="p">()</span> <span class="o">+</span> <span class="n">1</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="k">get</span> <span class="o">=</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">count</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="k">set</span> <span class="o">=</span> <span class="p">(</span><span class="i">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">count</span> <span class="o">=</span> <span class="i">value</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="c">// Make an &quot;object&quot; as a map of functions.</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="s">&#39;get&#39;</span><span class="p">:</span> <span class="k">get</span><span class="p">,</span>
    <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="k">set</span><span class="p">,</span>
    <span class="s">&#39;increment&#39;</span><span class="p">:</span> <span class="i">increment</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">makeLoggingCounter</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">counter</span> <span class="o">=</span> <span class="i">makeCounter</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="s">&#39;get&#39;</span><span class="p">:</span> <span class="p">()</span> <span class="p">{</span>
      <span class="i">print</span><span class="p">(</span><span class="s">&#39;get!&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="i">counter</span><span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]();</span>
    <span class="p">},</span>
    <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="p">(</span><span class="i">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="i">print</span><span class="p">(</span><span class="s">&#39;set!&#39;</span><span class="p">);</span>
      <span class="i">counter</span><span class="p">[</span><span class="s">&#39;set&#39;</span><span class="p">](</span><span class="i">value</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="s">&#39;increment&#39;</span><span class="p">:</span> <span class="p">()</span> <span class="p">{</span>
      <span class="i">print</span><span class="p">(</span><span class="s">&#39;increment!&#39;</span><span class="p">);</span>
      <span class="i">counter</span><span class="p">[</span><span class="s">&#39;increment&#39;</span><span class="p">]();</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">makeCounter</span><span class="p">(</span><span class="i">receiver</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// Declare the instance state for the &quot;object&quot;.</span>
  <span class="k">var</span> <span class="i">count</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>

  <span class="c">// Declare the variables up front.</span>
  <span class="k">var</span> <span class="i">increment</span><span class="p">,</span> <span class="k">get</span><span class="p">,</span> <span class="k">set</span><span class="p">;</span>

  <span class="c">// Now that the names are all in scope,</span>
  <span class="c">// create the function bodies.</span>
  <span class="i">increment</span> <span class="o">=</span> <span class="p">()</span> <span class="p">{</span>
    <span class="i">receiver</span><span class="p">[</span><span class="s">&#39;set&#39;</span><span class="p">](</span><span class="i">receiver</span><span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]()</span> <span class="o">+</span> <span class="n">1</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="k">get</span> <span class="o">=</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">count</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="k">set</span> <span class="o">=</span> <span class="p">(</span><span class="i">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">count</span> <span class="o">=</span> <span class="i">value</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="c">// Add the methods to the receiver.</span>
  <span class="i">receiver</span><span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">get</span><span class="p">;</span>
  <span class="i">receiver</span><span class="p">[</span><span class="s">&#39;set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">set</span><span class="p">;</span>
  <span class="i">receiver</span><span class="p">[</span><span class="s">&#39;increment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="i">increment</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">makeLoggingCounter</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">// Create a blank object.</span>
  <span class="i">counter</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="c">// Turn it into a counter.</span>
  <span class="i">makeCounter</span><span class="p">(</span><span class="i">counter</span><span class="p">);</span>

  <span class="c">// Keep track of the original methods.</span>
  <span class="k">var</span> <span class="i">superGet</span> <span class="o">=</span> <span class="i">counter</span><span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">];</span>
  <span class="k">var</span> <span class="i">superSet</span> <span class="o">=</span> <span class="i">counter</span><span class="p">[</span><span class="s">&#39;set&#39;</span><span class="p">];</span>
  <span class="k">var</span> <span class="i">superIncrement</span> <span class="o">=</span> <span class="i">counter</span><span class="p">[</span><span class="s">&#39;increment&#39;</span><span class="p">];</span>

  <span class="c">// Override the methods.</span>
  <span class="i">counter</span><span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span> <span class="p">{</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&#39;get!&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="i">superGet</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="i">counter</span><span class="p">[</span><span class="s">&#39;set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="i">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&#39;set!&#39;</span><span class="p">);</span>
    <span class="i">superSet</span><span class="p">(</span><span class="i">value</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="i">counter</span><span class="p">[</span><span class="s">&#39;increment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span> <span class="p">{</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&#39;increment!&#39;</span><span class="p">);</span>
    <span class="i">superIncrement</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="i">counter</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>2013/12/08/babys-first-garbage-collector</h2>

<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
  <span class="r">OBJ_INT</span><span class="p">,</span>
  <span class="r">OBJ_PAIR</span>
<span class="p">}</span> <span class="t">ObjectType</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="i">sObject</span> <span class="p">{</span>
  <span class="t">ObjectType</span> <span class="i">type</span><span class="p">;</span>

  <span class="k">union</span> <span class="p">{</span>
    <span class="c">/* OBJ_INT */</span>
    <span class="t">int</span> <span class="i">value</span><span class="p">;</span>

    <span class="c">/* OBJ_PAIR */</span>
    <span class="k">struct</span> <span class="p">{</span>
      <span class="k">struct</span> <span class="i">sObject</span><span class="o">*</span> <span class="i">head</span><span class="p">;</span>
      <span class="k">struct</span> <span class="i">sObject</span><span class="o">*</span> <span class="i">tail</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span> <span class="t">Object</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="r">#define STACK_MAX 256</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="t">Object</span><span class="o">*</span> <span class="i">stack</span><span class="p">[</span><span class="r">STACK_MAX</span><span class="p">];</span>
  <span class="t">int</span> <span class="i">stackSize</span><span class="p">;</span>
<span class="p">}</span> <span class="t">VM</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">VM</span><span class="o">*</span> <span class="i">newVM</span><span class="p">()</span> <span class="p">{</span>
  <span class="t">VM</span><span class="o">*</span> <span class="i">vm</span> <span class="o">=</span> <span class="i">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="t">VM</span><span class="p">));</span>
  <span class="i">vm</span><span class="o">-&gt;</span><span class="i">stackSize</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="i">vm</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">push</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">,</span> <span class="t">Object</span><span class="o">*</span> <span class="i">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">assert</span><span class="p">(</span><span class="i">vm</span><span class="o">-&gt;</span><span class="i">stackSize</span> <span class="o">&lt;</span> <span class="r">STACK_MAX</span><span class="p">,</span> <span class="s">&quot;Stack overflow!&quot;</span><span class="p">);</span>
  <span class="i">vm</span><span class="o">-&gt;</span><span class="i">stack</span><span class="p">[</span><span class="i">vm</span><span class="o">-&gt;</span><span class="i">stackSize</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="i">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="t">Object</span><span class="o">*</span> <span class="i">pop</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">assert</span><span class="p">(</span><span class="i">vm</span><span class="o">-&gt;</span><span class="i">stackSize</span> <span class="o">&gt;</span> <span class="n">0</span><span class="p">,</span> <span class="s">&quot;Stack underflow!&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="i">vm</span><span class="o">-&gt;</span><span class="i">stack</span><span class="p">[</span><span class="o">--</span><span class="i">vm</span><span class="o">-&gt;</span><span class="i">stackSize</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">Object</span><span class="o">*</span> <span class="i">newObject</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">,</span> <span class="t">ObjectType</span> <span class="i">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">Object</span><span class="o">*</span> <span class="i">object</span> <span class="o">=</span> <span class="i">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="t">Object</span><span class="p">));</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">type</span> <span class="o">=</span> <span class="i">type</span><span class="p">;</span>
  <span class="k">return</span> <span class="i">object</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">pushInt</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">,</span> <span class="t">int</span> <span class="i">intValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">Object</span><span class="o">*</span> <span class="i">object</span> <span class="o">=</span> <span class="i">newObject</span><span class="p">(</span><span class="i">vm</span><span class="p">,</span> <span class="r">OBJ_INT</span><span class="p">);</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">value</span> <span class="o">=</span> <span class="i">intValue</span><span class="p">;</span>
  <span class="i">push</span><span class="p">(</span><span class="i">vm</span><span class="p">,</span> <span class="i">object</span><span class="p">);</span>
<span class="p">}</span>

<span class="t">Object</span><span class="o">*</span> <span class="i">pushPair</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">Object</span><span class="o">*</span> <span class="i">object</span> <span class="o">=</span> <span class="i">newObject</span><span class="p">(</span><span class="i">vm</span><span class="p">,</span> <span class="r">OBJ_PAIR</span><span class="p">);</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">tail</span> <span class="o">=</span> <span class="i">pop</span><span class="p">(</span><span class="i">vm</span><span class="p">);</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">head</span> <span class="o">=</span> <span class="i">pop</span><span class="p">(</span><span class="i">vm</span><span class="p">);</span>

  <span class="i">push</span><span class="p">(</span><span class="i">vm</span><span class="p">,</span> <span class="i">object</span><span class="p">);</span>
  <span class="k">return</span> <span class="i">object</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="i">sObject</span> <span class="p">{</span>
  <span class="i">unsigned</span> <span class="t">char</span> <span class="i">marked</span><span class="p">;</span>
  <span class="c">/* Previous stuff... */</span>
<span class="p">}</span> <span class="t">Object</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">markAll</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="t">int</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">i</span> <span class="o">&lt;</span> <span class="i">vm</span><span class="o">-&gt;</span><span class="i">stackSize</span><span class="p">;</span> <span class="i">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">mark</span><span class="p">(</span><span class="i">vm</span><span class="o">-&gt;</span><span class="i">stack</span><span class="p">[</span><span class="i">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">mark</span><span class="p">(</span><span class="t">Object</span><span class="o">*</span> <span class="i">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">marked</span> <span class="o">=</span> <span class="n">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">mark</span><span class="p">(</span><span class="t">Object</span><span class="o">*</span> <span class="i">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">marked</span> <span class="o">=</span> <span class="n">1</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="i">object</span><span class="o">-&gt;</span><span class="i">type</span> <span class="o">==</span> <span class="r">OBJ_PAIR</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">mark</span><span class="p">(</span><span class="i">object</span><span class="o">-&gt;</span><span class="i">head</span><span class="p">);</span>
    <span class="i">mark</span><span class="p">(</span><span class="i">object</span><span class="o">-&gt;</span><span class="i">tail</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">mark</span><span class="p">(</span><span class="t">Object</span><span class="o">*</span> <span class="i">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">/* If already marked, we&#39;re done. Check this first
     to avoid recursing on cycles in the object graph. */</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">object</span><span class="o">-&gt;</span><span class="i">marked</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="i">object</span><span class="o">-&gt;</span><span class="i">marked</span> <span class="o">=</span> <span class="n">1</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="i">object</span><span class="o">-&gt;</span><span class="i">type</span> <span class="o">==</span> <span class="r">OBJ_PAIR</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">mark</span><span class="p">(</span><span class="i">object</span><span class="o">-&gt;</span><span class="i">head</span><span class="p">);</span>
    <span class="i">mark</span><span class="p">(</span><span class="i">object</span><span class="o">-&gt;</span><span class="i">tail</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="i">sObject</span> <span class="p">{</span>
  <span class="c">/* The next object in the list of all objects. */</span>
  <span class="k">struct</span> <span class="i">sObject</span><span class="o">*</span> <span class="i">next</span><span class="p">;</span>

  <span class="c">/* Previous stuff... */</span>
<span class="p">}</span> <span class="t">Object</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="c">/* The first object in the list of all objects. */</span>
  <span class="t">Object</span><span class="o">*</span> <span class="i">firstObject</span><span class="p">;</span>

  <span class="c">/* Previous stuff... */</span>
<span class="p">}</span> <span class="t">VM</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">Object</span><span class="o">*</span> <span class="i">newObject</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">,</span> <span class="t">ObjectType</span> <span class="i">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">Object</span><span class="o">*</span> <span class="i">object</span> <span class="o">=</span> <span class="i">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="t">Object</span><span class="p">));</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">type</span> <span class="o">=</span> <span class="i">type</span><span class="p">;</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">marked</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>

  <span class="c">/* Insert it into the list of allocated objects. */</span>
  <span class="i">object</span><span class="o">-&gt;</span><span class="i">next</span> <span class="o">=</span> <span class="i">vm</span><span class="o">-&gt;</span><span class="i">firstObject</span><span class="p">;</span>
  <span class="i">vm</span><span class="o">-&gt;</span><span class="i">firstObject</span> <span class="o">=</span> <span class="i">object</span><span class="p">;</span>

  <span class="k">return</span> <span class="i">object</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">sweep</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="t">Object</span><span class="o">**</span> <span class="i">object</span> <span class="o">=</span> <span class="o">&amp;</span><span class="i">vm</span><span class="o">-&gt;</span><span class="i">firstObject</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="i">object</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="i">object</span><span class="p">)</span><span class="o">-&gt;</span><span class="i">marked</span><span class="p">)</span> <span class="p">{</span>
      <span class="c">/* This object wasn&#39;t reached, so remove it from the list
         and free it. */</span>
      <span class="t">Object</span><span class="o">*</span> <span class="i">unreached</span> <span class="o">=</span> <span class="o">*</span><span class="i">object</span><span class="p">;</span>

      <span class="o">*</span><span class="i">object</span> <span class="o">=</span> <span class="i">unreached</span><span class="o">-&gt;</span><span class="i">next</span><span class="p">;</span>
      <span class="i">free</span><span class="p">(</span><span class="i">unreached</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c">/* This object was reached, so unmark it (for the next GC)
         and move on to the next. */</span>
      <span class="p">(</span><span class="o">*</span><span class="i">object</span><span class="p">)</span><span class="o">-&gt;</span><span class="i">marked</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
      <span class="i">object</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="o">*</span><span class="i">object</span><span class="p">)</span><span class="o">-&gt;</span><span class="i">next</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">gc</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">markAll</span><span class="p">(</span><span class="i">vm</span><span class="p">);</span>
  <span class="i">sweep</span><span class="p">(</span><span class="i">vm</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="c">/* The total number of currently allocated objects. */</span>
  <span class="t">int</span> <span class="i">numObjects</span><span class="p">;</span>

  <span class="c">/* The number of objects required to trigger a GC. */</span>
  <span class="t">int</span> <span class="i">maxObjects</span><span class="p">;</span>

  <span class="c">/* Previous stuff... */</span>
<span class="p">}</span> <span class="t">VM</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">VM</span><span class="o">*</span> <span class="i">newVM</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">/* Previous stuff... */</span>

  <span class="i">vm</span><span class="o">-&gt;</span><span class="i">numObjects</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
  <span class="i">vm</span><span class="o">-&gt;</span><span class="i">maxObjects</span> <span class="o">=</span> <span class="r">INITIAL_GC_THRESHOLD</span><span class="p">;</span>
  <span class="k">return</span> <span class="i">vm</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">Object</span><span class="o">*</span> <span class="i">newObject</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">,</span> <span class="t">ObjectType</span> <span class="i">type</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">vm</span><span class="o">-&gt;</span><span class="i">numObjects</span> <span class="o">==</span> <span class="i">vm</span><span class="o">-&gt;</span><span class="i">maxObjects</span><span class="p">)</span> <span class="i">gc</span><span class="p">(</span><span class="i">vm</span><span class="p">);</span>

  <span class="c">/* Create object... */</span>

  <span class="i">vm</span><span class="o">-&gt;</span><span class="i">numObjects</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="i">object</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">void</span> <span class="i">gc</span><span class="p">(</span><span class="t">VM</span><span class="o">*</span> <span class="i">vm</span><span class="p">)</span> <span class="p">{</span>
  <span class="t">int</span> <span class="i">numObjects</span> <span class="o">=</span> <span class="i">vm</span><span class="o">-&gt;</span><span class="i">numObjects</span><span class="p">;</span>

  <span class="i">markAll</span><span class="p">(</span><span class="i">vm</span><span class="p">);</span>
  <span class="i">sweep</span><span class="p">(</span><span class="i">vm</span><span class="p">);</span>

  <span class="i">vm</span><span class="o">-&gt;</span><span class="i">maxObjects</span> <span class="o">=</span> <span class="i">vm</span><span class="o">-&gt;</span><span class="i">numObjects</span> <span class="o">*</span> <span class="n">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>2014/04/22/zero-to-95688-how-i-wrote-game-programming-patterns</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>- old programs used to be batch: ran and quit
- then came interactive programs. these ran forever,
  which meant loop
- if you write gui app, the os has event loop
  - you receive ui event, handle it, and return to event loop
  - js is a great example
  - you don&#39;t see loop, but it&#39;s there
  - when app isn&#39;t handle user input, it isn&#39;t doing
    anything, just sitting there
  - this can work for simple games (minesweeper, solitaire)</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>To create a ghost spawner, we just create a prototypical ghost
instance, and then create a spawner holding that prototype:

^code spawn-ghost-clone

One neat part about this pattern is that it doesn&#39;t just clone
the *class* of the prototype, it clones its *state* too...
</code></pre></div>
<p>cpp</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span></span><span class="t">void</span> <span class="i">test</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c">//^spawn-ghost-clone</span>
  <span class="t">Monster</span><span class="o">*</span> <span class="i">ghostPrototype</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Ghost</span><span class="p">(</span><span class="n">15</span><span class="p">,</span> <span class="n">3</span><span class="p">);</span>
  <span class="t">Spawner</span><span class="o">*</span> <span class="i">ghostSpawner</span> <span class="o">=</span> <span class="k">new</span> <span class="t">Spawner</span><span class="p">(</span><span class="i">ghostPrototype</span><span class="p">);</span>
  <span class="c">//^spawn-ghost-clone</span>
  <span class="i">use</span><span class="p">(</span><span class="i">ghostSpawner</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>2013-06-18 - Finish third draft of Game Loop
2013-06-17 - 1,280 words revised in third draft of Game Loop
2013-06-16 - ~1,000 words revised in third draft of Game Loop
2013-06-15 - Finish second draft of Game Loop
2013-06-14 - Revise couple of paragraphs of Game Loop
2013-06-13 - Revise ~500 words of second draft of Game Loop
2013-06-12 - Revise ~900 words of second draft of Game Loop
2013-06-11 - Finish first draft of Game Loop
2013-06-10 - 489 words on first draft of Game Loop
2013-06-09 - 178 words on first draft of Game Loop
2013-06-08 - 889 words on first draft of Game Loop
2013-06-07 - 777 words on first draft of Game Loop
</code></pre></div>
<h2>2014/07/05/dropping-loot</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>The Novice mage  (Red &#39;p&#39;)
=== Num:38  Lev:2  Rar:1  Spd:+0  Hp:6d4  Ac:6  Exp:6
He is leaving behind a trail of dropped spell components.</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>dwarf miner
    color     = DarkGray
    depth     = 22
    health    = 44
    attacks
        hammers = 15t5
    description
        Covered from head to toe is dust and dirt, you can barely
        make out the form of this weary dwarf.</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>drops
    hammer (50%)</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>drops
    hammer (50%)
    amethyst (10%)
    sapphire (7%)
    emerald (4%)
    ruby (3%)
    diamond (2%)
    blue diamond (1%)</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>drops
    amethyst (3%)
    sapphire (5%)
    emerald (8%)
    ruby (10%)
    diamond (8%)
    blue diamond (5%)</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>(gem)
    hammer (50%)
    amethyst (10%)
    sapphire (7%)
    emerald (4%)
    ruby (3%)
    diamond (2%)
    blue diamond (1%)</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>drops
    (gem)</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>(gem)
    one near level
        amethyst (23)
        sapphire (38)
        emerald (52)
        ruby (62)
        diamond (87)
        blue diamond (95)
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">breed</span><span class="p">(</span><span class="s">&quot;goblin peon&quot;</span><span class="p">,</span> <span class="i">lightBrown</span><span class="p">,</span> <span class="n">16</span><span class="p">,</span> <span class="p">[</span>
  <span class="i">attack</span><span class="p">(</span><span class="s">&quot;stab[s]&quot;</span><span class="p">,</span> <span class="n">6</span><span class="p">)</span>
<span class="p">],</span> <span class="i">drop</span><span class="p">:</span> <span class="p">[</span>
  <span class="i">chanceOf</span><span class="p">(</span><span class="n">10</span><span class="p">,</span> <span class="s">&quot;Spear&quot;</span><span class="p">)</span>
<span class="p">]);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">breed</span><span class="p">(</span><span class="s">&quot;goblin peon&quot;</span><span class="p">,</span> <span class="i">lightBrown</span><span class="p">,</span> <span class="n">16</span><span class="p">,</span> <span class="p">[</span>
  <span class="i">attack</span><span class="p">(</span><span class="s">&quot;stab[s]&quot;</span><span class="p">,</span> <span class="n">6</span><span class="p">)</span>
<span class="p">],</span> <span class="i">drop</span><span class="p">:</span> <span class="p">[</span>
  <span class="i">chanceOf</span><span class="p">(</span><span class="n">10</span><span class="p">,</span> <span class="s">&quot;spear:3&quot;</span><span class="p">),</span>
  <span class="i">chanceOf</span><span class="p">(</span><span class="n">5</span><span class="p">,</span> <span class="s">&quot;healing:2&quot;</span><span class="p">),</span>
<span class="p">],</span> <span class="i">meander</span><span class="p">:</span> <span class="n">2</span><span class="p">,</span> <span class="i">flags</span><span class="p">:</span> <span class="s">&quot;few open-doors&quot;</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">breed</span><span class="p">(</span><span class="s">&quot;goblin warrior&quot;</span><span class="p">,</span> <span class="i">gray</span><span class="p">,</span> <span class="n">32</span><span class="p">,</span> <span class="p">[</span>
  <span class="i">attack</span><span class="p">(</span><span class="s">&quot;stab[s]&quot;</span><span class="p">,</span> <span class="n">14</span><span class="p">)</span>
<span class="p">],</span> <span class="i">drop</span><span class="p">:</span> <span class="p">[</span>
  <span class="i">chanceOf</span><span class="p">(</span><span class="n">20</span><span class="p">,</span> <span class="s">&quot;equipment:6&quot;</span><span class="p">)</span>
<span class="p">],</span> <span class="i">meander</span><span class="p">:</span> <span class="n">1</span><span class="p">,</span> <span class="i">flags</span><span class="p">:</span> <span class="s">&quot;protective open-doors&quot;</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">group</span><span class="p">(</span><span class="i">r</span><span class="s">&quot;</span><span class="e">\&quot;</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;equipment/weapon/spear&quot;</span><span class="p">);</span>
<span class="i">weapon</span><span class="p">(</span><span class="s">&quot;Pointed Stick&quot;</span><span class="p">,</span> <span class="n">5</span><span class="p">,</span> <span class="i">brown</span><span class="p">,</span> <span class="s">&quot;stab[s]&quot;</span><span class="p">,</span> <span class="n">7</span><span class="p">);</span>
<span class="i">weapon</span><span class="p">(</span><span class="s">&quot;Spear&quot;</span><span class="p">,</span> <span class="n">25</span><span class="p">,</span> <span class="i">gray</span><span class="p">,</span> <span class="s">&quot;stab[s]&quot;</span><span class="p">,</span> <span class="n">12</span><span class="p">);</span>
<span class="i">weapon</span><span class="p">(</span><span class="s">&quot;Angon&quot;</span><span class="p">,</span> <span class="n">35</span><span class="p">,</span> <span class="i">lightGray</span><span class="p">,</span> <span class="s">&quot;stab[s]&quot;</span><span class="p">,</span> <span class="n">16</span><span class="p">);</span>
<span class="i">weapon</span><span class="p">(</span><span class="s">&quot;Lance&quot;</span><span class="p">,</span> <span class="n">45</span><span class="p">,</span> <span class="i">white</span><span class="p">,</span> <span class="s">&quot;stab[s]&quot;</span><span class="p">,</span> <span class="n">24</span><span class="p">);</span>
<span class="i">weapon</span><span class="p">(</span><span class="s">&quot;Partisan&quot;</span><span class="p">,</span> <span class="n">55</span><span class="p">,</span> <span class="i">darkGray</span><span class="p">,</span> <span class="s">&quot;stab[s]&quot;</span><span class="p">,</span> <span class="n">36</span><span class="p">);</span>
</code></pre></div>
<h2>2014/07/15/a-turn-based-game-loop</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">gameLoop</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="i">stillPlaying</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">actor</span> <span class="k">in</span> <span class="i">actors</span><span class="p">)</span> <span class="p">{</span>
      <span class="i">actor</span><span class="p">.</span><span class="i">update</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Game</span> <span class="p">{</span>
  <span class="k">final</span> <span class="i">actors</span> <span class="o">=</span> <span class="o">&lt;</span><span class="t">Actor</span><span class="o">&gt;</span><span class="p">[];</span>
  <span class="t">int</span> <span class="i">_currentActor</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>

  <span class="k">void</span> <span class="i">process</span><span class="p">()</span> <span class="p">{</span>
    <span class="i">actors</span><span class="p">[</span><span class="i">_currentActor</span><span class="p">].</span><span class="i">update</span><span class="p">();</span>
    <span class="i">_currentActor</span> <span class="o">=</span> <span class="p">(</span><span class="i">_currentActor</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span> <span class="o">%</span> <span class="i">actors</span><span class="p">.</span><span class="i">length</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">process</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">action</span> <span class="o">=</span> <span class="i">actors</span><span class="p">[</span><span class="i">_currentActor</span><span class="p">].</span><span class="i">getAction</span><span class="p">();</span>
  <span class="i">action</span><span class="p">.</span><span class="i">perform</span><span class="p">();</span>
  <span class="i">_currentActor</span> <span class="o">=</span> <span class="p">(</span><span class="i">_currentActor</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span> <span class="o">%</span> <span class="i">actors</span><span class="p">.</span><span class="i">length</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">handleInput</span><span class="p">(</span><span class="t">Keyboard</span> <span class="i">keyboard</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="i">keyboard</span><span class="p">.</span><span class="i">lastPressed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">G</span><span class="p">:</span>
      <span class="i">game</span><span class="p">.</span><span class="i">hero</span><span class="p">.</span><span class="i">setNextAction</span><span class="p">(</span><span class="k">new</span> <span class="t">PickUpAction</span><span class="p">())</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">I</span><span class="p">:</span>         <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">NW</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">O</span><span class="p">:</span>         <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">N</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">P</span><span class="p">:</span>         <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">NE</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">K</span><span class="p">:</span>         <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">W</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">L</span><span class="p">:</span>         <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">NONE</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">SEMICOLON</span><span class="p">:</span> <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">E</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">COMMA</span><span class="p">:</span>     <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">SW</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">PERIOD</span><span class="p">:</span>    <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">S</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="t">KeyCode</span><span class="p">.</span><span class="t">SLASH</span><span class="p">:</span>     <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span><span class="p">.</span><span class="t">SE</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">void</span> <span class="i">walk</span><span class="p">(</span><span class="t">Direction</span> <span class="i">dir</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">game</span><span class="p">.</span><span class="i">hero</span><span class="p">.</span><span class="i">setNextAction</span><span class="p">(</span><span class="k">new</span> <span class="t">WalkAction</span><span class="p">(</span><span class="i">dir</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Hero</span> <span class="k">extends</span> <span class="t">Actor</span> <span class="p">{</span>
  <span class="t">Action</span> <span class="i">_nextAction</span><span class="p">;</span>

  <span class="k">void</span> <span class="i">setNextAction</span><span class="p">(</span><span class="t">Action</span> <span class="i">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">_nextAction</span> <span class="o">=</span> <span class="i">action</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="t">Action</span> <span class="i">getAction</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="i">action</span> <span class="o">=</span> <span class="i">_nextAction</span><span class="p">;</span>
    <span class="c">// Only perform it once.</span>
    <span class="i">_nextAction</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">return</span> <span class="i">action</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c">// Other heroic stuff...</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">process</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">action</span> <span class="o">=</span> <span class="i">actors</span><span class="p">[</span><span class="i">_currentActor</span><span class="p">].</span><span class="i">getAction</span><span class="p">();</span>

  <span class="c">// Don&#39;t advance past the actor if it didn&#39;t take a turn.</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">action</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="i">action</span><span class="p">.</span><span class="i">perform</span><span class="p">();</span>
  <span class="i">_currentActor</span> <span class="o">=</span> <span class="p">(</span><span class="i">_currentActor</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span> <span class="o">%</span> <span class="i">actors</span><span class="p">.</span><span class="i">length</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">process</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">action</span> <span class="o">=</span> <span class="i">actors</span><span class="p">[</span><span class="i">_currentActor</span><span class="p">].</span><span class="i">getAction</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">action</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">var</span> <span class="i">success</span> <span class="o">=</span> <span class="i">action</span><span class="p">.</span><span class="i">perform</span><span class="p">();</span>

  <span class="c">// Don&#39;t advance if the action failed.</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="i">success</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="i">_currentActor</span> <span class="o">=</span> <span class="p">(</span><span class="i">_currentActor</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span> <span class="o">%</span> <span class="i">actors</span><span class="p">.</span><span class="i">length</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">ActionResult</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="i">success</span> <span class="o">=</span> <span class="t">ActionResult</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
  <span class="k">static</span> <span class="k">const</span> <span class="i">failure</span> <span class="o">=</span> <span class="t">ActionResult</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

  <span class="c">/// An alternate [Action] that should be performed instead of</span>
  <span class="c">/// the one that failed.</span>
  <span class="k">final</span> <span class="t">Action</span> <span class="i">alternative</span><span class="p">;</span>

  <span class="c">/// `true` if the [Action] was successful and energy should</span>
  <span class="c">/// be consumed.</span>
  <span class="k">final</span> <span class="t">bool</span> <span class="i">succeeded</span><span class="p">;</span>

  <span class="k">const</span> <span class="t">ActionResult</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">succeeded</span><span class="p">)</span>
  <span class="p">:</span> <span class="i">alternative</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

  <span class="k">const</span> <span class="t">ActionResult</span><span class="p">.</span><span class="i">alternate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">alternative</span><span class="p">)</span>
  <span class="p">:</span> <span class="i">succeeded</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">process</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">action</span> <span class="o">=</span> <span class="i">actors</span><span class="p">[</span><span class="i">_currentActor</span><span class="p">].</span><span class="i">getAction</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">action</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="i">action</span><span class="p">.</span><span class="i">perform</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="i">result</span><span class="p">.</span><span class="i">succeeded</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">result</span><span class="p">.</span><span class="i">alternate</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="i">action</span> <span class="o">=</span> <span class="i">result</span><span class="p">.</span><span class="i">alternate</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="i">_currentActor</span> <span class="o">=</span> <span class="p">(</span><span class="i">_currentActor</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span> <span class="o">%</span> <span class="i">actors</span><span class="p">.</span><span class="i">length</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>2014/11/03/bringing-my-web-book-to-print-and-ebook</h2>

<p>sh</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">cd my_awesome_site
zip -X0 my_awesome_site.epub mimetype
zip -Xur9D my_awesome_site.epub *
</code></pre></div>
<p>xml</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="g">&lt;navPoint</span> <span class="f">id</span><span class="o">=</span><span class="s">&quot;copyright&quot;</span> <span class="f">playOrder</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="g">&gt;</span>
  <span class="g">&lt;navLabel&gt;&lt;text&gt;</span>Copyright<span class="g">&lt;/text&gt;&lt;/navLabel&gt;</span>
  <span class="g">&lt;content</span> <span class="f">src</span><span class="o">=</span><span class="s">&quot;copyright.html&quot;</span> <span class="g">/&gt;</span>
<span class="g">&lt;/navPoint&gt;</span>

<span class="g">&lt;navPoint</span> <span class="f">id</span><span class="o">=</span><span class="s">&quot;acknowledgements&quot;</span> <span class="f">playOrder</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="g">&gt;</span>
  <span class="g">&lt;navLabel&gt;&lt;text&gt;</span>Acknowledgements<span class="g">&lt;/text&gt;&lt;/navLabel&gt;</span>
  <span class="g">&lt;content</span> <span class="f">src</span><span class="o">=</span><span class="s">&quot;acknowledgements.html&quot;</span> <span class="g">/&gt;</span>
<span class="g">&lt;/navPoint&gt;</span>

<span class="g">&lt;navPoint</span> <span class="f">id</span><span class="o">=</span><span class="s">&quot;dedication&quot;</span> <span class="f">playOrder</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="g">&gt;</span>
  <span class="g">&lt;navLabel&gt;&lt;text&gt;</span>Dedication<span class="g">&lt;/text&gt;&lt;/navLabel&gt;</span>
  <span class="g">&lt;content</span> <span class="f">src</span><span class="o">=</span><span class="s">&quot;dedication.html&quot;</span> <span class="g">/&gt;</span>
<span class="g">&lt;/navPoint&gt;</span>
</code></pre></div>
<p>python</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="i">clean_up_code_xml</span><span class="p">(</span><span class="i">code</span><span class="p">):</span>
  <span class="c"># Ditch most code formatting tags.</span>
  <span class="i">code</span> <span class="o">=</span> <span class="i">re</span><span class="p">.</span><span class="i">sub</span><span class="p">(</span><span class="s">r&#39;&lt;span class=&quot;(k|kt|mi|n|nb|nc|nf)&quot;&gt;([^&lt;]+)&lt;/span&gt;&#39;</span><span class="p">,</span>
                <span class="s">r&quot;\2&quot;</span><span class="p">,</span> <span class="i">code</span><span class="p">)</span>

  <span class="c"># Turn comments into something InDesign can map to a style.</span>
  <span class="i">code</span> <span class="o">=</span> <span class="i">re</span><span class="p">.</span><span class="i">sub</span><span class="p">(</span><span class="s">r&#39;&lt;span class=&quot;(c1|cn)&quot;&gt;([^&lt;]+)&lt;/span&gt;&#39;</span><span class="p">,</span>
                <span class="s">r&quot;&lt;comment&gt;\2&lt;/comment&gt;&quot;</span><span class="p">,</span> <span class="i">code</span><span class="p">)</span>
</code></pre></div>
<p>python</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="i">clean_up_xhtml</span><span class="p">(</span><span class="i">html</span><span class="p">):</span>
  <span class="c"># Ditch newlines in the middle of blocks of text. Out of sheer</span>
  <span class="c"># malice, even though they are meaningless in actual XML, InDesign</span>
  <span class="c"># treats them as significant.</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">re</span><span class="p">.</span><span class="i">sub</span><span class="p">(</span><span class="s">r&quot;\n(?&lt;!&lt;)&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="i">html</span><span class="p">)</span>

  <span class="c"># Also collapse redundant whitespace.</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">re</span><span class="p">.</span><span class="i">sub</span><span class="p">(</span><span class="s">r&quot; +&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="i">html</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&gt; &lt;&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;&lt;&quot;</span><span class="p">)</span>

  <span class="c"># Re-add newlines after closing paragraph-level tags.</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/p&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/p&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/h2&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/h2&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/h3&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/h3&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/li&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/li&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/ol&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/ol&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/ul&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/ul&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/pre&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/pre&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/aside&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/aside&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="i">html</span> <span class="o">=</span> <span class="i">html</span><span class="p">.</span><span class="i">replace</span><span class="p">(</span><span class="s">&quot;&lt;/blockquote&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;/blockquote&gt;</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">)</span>

  <span class="k">return</span> <span class="i">html</span>
</code></pre></div>
<h2>2014/12/21/rooms-and-mazes</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">if</span> <span class="p">(</span><span class="i">rng</span><span class="p">.</span><span class="i">oneIn</span><span class="p">(</span><span class="n">50</span><span class="p">))</span> <span class="i">_carve</span><span class="p">(</span><span class="i">pos</span><span class="p">,</span> <span class="i">CELL_DOOR</span><span class="p">);</span>
</code></pre></div>
<h2>2015/02/01/what-color-is-your-function</h2>

<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">function</span> <span class="i">thisIsAFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s">&quot;It&#39;s awesome&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c">// Return a list containing all of the elements in collection</span>
<span class="c">// that match predicate.</span>
<span class="k">function</span> <span class="i">filter</span><span class="p">(</span><span class="i">collection</span><span class="p">,</span> <span class="i">predicate</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">result</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">i</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">i</span> <span class="o">&lt;</span> <span class="i">collection</span><span class="p">.</span><span class="i">length</span><span class="p">;</span> <span class="i">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">predicate</span><span class="p">(</span><span class="i">collection</span><span class="p">[</span><span class="i">i</span><span class="p">]))</span> <span class="i">result</span><span class="p">.</span><span class="i">push</span><span class="p">(</span><span class="i">collection</span><span class="p">[</span><span class="i">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="i">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="i">describe</span><span class="p">(</span><span class="s">&quot;An apple&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="i">it</span><span class="p">(</span><span class="s">&quot;ain&#39;t no orange&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="i">expect</span><span class="p">(</span><span class="s">&quot;Apple&quot;</span><span class="p">).</span><span class="i">not</span><span class="p">.</span><span class="i">toBe</span><span class="p">(</span><span class="s">&quot;Orange&quot;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="i">tokens</span><span class="p">.</span><span class="i">match</span><span class="p">(</span><span class="t">Token</span><span class="p">.</span><span class="i">LEFT_BRACKET</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="i">token</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// Parse a list literal...</span>
  <span class="i">tokens</span><span class="p">.</span><span class="i">consume</span><span class="p">(</span><span class="t">Token</span><span class="p">.</span><span class="i">RIGHT_BRACKET</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="blue">blue_function</span> <span class="i">doSomethingAzure</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">// This is a blue function...</span>
<span class="p">}</span>

<span class="red">red_function</span> <span class="i">doSomethingCarnelian</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">// This is a red function...</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="i">doSomethingAzure</span><span class="blue">()blue</span><span class="p">;</span>
<span class="i">doSomethingCarnelian</span><span class="red">()red</span><span class="p">;</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="red">red_function</span> <span class="i">doSomethingCarnelian</span><span class="p">()</span> <span class="p">{</span>
  <span class="i">doSomethingAzure</span><span class="blue">()blue</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="blue">blue_function</span> <span class="i">doSomethingAzure</span><span class="p">()</span> <span class="p">{</span>
  <span class="i">doSomethingCarnelian</span><span class="red">()red</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>javascript</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">function</span> <span class="i">makeSundae</span><span class="p">(</span><span class="i">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">scoopIceCream</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="i">iceCream</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">warmUpCaramel</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="i">caramel</span><span class="p">)</span> <span class="p">{</span>
      <span class="i">callback</span><span class="p">(</span><span class="i">pourOnIceCream</span><span class="p">(</span><span class="i">iceCream</span><span class="p">,</span> <span class="i">caramel</span><span class="p">));</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<h2>2015/09/07/what-the-hero-sees</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">row</span> <span class="o">=</span> <span class="n">1</span><span class="p">;</span> <span class="i">row</span> <span class="o">&lt;</span> <span class="i">maxDistance</span><span class="p">;</span> <span class="i">row</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">col</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">col</span> <span class="o">&lt;=</span> <span class="i">row</span><span class="p">;</span> <span class="i">col</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="i">x</span> <span class="o">=</span> <span class="i">hero</span><span class="p">.</span><span class="i">x</span> <span class="o">+</span> <span class="i">col</span><span class="p">;</span>
    <span class="k">var</span> <span class="i">y</span> <span class="o">=</span> <span class="i">hero</span><span class="p">.</span><span class="i">y</span> <span class="o">-</span> <span class="i">row</span><span class="p">;</span>

    <span class="i">paint</span><span class="p">(</span><span class="i">x</span><span class="p">,</span> <span class="i">y</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="t">Vec</span> <span class="i">transformOctant</span><span class="p">(</span><span class="t">int</span> <span class="i">row</span><span class="p">,</span> <span class="t">int</span> <span class="i">col</span><span class="p">,</span> <span class="t">int</span> <span class="i">octant</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="i">octant</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">0</span><span class="p">:</span> <span class="k">return</span> <span class="t">Vec</span><span class="p">(</span> <span class="i">col</span><span class="p">,</span> <span class="o">-</span><span class="i">row</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">1</span><span class="p">:</span> <span class="k">return</span> <span class="t">Vec</span><span class="p">(</span> <span class="i">row</span><span class="p">,</span> <span class="o">-</span><span class="i">col</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">2</span><span class="p">:</span> <span class="k">return</span> <span class="t">Vec</span><span class="p">(</span> <span class="i">row</span><span class="p">,</span>  <span class="i">col</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">3</span><span class="p">:</span> <span class="k">return</span> <span class="t">Vec</span><span class="p">(</span> <span class="i">col</span><span class="p">,</span>  <span class="i">row</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">4</span><span class="p">:</span> <span class="k">return</span> <span class="t">Vec</span><span class="p">(</span><span class="o">-</span><span class="i">col</span><span class="p">,</span>  <span class="i">row</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">5</span><span class="p">:</span> <span class="k">return</span> <span class="t">Vec</span><span class="p">(</span><span class="o">-</span><span class="i">row</span><span class="p">,</span>  <span class="i">col</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">6</span><span class="p">:</span> <span class="k">return</span> <span class="t">Vec</span><span class="p">(</span><span class="o">-</span><span class="i">row</span><span class="p">,</span> <span class="o">-</span><span class="i">col</span><span class="p">);</span>
    <span class="k">case</span> <span class="n">7</span><span class="p">:</span> <span class="k">return</span> <span class="t">Vec</span><span class="p">(</span><span class="o">-</span><span class="i">col</span><span class="p">,</span> <span class="o">-</span><span class="i">row</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">ShadowLine</span> <span class="p">{</span>
  <span class="k">final</span> <span class="t">List</span><span class="o">&lt;</span><span class="t">Shadow</span><span class="o">&gt;</span> <span class="i">_shadows</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">}</span>

<span class="k">class</span> <span class="t">Shadow</span> <span class="p">{</span>
  <span class="t">num</span> <span class="i">start</span><span class="p">;</span>
  <span class="t">num</span> <span class="i">end</span><span class="p">;</span>

  <span class="t">Shadow</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">start</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="i">end</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">/// Creates a [Shadow] that corresponds to the projected</span>
<span class="c">/// silhouette of the tile at [row], [col].</span>
<span class="t">Shadow</span> <span class="i">projectTile</span><span class="p">(</span><span class="t">int</span> <span class="i">row</span><span class="p">,</span> <span class="t">int</span> <span class="i">col</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">topLeft</span> <span class="o">=</span> <span class="i">col</span> <span class="o">/</span> <span class="p">(</span><span class="i">row</span> <span class="o">+</span> <span class="n">2</span><span class="p">);</span>
  <span class="k">var</span> <span class="i">bottomRight</span> <span class="o">=</span> <span class="p">(</span><span class="i">col</span> <span class="o">+</span> <span class="n">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="i">row</span> <span class="o">+</span> <span class="n">1</span><span class="p">);</span>
  <span class="k">return</span> <span class="t">Shadow</span><span class="p">(</span><span class="i">topLeft</span><span class="p">,</span> <span class="i">bottomRight</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Shadow</span> <span class="p">{</span>
  <span class="c">/// Returns `true` if [other] is completely covered by this shadow.</span>
  <span class="t">bool</span> <span class="i">contains</span><span class="p">(</span><span class="t">Shadow</span> <span class="i">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">start</span> <span class="o">&lt;=</span> <span class="i">other</span><span class="p">.</span><span class="i">start</span> <span class="o">&amp;&amp;</span> <span class="i">end</span> <span class="o">&gt;=</span> <span class="i">other</span><span class="p">.</span><span class="i">end</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">ShadowLine</span> <span class="p">{</span>
  <span class="t">bool</span> <span class="i">isInShadow</span><span class="p">(</span><span class="t">Shadow</span> <span class="i">projection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">shadow</span> <span class="k">in</span> <span class="i">_shadows</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">shadow</span><span class="p">.</span><span class="i">contains</span><span class="p">(</span><span class="i">projection</span><span class="p">))</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">col</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">col</span> <span class="o">&lt;=</span> <span class="i">row</span><span class="p">;</span> <span class="i">col</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">projection</span> <span class="o">=</span> <span class="i">_projectTile</span><span class="p">(</span><span class="i">row</span><span class="p">,</span> <span class="i">col</span><span class="p">);</span>
  <span class="k">var</span> <span class="i">pos</span> <span class="o">=</span> <span class="i">start</span> <span class="o">+</span> <span class="i">transformOctant</span><span class="p">(</span><span class="i">row</span><span class="p">,</span> <span class="i">col</span><span class="p">,</span> <span class="i">octant</span><span class="p">);</span>
  <span class="i">tiles</span><span class="p">[</span><span class="i">pos</span><span class="p">].</span><span class="i">isVisible</span> <span class="o">=</span> <span class="o">!</span><span class="i">line</span><span class="p">.</span><span class="i">isInShadow</span><span class="p">(</span><span class="i">projection</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>old:    ..[======]..
new:    ....[===]...
        ------------
result: ..[======]..</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>old:    [=].....[==]
new:    ....[=].....
        ------------
result: [=].[=].[==]</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>old:    [===]....[=]
new:    ...[===]....
        ------------
result: [======].[=]</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>old:    [=]....[===]
new:    ....[===]...
        ------------
result: [=].[======]</code></pre></div>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>old:    ..[=]..[==].
new:    ...[====]...
        ------------
result: ..[=======].
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">ShadowLine</span> <span class="p">{</span>
  <span class="k">void</span> <span class="i">add</span><span class="p">(</span><span class="t">Shadow</span> <span class="i">shadow</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// Figure out where to slot the new shadow in the list.</span>
    <span class="k">var</span> <span class="i">index</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="i">index</span> <span class="o">&lt;</span> <span class="i">_shadows</span><span class="p">.</span><span class="i">length</span><span class="p">;</span> <span class="i">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="c">// Stop when we hit the insertion point.</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">_shadows</span><span class="p">[</span><span class="i">index</span><span class="p">].</span><span class="i">start</span> <span class="o">&gt;=</span> <span class="i">shadow</span><span class="p">.</span><span class="i">start</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c">// The new shadow is going here. See if it overlaps the</span>
    <span class="c">// previous or next.</span>
    <span class="k">var</span> <span class="i">overlappingPrevious</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">index</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="i">_shadows</span><span class="p">[</span><span class="i">index</span> <span class="o">-</span> <span class="n">1</span><span class="p">].</span><span class="i">end</span> <span class="o">&gt;</span> <span class="i">shadow</span><span class="p">.</span><span class="i">start</span><span class="p">)</span> <span class="p">{</span>
      <span class="i">overlappingPrevious</span> <span class="o">=</span> <span class="i">_shadows</span><span class="p">[</span><span class="i">index</span> <span class="o">-</span> <span class="n">1</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="i">overlappingNext</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">index</span> <span class="o">&lt;</span> <span class="i">_shadows</span><span class="p">.</span><span class="i">length</span> <span class="o">&amp;&amp;</span>
        <span class="i">_shadows</span><span class="p">[</span><span class="i">index</span><span class="p">].</span><span class="i">start</span> <span class="o">&lt;</span> <span class="i">shadow</span><span class="p">.</span><span class="i">end</span><span class="p">)</span> <span class="p">{</span>
      <span class="i">overlappingNext</span> <span class="o">=</span> <span class="i">_shadows</span><span class="p">[</span><span class="i">index</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c">// Insert and unify with overlapping shadows.</span>
    <span class="k">if</span> <span class="p">(</span><span class="i">overlappingNext</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">overlappingPrevious</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="c">// Overlaps both, so unify one and delete the other.</span>
        <span class="i">overlappingPrevious</span><span class="p">.</span><span class="i">end</span> <span class="o">=</span> <span class="i">overlappingNext</span><span class="p">.</span><span class="i">end</span><span class="p">;</span>
        <span class="i">_shadows</span><span class="p">.</span><span class="i">removeAt</span><span class="p">(</span><span class="i">index</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c">// Overlaps the next one, so unify it with that.</span>
        <span class="i">overlappingNext</span><span class="p">.</span><span class="i">start</span> <span class="o">=</span> <span class="i">shadow</span><span class="p">.</span><span class="i">start</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="i">overlappingPrevious</span> <span class="o">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="c">// Overlaps the previous one, so unify it with that.</span>
        <span class="i">overlappingPrevious</span><span class="p">.</span><span class="i">end</span> <span class="o">=</span> <span class="i">shadow</span><span class="p">.</span><span class="i">end</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c">// Does not overlap anything, so insert.</span>
        <span class="i">_shadows</span><span class="p">.</span><span class="i">insert</span><span class="p">(</span><span class="i">index</span><span class="p">,</span> <span class="i">shadow</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">ShadowLine</span> <span class="p">{</span>
  <span class="t">bool</span> <span class="k">get</span> <span class="i">isFullShadow</span> <span class="p">{</span>
    <span class="k">return</span> <span class="i">_shadows</span><span class="p">.</span><span class="i">length</span> <span class="o">==</span> <span class="n">1</span> <span class="o">&amp;&amp;</span>
        <span class="i">_shadows</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="i">start</span> <span class="o">==</span> <span class="n">0</span> <span class="o">&amp;&amp;</span>
        <span class="i">_shadows</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="i">end</span> <span class="o">==</span> <span class="n">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">void</span> <span class="i">refreshVisibility</span><span class="p">(</span><span class="t">Vec</span> <span class="i">hero</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">octant</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">octant</span> <span class="o">&lt;</span> <span class="n">8</span><span class="p">;</span> <span class="i">octant</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">refreshOctant</span><span class="p">(</span><span class="i">hero</span><span class="p">,</span> <span class="i">octant</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">void</span> <span class="i">refreshOctant</span><span class="p">(</span><span class="t">Vec</span> <span class="i">hero</span><span class="p">,</span> <span class="t">int</span> <span class="i">octant</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="i">line</span> <span class="o">=</span> <span class="t">ShadowLine</span><span class="p">();</span>
  <span class="k">var</span> <span class="i">fullShadow</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">row</span> <span class="o">=</span> <span class="n">1</span><span class="p">;;</span> <span class="i">row</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// Stop once we go out of bounds.</span>
    <span class="k">var</span> <span class="i">pos</span> <span class="o">=</span> <span class="i">hero</span> <span class="o">+</span> <span class="i">transformOctant</span><span class="p">(</span><span class="i">row</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="i">octant</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="i">tiles</span><span class="p">.</span><span class="i">bounds</span><span class="p">.</span><span class="i">contains</span><span class="p">(</span><span class="i">pos</span><span class="p">))</span> <span class="k">break</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="i">col</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="i">col</span> <span class="o">&lt;=</span> <span class="i">row</span><span class="p">;</span> <span class="i">col</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">var</span> <span class="i">pos</span> <span class="o">=</span> <span class="i">hero</span> <span class="o">+</span> <span class="i">transformOctant</span><span class="p">(</span><span class="i">row</span><span class="p">,</span> <span class="i">col</span><span class="p">,</span> <span class="i">octant</span><span class="p">);</span>

      <span class="c">// If we&#39;ve traversed out of bounds, bail on this row.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="i">tiles</span><span class="p">.</span><span class="i">bounds</span><span class="p">.</span><span class="i">contains</span><span class="p">(</span><span class="i">pos</span><span class="p">))</span> <span class="k">break</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="i">fullShadow</span><span class="p">)</span> <span class="p">{</span>
        <span class="i">tiles</span><span class="p">[</span><span class="i">pos</span><span class="p">].</span><span class="i">isVisible</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">var</span> <span class="i">projection</span> <span class="o">=</span> <span class="i">projectTile</span><span class="p">(</span><span class="i">row</span><span class="p">,</span> <span class="i">col</span><span class="p">);</span>

        <span class="c">// Set the visibility of this tile.</span>
        <span class="k">var</span> <span class="i">visible</span> <span class="o">=</span> <span class="o">!</span><span class="i">line</span><span class="p">.</span><span class="i">isInShadow</span><span class="p">(</span><span class="i">projection</span><span class="p">);</span>
        <span class="i">tiles</span><span class="p">[</span><span class="i">pos</span><span class="p">].</span><span class="i">isVisible</span> <span class="o">=</span> <span class="i">visible</span><span class="p">;</span>

        <span class="c">// Add any opaque tiles to the shadow map.</span>
        <span class="k">if</span> <span class="p">(</span><span class="i">visible</span> <span class="o">&amp;&amp;</span> <span class="i">tiles</span><span class="p">[</span><span class="i">pos</span><span class="p">].</span><span class="i">isWall</span><span class="p">)</span> <span class="p">{</span>
          <span class="i">line</span><span class="p">.</span><span class="i">add</span><span class="p">(</span><span class="i">projection</span><span class="p">);</span>
          <span class="i">fullShadow</span> <span class="o">=</span> <span class="i">line</span><span class="p">.</span><span class="i">isFullShadow</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2015/09/08/the-hardest-program-ive-ever-written</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">experimental</span> <span class="o">=</span> <span class="i">document</span><span class="p">.</span><span class="i">querySelectorAll</span><span class="p">(</span><span class="s">&#39;link&#39;</span><span class="p">).</span><span class="i">any</span><span class="p">((</span><span class="i">link</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="i">link</span><span class="p">.</span><span class="i">attributes</span><span class="p">[</span><span class="s">&#39;rel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;import&#39;</span> <span class="o">&amp;&amp;</span>
        <span class="i">link</span><span class="p">.</span><span class="i">attributes</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="i">POLYMER_EXPERIMENTAL_HTML</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">_bindAssignablePropsOn</span><span class="p">.</span><span class="i">forEach</span><span class="p">((</span><span class="t">String</span> <span class="i">eventName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="i">node</span>
    <span class="p">.</span><span class="i">addEventListener</span><span class="p">(</span><span class="i">eventName</span><span class="p">,</span> <span class="p">(</span><span class="i">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="i">zone</span><span class="p">.</span><span class="i">run</span><span class="p">(</span>
        <span class="p">()</span> <span class="o">=&gt;</span> <span class="i">bindAssignableProps</span><span class="p">.</span><span class="i">forEach</span><span class="p">(</span>
            <span class="p">(</span><span class="i">propAndExp</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="i">propAndExp</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="i">assign</span><span class="p">(</span>
                <span class="i">scope</span><span class="p">.</span><span class="i">context</span><span class="p">,</span> <span class="i">jsNode</span><span class="p">[</span><span class="i">propAndExp</span><span class="p">[</span><span class="n">0</span><span class="p">]])))));</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">return</span> <span class="i">doughnutFryer</span>
    <span class="p">.</span><span class="i">start</span><span class="p">()</span>
    <span class="p">.</span><span class="i">then</span><span class="p">((</span><span class="i">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="i">_frostingGlazer</span><span class="p">.</span><span class="i">start</span><span class="p">())</span>
    <span class="p">.</span><span class="i">then</span><span class="p">((</span><span class="i">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="t">Future</span><span class="p">.</span><span class="i">wait</span><span class="p">([</span>
          <span class="i">_conveyorBelts</span><span class="p">.</span><span class="i">start</span><span class="p">(),</span>
          <span class="i">sprinkleSprinkler</span><span class="p">.</span><span class="i">start</span><span class="p">(),</span>
          <span class="i">sauceDripper</span><span class="p">.</span><span class="i">start</span><span class="p">()</span>
        <span class="p">]))</span>
    <span class="p">.</span><span class="i">catchError</span><span class="p">(</span><span class="i">cannotGetConveyorBeltRunning</span><span class="p">)</span>
    <span class="p">.</span><span class="i">then</span><span class="p">((</span><span class="i">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="i">tellEveryoneDonutsAreJustAboutDone</span><span class="p">())</span>
    <span class="p">.</span><span class="i">then</span><span class="p">((</span><span class="i">_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="t">Future</span><span class="p">.</span><span class="i">wait</span><span class="p">([</span>
          <span class="i">croissantFactory</span><span class="p">.</span><span class="i">start</span><span class="p">(),</span>
          <span class="i">_giantBakingOvens</span><span class="p">.</span><span class="i">start</span><span class="p">(),</span>
          <span class="i">butterbutterer</span><span class="p">.</span><span class="i">start</span><span class="p">()</span>
        <span class="p">])</span>
            <span class="p">.</span><span class="i">catchError</span><span class="p">(</span><span class="i">_handleBakingFailures</span><span class="p">)</span>
            <span class="p">.</span><span class="i">timeout</span><span class="p">(</span><span class="i">scriptLoadingTimeout</span><span class="p">,</span>
                <span class="i">onTimeout</span><span class="p">:</span> <span class="i">_handleBakingFailures</span><span class="p">)</span>
            <span class="p">.</span><span class="i">catchError</span><span class="p">(</span><span class="i">cannotGetConveyorBeltRunning</span><span class="p">))</span>
    <span class="p">.</span><span class="i">catchError</span><span class="p">(</span><span class="i">cannotGetConveyorBeltRunning</span><span class="p">)</span>
    <span class="p">.</span><span class="i">then</span><span class="p">((</span><span class="i">_</span><span class="p">)</span> <span class="p">{</span>
  <span class="i">_logger</span><span class="p">.</span><span class="i">info</span><span class="p">(</span><span class="s">&quot;Let&#39;s eat!&quot;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">format</span> <span class="c">/* comment */</span> <span class="k">this</span><span class="p">;</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">some</span><span class="p">(</span><span class="i">nested</span><span class="p">,</span> <span class="i">function</span><span class="p">(</span><span class="i">ca</span> <span class="o">+</span> <span class="i">ll</span><span class="p">))</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">function</span><span class="p">(</span><span class="i">first</span><span class="p">,</span> <span class="i">second</span><span class="p">,</span> <span class="i">third</span><span class="p">)</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">// 0: Don&#39;t split at all.</span>
<span class="i">function</span><span class="p">(</span><span class="i">first</span><span class="p">,</span> <span class="i">second</span><span class="p">,</span> <span class="i">third</span><span class="p">)</span>

<span class="c">// 1: Split before the first.</span>
<span class="i">function</span><span class="p">(</span>
    <span class="i">first</span><span class="p">,</span> <span class="i">second</span><span class="p">,</span> <span class="i">third</span><span class="p">)</span>

<span class="c">// 2: Split only before the last argument.</span>
<span class="i">function</span><span class="p">(</span><span class="i">first</span><span class="p">,</span> <span class="i">second</span><span class="p">,</span>
    <span class="i">third</span><span class="p">)</span>

<span class="c">// 3: Split only before the middle argument.</span>
<span class="i">function</span><span class="p">(</span><span class="i">first</span><span class="p">,</span>
    <span class="i">second</span><span class="p">,</span> <span class="i">third</span><span class="p">)</span>

<span class="c">// 4: Split before all of them.</span>
<span class="i">function</span><span class="p">(</span>
    <span class="i">first</span><span class="p">,</span>
    <span class="i">second</span><span class="p">,</span>
    <span class="i">third</span><span class="p">)</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">function</span><span class="p">(</span>
    <span class="i">first</span><span class="p">,</span> <span class="i">second</span><span class="p">,</span>
    <span class="i">third</span><span class="p">)</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="p">[</span><span class="i">first</span><span class="p">,</span> <span class="i">second</span> <span class="o">+</span>
    <span class="i">third</span><span class="p">,</span> <span class="i">fourth</span><span class="p">]</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">function</span><span class="p">(</span><span class="i">first</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">),</span> <span class="i">second</span><span class="p">(</span><span class="i">c</span><span class="p">,</span> <span class="i">d</span><span class="p">))</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">function</span><span class="p">(</span><span class="i">argument</span><span class="p">,</span> <span class="c">// comment</span>
    <span class="i">argument</span><span class="p">)</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">first</span><span class="p">(</span><span class="i">line</span><span class="p">);</span>
<span class="i">second</span><span class="p">(</span><span class="i">line</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">// Blog-friendly 40-char line limit:    |</span>
<span class="i">function</span><span class="p">(</span>
    <span class="i">firstCall</span><span class="p">(</span><span class="i">a</span><span class="p">,</span> <span class="i">b</span><span class="p">,</span> <span class="i">c</span><span class="p">,</span> <span class="i">d</span><span class="p">,</span> <span class="i">e</span><span class="p">,</span> <span class="i">f</span><span class="p">,</span> <span class="i">g</span><span class="p">,</span> <span class="i">h</span><span class="p">),</span>
    <span class="i">secondCall</span><span class="p">(</span><span class="s">&quot;very long argument string here&quot;</span><span class="p">));</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">// Blog-friendly 40-char line limit:    |</span>
<span class="k">new</span> <span class="t">Compiler</span><span class="p">(</span>
    <span class="i">assertions</span><span class="p">:</span> <span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;checked-mode&#39;</span><span class="p">),</span>
    <span class="i">annotations</span><span class="p">:</span> <span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;annotations&#39;</span><span class="p">),</span>
    <span class="i">primitives</span><span class="p">:</span> <span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;primitives&#39;</span><span class="p">),</span>
    <span class="i">minify</span><span class="p">:</span> <span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;minify&#39;</span><span class="p">),</span>
    <span class="i">preserve</span><span class="p">:</span> <span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;preserve&#39;</span><span class="p">),</span>
    <span class="i">liveAnalysis</span><span class="p">:</span> <span class="i">check</span><span class="p">(</span><span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;live&#39;</span><span class="p">),</span> <span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;analysis&#39;</span><span class="p">)),</span>
    <span class="i">multi</span><span class="p">:</span> <span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;multi&#39;</span><span class="p">),</span>
    <span class="i">sourceMap</span><span class="p">:</span> <span class="i">options</span><span class="p">.</span><span class="i">has</span><span class="p">(</span><span class="s">&#39;source-map&#39;</span><span class="p">));</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">ResolutionCopier</span> <span class="p">{</span>
  <span class="a">@override</span>
  <span class="t">bool</span> <span class="i">visitClassDeclaration</span><span class="p">(</span><span class="t">ClassDeclaration</span> <span class="i">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="t">ClassDeclaration</span> <span class="i">toNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="i">_toNode</span> <span class="k">as</span> <span class="t">ClassDeclaration</span><span class="p">;</span>
    <span class="k">return</span> <span class="i">javaBooleanAnd</span><span class="p">(</span>
        <span class="i">javaBooleanAnd</span><span class="p">(</span>
            <span class="i">javaBooleanAnd</span><span class="p">(</span>
                <span class="i">javaBooleanAnd</span><span class="p">(</span><span class="i">javaBooleanAnd</span><span class="p">(</span><span class="i">javaBooleanAnd</span><span class="p">(</span>
                        <span class="i">javaBooleanAnd</span><span class="p">(</span><span class="i">javaBooleanAnd</span><span class="p">(</span>
                            <span class="i">javaBooleanAnd</span><span class="p">(</span><span class="i">javaBooleanAnd</span><span class="p">(</span><span class="i">javaBooleanAnd</span><span class="p">(</span>
                                    <span class="i">_isEqualNodes</span><span class="p">(</span><span class="i">node</span><span class="p">.</span><span class="i">documentationComment</span><span class="p">,</span>
                                        <span class="i">toNode</span><span class="p">.</span><span class="i">documentationComment</span><span class="p">),</span>
                                    <span class="i">_isEqualNodeLists</span><span class="p">(</span>
                                        <span class="i">node</span><span class="p">.</span><span class="i">metadata</span><span class="p">,</span> <span class="i">toNode</span><span class="p">.</span><span class="i">metadata</span><span class="p">)),</span>
                                <span class="i">_isEqualTokens</span><span class="p">(</span><span class="i">node</span><span class="p">.</span><span class="i">abstractKeyword</span><span class="p">,</span>
                                    <span class="i">toNode</span><span class="p">.</span><span class="i">abstractKeyword</span><span class="p">)),</span> <span class="i">_isEqualTokens</span><span class="p">(</span>
                                <span class="i">node</span><span class="p">.</span><span class="i">classKeyword</span><span class="p">,</span> <span class="i">toNode</span><span class="p">.</span><span class="i">classKeyword</span><span class="p">)),</span>
                            <span class="i">_isEqualNodes</span><span class="p">(</span>
                                <span class="i">node</span><span class="p">.</span><span class="i">name</span><span class="p">,</span> <span class="i">toNode</span><span class="p">.</span><span class="i">name</span><span class="p">)),</span> <span class="i">_isEqualNodes</span><span class="p">(</span>
                            <span class="i">node</span><span class="p">.</span><span class="i">typeParameters</span><span class="p">,</span> <span class="i">toNode</span><span class="p">.</span><span class="i">typeParameters</span><span class="p">)),</span>
                        <span class="i">_isEqualNodes</span><span class="p">(</span>
                            <span class="i">node</span><span class="p">.</span><span class="i">extendsClause</span><span class="p">,</span> <span class="i">toNode</span><span class="p">.</span><span class="i">extendsClause</span><span class="p">)),</span>
                    <span class="i">_isEqualNodes</span><span class="p">(</span>
                        <span class="i">node</span><span class="p">.</span><span class="i">withClause</span><span class="p">,</span> <span class="i">toNode</span><span class="p">.</span><span class="i">withClause</span><span class="p">)),</span> <span class="i">_isEqualNodes</span><span class="p">(</span>
                    <span class="i">node</span><span class="p">.</span><span class="i">implementsClause</span><span class="p">,</span> <span class="i">toNode</span><span class="p">.</span><span class="i">implementsClause</span><span class="p">)),</span>
                <span class="i">_isEqualTokens</span><span class="p">(</span><span class="i">node</span><span class="p">.</span><span class="i">leftBracket</span><span class="p">,</span> <span class="i">toNode</span><span class="p">.</span><span class="i">leftBracket</span><span class="p">)),</span>
            <span class="i">_isEqualNodeLists</span><span class="p">(</span>
                <span class="i">node</span><span class="p">.</span><span class="i">members</span><span class="p">,</span>
                <span class="i">toNode</span><span class="p">.</span><span class="i">members</span><span class="p">)),</span>
        <span class="i">_isEqualTokens</span><span class="p">(</span>
            <span class="i">node</span><span class="p">.</span><span class="i">rightBracket</span><span class="p">,</span>
            <span class="i">toNode</span><span class="p">.</span><span class="i">rightBracket</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">abstract</span> <span class="c">// Oh, crap. A line comment.</span>
<span class="k">class</span> <span class="t">Foo</span> <span class="p">{}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">some</span><span class="p">(</span><span class="i">expression</span><span class="p">,</span>
   <span class="c">// with a line comment</span>
   <span class="i">rightInTheMiddleOfIt</span><span class="p">);</span>
</code></pre></div>
<h2>2016/06/16/long-names-are-long</h2>

<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">// Bad:</span>
<span class="t">String</span> <span class="i">nameString</span><span class="p">;</span>
<span class="t">DockableModelessWindow</span> <span class="i">dockableModelessWindow</span><span class="p">;</span>

<span class="c">// Better:</span>
<span class="t">String</span> <span class="i">name</span><span class="p">;</span>
<span class="t">DockableModelessWindow</span> <span class="i">window</span><span class="p">;</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">// Bad:</span>
<span class="t">List</span><span class="o">&lt;</span><span class="t">DateTime</span><span class="o">&gt;</span> <span class="i">holidayDateList</span><span class="p">;</span>
<span class="t">Map</span><span class="o">&lt;</span><span class="t">Employee</span><span class="p">,</span> <span class="t">Role</span><span class="o">&gt;</span> <span class="i">employeeRoleHashMap</span><span class="p">;</span>

<span class="c">// Better:</span>
<span class="t">List</span><span class="o">&lt;</span><span class="t">DateTime</span><span class="o">&gt;</span> <span class="i">holidays</span><span class="p">;</span>
<span class="t">Map</span><span class="o">&lt;</span><span class="t">Employee</span><span class="p">,</span> <span class="t">Role</span><span class="o">&gt;</span> <span class="i">employeeRoles</span><span class="p">;</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">// Bad:</span>
<span class="i">mergeTableCells</span><span class="p">(</span><span class="t">List</span><span class="o">&lt;</span><span class="t">TableCell</span><span class="o">&gt;</span> <span class="i">cells</span><span class="p">)</span>
<span class="i">sortEventsUsingComparator</span><span class="p">(</span><span class="t">List</span><span class="o">&lt;</span><span class="t">Event</span><span class="o">&gt;</span> <span class="i">events</span><span class="p">,</span>
    <span class="t">Comparator</span><span class="o">&lt;</span><span class="t">Event</span><span class="o">&gt;</span> <span class="i">comparator</span><span class="p">)</span>

<span class="c">// Better:</span>
<span class="i">merge</span><span class="p">(</span><span class="t">List</span><span class="o">&lt;</span><span class="t">TableCell</span><span class="o">&gt;</span> <span class="i">cells</span><span class="p">)</span>
<span class="i">sort</span><span class="p">(</span><span class="t">List</span><span class="o">&lt;</span><span class="t">Event</span><span class="o">&gt;</span> <span class="i">events</span><span class="p">,</span> <span class="t">Comparator</span><span class="o">&lt;</span><span class="t">Event</span><span class="o">&gt;</span> <span class="i">comparator</span><span class="p">)</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="i">mergeTableCells</span><span class="p">(</span><span class="i">tableCells</span><span class="p">);</span>
<span class="i">sortEventsUsingComparator</span><span class="p">(</span><span class="i">events</span><span class="p">,</span> <span class="i">comparator</span><span class="p">);</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">// Bad:</span>
<span class="i">finalBattleMostDangerousBossMonster</span><span class="p">;</span>
<span class="i">weaklingFirstEncounterMonster</span><span class="p">;</span>

<span class="c">// Better:</span>
<span class="i">boss</span><span class="p">;</span>
<span class="i">firstMonster</span><span class="p">;</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="c">// Bad:</span>
<span class="k">class</span> <span class="t">AnnualHolidaySale</span> <span class="p">{</span>
  <span class="t">int</span> <span class="i">_annualSaleRebate</span><span class="p">;</span>
  <span class="k">void</span> <span class="i">promoteHolidaySale</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c">// Better:</span>
<span class="k">class</span> <span class="t">AnnualHolidaySale</span> <span class="p">{</span>
  <span class="t">int</span> <span class="i">_rebate</span><span class="p">;</span>
  <span class="k">void</span> <span class="i">promote</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">DeliciousBelgianWaffleObject</span> <span class="p">{</span>
  <span class="k">void</span> <span class="i">garnishDeliciousBelgianWaffleWithStrawberryList</span><span class="p">(</span>
      <span class="t">List</span><span class="o">&lt;</span><span class="t">Strawberry</span><span class="o">&gt;</span> <span class="i">strawberryList</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">DeliciousBelgianWaffleObject</span> <span class="p">{</span>
    <span class="k">void</span> <span class="i">garnishDeliciousBelgianWaffle</span><span class="p">(</span>
        <span class="t">List</span><span class="o">&lt;</span><span class="t">Strawberry</span><span class="o">&gt;</span> <span class="i">strawberries</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">WaffleObject</span> <span class="p">{</span>
  <span class="k">void</span> <span class="i">garnishWaffle</span><span class="p">(</span><span class="t">List</span><span class="o">&lt;</span><span class="t">Strawberry</span><span class="o">&gt;</span> <span class="i">strawberries</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">WaffleObject</span> <span class="p">{</span>
  <span class="k">void</span> <span class="i">garnish</span><span class="p">(</span><span class="t">List</span><span class="o">&lt;</span><span class="t">Strawberry</span><span class="o">&gt;</span> <span class="i">strawberries</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart"><span class="k">class</span> <span class="t">Waffle</span> <span class="p">{</span>
  <span class="k">void</span> <span class="i">garnish</span><span class="p">(</span><span class="t">List</span><span class="o">&lt;</span><span class="t">Strawberry</span><span class="o">&gt;</span> <span class="i">strawberries</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>2020/04/05/crafting-crafting-interpreters</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>high-level goal: a *small* book that builds a complete, efficient
interpreter. instead of a wide text about programming language*s*,
it is a single path through the language space. aim for 60k words.
</code></pre></div>
<p>md</p>
<div class="highlight"><pre><code class="language-md" data-lang="md"><span></span>Which can be any of:

^code is-alpha

Once we&#39;ve found an identifier, we scan the rest of it using:
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="c">//&gt; Scanning on Demand is-alpha</span>
<span class="k">static</span> <span class="t">bool</span> <span class="i">isAlpha</span><span class="p">(</span><span class="t">char</span> <span class="i">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="i">c</span> <span class="o">&gt;=</span> <span class="s">&#39;a&#39;</span> <span class="o">&amp;&amp;</span> <span class="i">c</span> <span class="o">&lt;=</span> <span class="s">&#39;z&#39;</span><span class="p">)</span> <span class="o">||</span>
         <span class="p">(</span><span class="i">c</span> <span class="o">&gt;=</span> <span class="s">&#39;A&#39;</span> <span class="o">&amp;&amp;</span> <span class="i">c</span> <span class="o">&lt;=</span> <span class="s">&#39;Z&#39;</span><span class="p">)</span> <span class="o">||</span>
          <span class="i">c</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="c">//&lt; Scanning on Demand is-alpha</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">static</span> <span class="t">void</span> <span class="i">concatenate</span><span class="p">()</span> <span class="p">{</span>
<span class="c">/* Strings concatenate &lt; Garbage Collection concatenate-peek
  ObjString* b = AS_STRING(pop());
  ObjString* a = AS_STRING(pop());
*/</span>
<span class="c">//&gt; Garbage Collection concatenate-peek</span>
  <span class="t">ObjString</span><span class="o">*</span> <span class="i">b</span> <span class="o">=</span> <span class="r">AS_STRING</span><span class="p">(</span><span class="i">peek</span><span class="p">(</span><span class="n">0</span><span class="p">));</span>
  <span class="t">ObjString</span><span class="o">*</span> <span class="i">a</span> <span class="o">=</span> <span class="r">AS_STRING</span><span class="p">(</span><span class="i">peek</span><span class="p">(</span><span class="n">1</span><span class="p">));</span>
<span class="c">//&lt; Garbage Collection concatenate-peek</span>

  <span class="t">int</span> <span class="i">length</span> <span class="o">=</span> <span class="i">a</span><span class="o">-&gt;</span><span class="i">length</span> <span class="o">+</span> <span class="i">b</span><span class="o">-&gt;</span><span class="i">length</span><span class="p">;</span>
  <span class="t">char</span><span class="o">*</span> <span class="i">chars</span> <span class="o">=</span> <span class="r">ALLOCATE</span><span class="p">(</span><span class="t">char</span><span class="p">,</span> <span class="i">length</span> <span class="o">+</span> <span class="n">1</span><span class="p">);</span>
  <span class="i">memcpy</span><span class="p">(</span><span class="i">chars</span><span class="p">,</span> <span class="i">a</span><span class="o">-&gt;</span><span class="i">chars</span><span class="p">,</span> <span class="i">a</span><span class="o">-&gt;</span><span class="i">length</span><span class="p">);</span>
  <span class="i">memcpy</span><span class="p">(</span><span class="i">chars</span> <span class="o">+</span> <span class="i">a</span><span class="o">-&gt;</span><span class="i">length</span><span class="p">,</span> <span class="i">b</span><span class="o">-&gt;</span><span class="i">chars</span><span class="p">,</span> <span class="i">b</span><span class="o">-&gt;</span><span class="i">length</span><span class="p">);</span>
  <span class="i">chars</span><span class="p">[</span><span class="i">length</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">int</span> <span class="i">main</span><span class="p">(</span><span class="t">int</span> <span class="i">argc</span><span class="p">,</span> <span class="k">const</span> <span class="t">char</span><span class="o">*</span> <span class="i">argv</span><span class="p">[])</span> <span class="p">{</span>
<span class="c">//&gt; A Virtual Machine main-init-vm</span>
  <span class="i">initVM</span><span class="p">();</span>

<span class="c">//&lt; A Virtual Machine main-init-vm</span>
<span class="c">/* Chunks of Bytecode main-chunk &lt; Scanning on Demand args
  Chunk chunk;
  initChunk(&amp;chunk);
*/</span>
<span class="c">/* Chunks of Bytecode main-constant &lt; Scanning on Demand args

  int constant = addConstant(&amp;chunk, 1.2);
*/</span>
<span class="c">/* Chunks of Bytecode main-constant &lt; Chunks of Bytecode main-chunk-line
  writeChunk(&amp;chunk, OP_CONSTANT);
  writeChunk(&amp;chunk, constant);

*/</span>
<span class="c">/* Chunks of Bytecode main-chunk-line &lt; Scanning on Demand args
  writeChunk(&amp;chunk, OP_CONSTANT, 123);
  writeChunk(&amp;chunk, constant, 123);
*/</span>
<span class="c">/* A Virtual Machine main-chunk &lt; Scanning on Demand args

  constant = addConstant(&amp;chunk, 3.4);
  writeChunk(&amp;chunk, OP_CONSTANT, 123);
  writeChunk(&amp;chunk, constant, 123);

  writeChunk(&amp;chunk, OP_ADD, 123);

  constant = addConstant(&amp;chunk, 5.6);
  writeChunk(&amp;chunk, OP_CONSTANT, 123);
  writeChunk(&amp;chunk, constant, 123);

  writeChunk(&amp;chunk, OP_DIVIDE, 123);
*/</span>
<span class="c">/* A Virtual Machine main-negate &lt; Scanning on Demand args
  writeChunk(&amp;chunk, OP_NEGATE, 123);
*/</span>
<span class="c">/* Chunks of Bytecode main-chunk &lt; Chunks of Bytecode main-chunk-line
  writeChunk(&amp;chunk, OP_RETURN);
*/</span>
<span class="c">/* Chunks of Bytecode main-chunk-line &lt; Scanning on Demand args

  writeChunk(&amp;chunk, OP_RETURN, 123);
*/</span>
<span class="c">/* Chunks of Bytecode main-disassemble-chunk &lt; Scanning on Demand args

  disassembleChunk(&amp;chunk, &quot;test chunk&quot;);
*/</span>
<span class="c">/* A Virtual Machine main-interpret &lt; Scanning on Demand args
  interpret(&amp;chunk);
*/</span>
<span class="c">//&gt; Scanning on Demand args</span>
  <span class="k">if</span> <span class="p">(</span><span class="i">argc</span> <span class="o">==</span> <span class="n">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">repl</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="i">argc</span> <span class="o">==</span> <span class="n">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="i">runFile</span><span class="p">(</span><span class="i">argv</span><span class="p">[</span><span class="n">1</span><span class="p">]);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="i">fprintf</span><span class="p">(</span><span class="i">stderr</span><span class="p">,</span> <span class="s">&quot;Usage: clox [path]</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="i">exit</span><span class="p">(</span><span class="n">64</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="i">freeVM</span><span class="p">();</span>
<span class="c">//&lt; Scanning on Demand args</span>
<span class="c">/* A Virtual Machine main-free-vm &lt; Scanning on Demand args
  freeVM();
*/</span>
<span class="c">/* Chunks of Bytecode main-chunk &lt; Scanning on Demand args
  freeChunk(&amp;chunk);
*/</span>
  <span class="k">return</span> <span class="n">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>2023/01/03/type-checking-if-expressions</h2>

<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">def</span> <span class="i">onTick</span><span class="p">()</span>
  <span class="k">var</span> <span class="i">d</span> <span class="o">=</span> <span class="n">0</span>
  <span class="k">if</span> <span class="i">buttonHeld</span><span class="p">(</span><span class="n">2</span><span class="p">)</span> <span class="k">then</span> <span class="i">d</span> <span class="o">=</span> <span class="i">d</span> <span class="o">-</span> <span class="n">1</span> <span class="k">end</span>
  <span class="k">if</span> <span class="i">buttonHeld</span><span class="p">(</span><span class="n">3</span><span class="p">)</span> <span class="k">then</span> <span class="i">d</span> <span class="o">=</span> <span class="i">d</span> <span class="o">+</span> <span class="n">1</span> <span class="k">end</span>

  <span class="k">if</span> <span class="i">d</span> <span class="o">!=</span> <span class="n">0</span> <span class="k">then</span>
    <span class="i">h</span> <span class="o">=</span> <span class="i">h</span> <span class="o">+</span> <span class="i">d</span>
  <span class="k">else</span> <span class="k">if</span> <span class="i">h</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span>
    <span class="i">h</span> <span class="o">=</span> <span class="i">h</span> <span class="o">-</span> <span class="n">0.5</span>
  <span class="k">else</span> <span class="k">if</span> <span class="i">h</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">then</span>
    <span class="i">h</span> <span class="o">=</span> <span class="i">h</span> <span class="o">+</span> <span class="n">0.5</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="i">h</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">3.0</span> <span class="k">then</span> <span class="i">h</span> <span class="o">=</span> <span class="o">-</span><span class="n">3.0</span> <span class="k">end</span>
  <span class="k">if</span> <span class="i">h</span> <span class="o">&gt;</span> <span class="n">3.0</span> <span class="k">then</span> <span class="i">h</span> <span class="o">=</span> <span class="n">3.0</span> <span class="k">end</span>
  <span class="i">x</span> <span class="o">=</span> <span class="i">x</span> <span class="o">+</span> <span class="i">h</span>

  <span class="k">if</span> <span class="i">y</span> <span class="o">&lt;</span> <span class="n">200</span> <span class="k">then</span>
    <span class="i">v</span> <span class="o">=</span> <span class="i">v</span> <span class="o">+</span> <span class="n">0.8</span>
  <span class="k">end</span>
  <span class="i">y</span> <span class="o">=</span> <span class="i">y</span> <span class="o">+</span> <span class="i">v</span>
  <span class="k">if</span> <span class="i">y</span> <span class="o">&gt;</span> <span class="n">200</span> <span class="k">then</span>
    <span class="i">y</span> <span class="o">=</span> <span class="n">200</span>
    <span class="i">v</span> <span class="o">=</span> <span class="n">0</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="i">buttonPressed</span><span class="p">(</span><span class="n">0</span><span class="p">)</span> <span class="k">then</span>
    <span class="k">if</span> <span class="i">y</span> <span class="o">==</span> <span class="n">200</span> <span class="k">then</span>
      <span class="i">playSequence</span><span class="p">()</span>
      <span class="i">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">10.0</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="i">h</span> <span class="o">=</span> <span class="i">h</span> <span class="o">+</span> <span class="k">if</span> <span class="i">d</span> <span class="o">!=</span> <span class="n">0</span> <span class="k">then</span>
  <span class="i">d</span>
<span class="k">else</span> <span class="k">if</span> <span class="i">h</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span>
  <span class="o">-</span><span class="n">0.5</span>
<span class="k">else</span> <span class="k">if</span> <span class="i">h</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">then</span>
  <span class="n">0.5</span>
<span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">var</span> <span class="i">love</span> <span class="o">=</span> <span class="k">if</span> <span class="i">isFriday</span> <span class="k">then</span> <span class="s">&quot;in love&quot;</span> <span class="k">else</span> <span class="s">&quot;not in love&quot;</span> <span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">var</span> <span class="i">love</span> <span class="o">=</span> <span class="k">if</span> <span class="i">isFriday</span> <span class="k">then</span> <span class="s">&quot;in love&quot;</span> <span class="k">else</span> <span class="n">0</span> <span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">var</span> <span class="i">daysNotInLove</span> <span class="o">=</span> <span class="n">0</span>
<span class="k">if</span> <span class="i">isFriday</span> <span class="k">then</span>
  <span class="i">print</span><span class="p">(</span><span class="s">&quot;in love&quot;</span><span class="p">)</span>
<span class="k">else</span>
  <span class="i">daysNotInLove</span> <span class="o">=</span> <span class="n">1</span>
<span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs">    <span class="k">def</span> <span class="i">three</span><span class="p">()</span> <span class="t">Int</span>
      <span class="i">print</span><span class="p">(</span><span class="s">&quot;About to return three...&quot;</span><span class="p">)</span>
      <span class="n">3</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="i">onInit</span><span class="p">()</span>
      <span class="i">print</span><span class="p">(</span><span class="i">three</span><span class="p">())</span> <span class="c"># Prints &quot;About to return three...&quot; then &quot;3&quot;.</span>
    <span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">def</span> <span class="i">onInit</span><span class="p">()</span>
  <span class="k">var</span> <span class="i">love</span> <span class="o">=</span> <span class="k">if</span> <span class="i">isFriday</span> <span class="k">then</span> <span class="s">&quot;in love&quot;</span> <span class="k">else</span> <span class="k">return</span> <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">var</span> <span class="i">x</span> <span class="o">=</span> <span class="k">return</span>
</code></pre></div>
<h2>2023/08/04/representing-heterogeneous-data</h2>

<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs">    <span class="k">rec</span> <span class="t">Address</span>
      <span class="k">var</span> <span class="i">number</span> <span class="t">Int</span>
      <span class="k">var</span> <span class="i">street</span> <span class="t">String</span>
      <span class="k">var</span> <span class="i">apartmentNumber</span> <span class="t">Int</span>
      <span class="k">var</span> <span class="i">city</span> <span class="t">String</span>
      <span class="k">var</span> <span class="i">zipCode</span> <span class="t">Int</span>
      <span class="k">var</span> <span class="i">state</span> <span class="t">String</span>
    <span class="k">end</span>
</code></pre></div>
<p>dart</p>
<div class="highlight"><pre><code class="language-dart" data-lang="dart">    <span class="k">interface</span> <span class="k">class</span> <span class="t">Weapon</span> <span class="p">{}</span>

    <span class="k">class</span> <span class="t">MeleeWeapon</span> <span class="k">implements</span> <span class="t">Weapon</span> <span class="p">{</span>
      <span class="t">int</span> <span class="i">damage</span><span class="p">;</span>

      <span class="t">MeleeWeapon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">damage</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="t">RangedWeapon</span> <span class="k">implements</span> <span class="t">Weapon</span> <span class="p">{</span>
      <span class="t">int</span> <span class="i">minRange</span><span class="p">;</span>
      <span class="t">int</span> <span class="i">maxRange</span><span class="p">;</span>

      <span class="t">RangedWeapon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="i">minRange</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="i">maxRange</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">rec</span> <span class="t">MeleeWeapon</span>
  <span class="k">var</span> <span class="i">damage</span> <span class="t">Int</span>
<span class="k">end</span>

<span class="k">def</span> <span class="i">attack</span><span class="p">(</span><span class="i">weapon</span> <span class="t">MeleeWeapon</span><span class="p">,</span> <span class="i">monster</span> <span class="t">Monster</span><span class="p">,</span> <span class="i">distance</span> <span class="t">Int</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">distance</span> <span class="o">&gt;</span> <span class="n">1</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You are out of range.&quot;</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="k">end</span>

  <span class="k">var</span> <span class="i">damage</span> <span class="o">=</span> <span class="i">rollDice</span><span class="p">(</span><span class="i">weapon</span><span class="p">.</span><span class="i">damage</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">&lt;=</span> <span class="i">damage</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You kill the monster!&quot;</span><span class="p">)</span>
    <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">=</span> <span class="n">0</span>
  <span class="k">else</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You wound the monster.&quot;</span><span class="p">)</span>
    <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">=</span> <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">-</span> <span class="i">damage</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">rec</span> <span class="t">Weapon</span>
<span class="k">case</span> <span class="t">MeleeWeapon</span>
  <span class="k">var</span> <span class="i">damage</span> <span class="t">Int</span>
<span class="k">case</span> <span class="t">RangedWeapon</span>
  <span class="k">var</span> <span class="i">minRange</span> <span class="t">Int</span>
  <span class="k">var</span> <span class="i">maxRange</span> <span class="t">Int</span>
<span class="k">end</span>

<span class="k">def</span> <span class="i">attack</span><span class="p">(</span><span class="i">weapon</span> <span class="t">Weapon</span><span class="p">,</span> <span class="i">monster</span> <span class="t">Monster</span><span class="p">,</span> <span class="i">distance</span> <span class="t">Int</span><span class="p">)</span>
  <span class="k">var</span> <span class="i">isInRange</span> <span class="o">=</span> <span class="k">match</span> <span class="i">weapon</span>
  <span class="k">case</span> <span class="t">MeleeWeapon</span><span class="p">(</span><span class="i">damage</span><span class="p">)</span> <span class="k">then</span> <span class="i">distance</span> <span class="o">==</span> <span class="n">1</span>
  <span class="k">case</span> <span class="t">RangedWeapon</span><span class="p">(</span><span class="i">min</span><span class="p">,</span> <span class="i">max</span><span class="p">)</span> <span class="k">then</span> <span class="i">distance</span> <span class="o">&gt;=</span> <span class="i">min</span> <span class="k">and</span> <span class="i">distance</span> <span class="o">&lt;=</span> <span class="i">max</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="o">!</span><span class="i">isInRange</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You are out of range.&quot;</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="k">end</span>

  <span class="k">var</span> <span class="i">damage</span> <span class="o">=</span> <span class="k">match</span> <span class="i">weapon</span>
  <span class="k">case</span> <span class="t">MeleeWeapon</span><span class="p">(</span><span class="i">damage</span><span class="p">)</span> <span class="k">then</span> <span class="i">rollDice</span><span class="p">(</span><span class="i">damage</span><span class="p">)</span>
  <span class="k">case</span> <span class="t">RangedWeapon</span><span class="p">(</span><span class="i">min</span><span class="p">,</span> <span class="i">max</span><span class="p">)</span> <span class="k">then</span> <span class="i">max</span> <span class="o">-</span> <span class="i">min</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">&lt;=</span> <span class="i">damage</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You kill the monster!&quot;</span><span class="p">)</span>
    <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">=</span> <span class="n">0</span>
  <span class="k">else</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You wound the monster.&quot;</span><span class="p">)</span>
    <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">=</span> <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">-</span> <span class="i">damage</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
  <span class="r">WEAPON_MELEE</span><span class="p">,</span>
  <span class="r">WEAPON_RANGED</span>
<span class="p">}</span> <span class="t">WeaponType</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="t">WeaponType</span> <span class="i">type</span><span class="p">;</span>
  <span class="k">union</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="p">{</span>
      <span class="t">int</span> <span class="i">damage</span><span class="p">;</span>
    <span class="p">}</span> <span class="i">melee</span><span class="p">;</span>
    
    <span class="k">struct</span> <span class="p">{</span>
      <span class="t">int</span> <span class="i">minRange</span><span class="p">;</span>
      <span class="t">int</span> <span class="i">maxRange</span><span class="p">;</span>
    <span class="p">}</span> <span class="i">ranged</span><span class="p">;</span>
  <span class="p">}</span> <span class="i">as</span><span class="p">;</span>
<span class="p">}</span> <span class="t">Weapon</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">Weapon</span> <span class="i">weapon</span><span class="p">;</span>
<span class="i">weapon</span><span class="p">.</span><span class="i">type</span> <span class="o">=</span> <span class="r">WEAPON_MELEE</span><span class="p">;</span>
<span class="i">weapon</span><span class="p">.</span><span class="i">as</span><span class="p">.</span><span class="i">melee</span><span class="p">.</span><span class="i">damage</span> <span class="o">=</span> <span class="n">6</span><span class="p">;</span>
</code></pre></div>
<p>c</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="t">Weapon</span> <span class="i">weapon</span><span class="p">;</span>
<span class="i">weapon</span><span class="p">.</span><span class="i">type</span> <span class="o">=</span> <span class="r">WEAPON_MELEE</span><span class="p">;</span>
<span class="i">weapon</span><span class="p">.</span><span class="i">as</span><span class="p">.</span><span class="i">melee</span><span class="p">.</span><span class="i">damage</span> <span class="o">=</span> <span class="n">6</span><span class="p">;</span>

<span class="i">printf</span><span class="p">(</span><span class="s">&quot;Min range %d</span><span class="e">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="i">weapon</span><span class="p">.</span><span class="i">as</span><span class="p">.</span><span class="i">ranged</span><span class="p">.</span><span class="i">minRange</span><span class="p">);</span> <span class="c">// Oops.</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">rec</span> <span class="t">Weapon</span>
<span class="k">case</span> <span class="t">MeleeWeapon</span>
  <span class="k">var</span> <span class="i">damage</span> <span class="t">Int</span>
<span class="k">case</span> <span class="t">RangedWeapon</span>
  <span class="k">var</span> <span class="i">minRange</span> <span class="t">Int</span>
  <span class="k">var</span> <span class="i">maxRange</span> <span class="t">Int</span>
<span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">def</span> <span class="i">attack</span><span class="p">(</span><span class="i">weapon</span> <span class="t">Weapon</span><span class="p">,</span> <span class="i">monster</span> <span class="t">Monster</span><span class="p">,</span> <span class="i">distance</span> <span class="t">Int</span><span class="p">)</span>
  <span class="k">if</span> <span class="i">weapon</span> <span class="k">is</span> <span class="t">MeleeWeapon</span> <span class="k">and</span> <span class="i">distance</span> <span class="o">&gt;</span> <span class="n">1</span> <span class="k">or</span>
      <span class="i">distance</span> <span class="o">&lt;</span> <span class="i">weapon</span><span class="p">.</span><span class="i">minRange</span> <span class="k">or</span>
      <span class="i">distance</span> <span class="o">&gt;</span> <span class="i">weapon</span><span class="p">.</span><span class="i">maxRange</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You are out of range.&quot;</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="k">end</span>

  <span class="k">var</span> <span class="i">damage</span> <span class="o">=</span> <span class="k">if</span> <span class="i">weapon</span> <span class="k">is</span> <span class="t">MeleeWeapon</span> <span class="k">then</span>
    <span class="i">rollDice</span><span class="p">(</span><span class="i">weapon</span><span class="p">.</span><span class="i">damage</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="i">weapon</span><span class="p">.</span><span class="i">maxRange</span> <span class="o">-</span> <span class="i">weapon</span><span class="p">.</span><span class="i">minRange</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">&lt;=</span> <span class="i">damage</span> <span class="k">then</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You kill the monster!&quot;</span><span class="p">)</span>
    <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">=</span> <span class="n">0</span>
  <span class="k">else</span>
    <span class="i">print</span><span class="p">(</span><span class="s">&quot;You wound the monster.&quot;</span><span class="p">)</span>
    <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">=</span> <span class="i">monster</span><span class="p">.</span><span class="i">health</span> <span class="o">-</span> <span class="i">damage</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>vgs</p>
<div class="highlight"><pre><code class="language-vgs" data-lang="vgs"><span class="k">rec</span> <span class="t">Weapon</span>
  <span class="k">var</span> <span class="i">name</span> <span class="t">String</span>
  <span class="k">var</span> <span class="i">bonus</span> <span class="t">Int</span>
<span class="k">case</span> <span class="t">MeleeWeapon</span>
  <span class="k">var</span> <span class="i">damage</span> <span class="t">Int</span>
<span class="k">case</span> <span class="t">RangedWeapon</span>
  <span class="k">var</span> <span class="i">minRange</span> <span class="t">Int</span>
  <span class="k">var</span> <span class="i">maxRange</span> <span class="t">Int</span>
<span class="k">end</span>
</code></pre></div>
</article>
      <nav>
  <div class="nav-first">
    <a href="/"><img src="/image/dogshot_square.jpg" class="bob"></a>

    <p>Hi! I'm <strong>Bob Nystrom</strong>, the one on the left. I wrote <a href="http://gameprogrammingpatterns.com/"><strong>Game Programming Patterns</strong></a> and <a href="http://craftinginterpreters.com"><strong>Crafting Interpreters</strong></a>.</p>
    <p>You can email me at <code>robert</code> at this site or follow me on twitter at <a href="https://twitter.com/intent/user?screen_name=munificentbob"><code>@munificentbob</code></a>.</p>

    <h2>Elsewhere</h2>
    <ul>
      <li>Code at <a href="http://github.com/munificent">GitHub</a></li>
      <li>Tweets at <a href="http://twitter.com/munificentbob">Twitter</a></li>
      <li>Music at <a href="https://www.youtube.com/channel/UCSMJ0iRwAhIFYSpntOEtn2g">YouTube</a></li>
      <li>Photos at <a href="https://500px.com/munificent">500px</a></li>
      <li>Photos at <a href="http://www.flickr.com/photos/bobisbob/">Flickr</a></li>
    </ul>
  </div>
  <div class="nav-second">
    <h2>Categories</h2>
    <ul><li><a href="/category/code">code</a> <small class='post-count'>69</small></li><li><a href="/category/language">language</a> <small class='post-count'>46</small></li><li><a href="/category/magpie">magpie</a> <small class='post-count'>24</small></li><li><a href="/category/c-sharp">c-sharp</a> <small class='post-count'>13</small></li><li><a href="/category/dart">dart</a> <small class='post-count'>13</small></li><li><a href="/category/game-dev">game-dev</a> <small class='post-count'>12</small></li><li><a href="/category/java">java</a> <small class='post-count'>10</small></li><li><a href="/category/cpp">cpp</a> <small class='post-count'>8</small></li><li><a href="/category/design">design</a> <small class='post-count'>7</small></li><li><a href="/category/game-patterns">game-patterns</a> <small class='post-count'>6</small></li><li><a href="/category/parsing">parsing</a> <small class='post-count'>6</small></li><li><a href="/category/roguelike">roguelike</a> <small class='post-count'>6</small></li><li><a href="/category/book">book</a> <small class='post-count'>5</small></li><li><a href="/category/go">go</a> <small class='post-count'>5</small></li><li><a href="/category/personal">personal</a> <small class='post-count'>5</small></li><li><a href="/category/js">js</a> <small class='post-count'>4</small></li><li><a href="/category/c">c</a> <small class='post-count'>3</small></li><li><a href="/category/finch">finch</a> <small class='post-count'>3</small></li><li><a href="/category/python">python</a> <small class='post-count'>3</small></li><li><a href="/category/ruby">ruby</a> <small class='post-count'>3</small></li><li><a href="/category/blog">blog</a> <small class='post-count'>2</small></li><li><a href="/category/f-sharp">f-sharp</a> <small class='post-count'>2</small></li><li><a href="/category/javascript">javascript</a> <small class='post-count'>2</small></li><li><a href="/category/lua">lua</a> <small class='post-count'>2</small></li><li><a href="/category/music">music</a> <small class='post-count'>2</small></li><li><a href="/category/ai">ai</a> <small class='post-count'>1</small></li><li><a href="/category/beta">beta</a> <small class='post-count'>1</small></li><li><a href="/category/game">game</a> <small class='post-count'>1</small></li><li><a href="/category/jasic">jasic</a> <small class='post-count'>1</small></li><li><a href="/category/oop">oop</a> <small class='post-count'>1</small></li><li><a href="/category/optimization">optimization</a> <small class='post-count'>1</small></li><li><a href="/category/oscon">oscon</a> <small class='post-count'>1</small></li><li><a href="/category/politics">politics</a> <small class='post-count'>1</small></li><li><a href="/category/scheme">scheme</a> <small class='post-count'>1</small></li><li><a href="/category/typescript">typescript</a> <small class='post-count'>1</small></li><li><a href="/category/visualization">visualization</a> <small class='post-count'>1</small></li></ul>

    <p class="archive">All <a href="/archive">80 articles</a>&hellip;</p>

    <p>This blog is built using a bespoke static site generator. The source repo
    is <a href="https://github.com/munificent/journal">here</a>.</p>
    <p class="copyright">&copy; 2008-2021 Bob Nystrom</p>
  </div>
</nav>
    </div>
  </body>
</html>
