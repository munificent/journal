<table class=archive>
  <thead>
    <tr>
      <td>date</td>
      <td>title</td>
      <td class="tags">tags</td>
    </tr>
  </thead>
  <tbody>
{{ let current_year = "" }}
{{ for post in posts }}
  {{ if post.date.year != current_year }}
    {{ include "post_row" with post = post, year = post.date.year }}
  {{ set current_year = post.date.year }}
  {{ else }}
    {{ include "post_row" with post = post, year = null }}  
  {{ end }}
{{ end }}
  </tbody>
</table>